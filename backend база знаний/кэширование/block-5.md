# üîÑ –ë–ª–æ–∫ 5: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**‚è±Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 3 –Ω–µ–¥–µ–ª–∏  
**üéØ –¶–µ–ª—å:** –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ –∫—ç—à–∏—Ä—É—é—â–∏–µ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

---

## üìö –ì–ª–∞–≤–∞ 1: –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### üéØ –í–≤–µ–¥–µ–Ω–∏–µ

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é: —É –≤–∞—Å –µ—Å—Ç—å 3 –∫—ç—à-—Å–µ—Ä–≤–µ—Ä–∞ –∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ–∂–¥—É –Ω–∏–º–∏ 1000 –∫–ª—é—á–µ–π. –ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:

```
server_id = hash(key) % number_of_servers
```

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ –æ–±—ã—á–Ω–æ–≥–æ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

```
–ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (3 —Å–µ—Ä–≤–µ—Ä–∞):
------------------------------------
Server 0: –∫–ª—é—á–∏ 0, 3, 6, 9, ...
Server 1: –∫–ª—é—á–∏ 1, 4, 7, 10, ...
Server 2: –∫–ª—é—á–∏ 2, 5, 8, 11, ...
------------------------------------

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è 4-–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:
------------------------------------
Server 0: –∫–ª—é—á–∏ 0, 4, 8, 12, ...
Server 1: –∫–ª—é—á–∏ 1, 5, 9, 13, ...
Server 2: –∫–ª—é—á–∏ 2, 6, 10, 14, ...
Server 3: –∫–ª—é—á–∏ 3, 7, 11, 15, ...
------------------------------------
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 75% –∫–ª—é—á–µ–π –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏—Å—å –Ω–∞ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–µ—Ä—ã! –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –º–∞—Å—Å–æ–≤—ã–µ cache miss'—ã.

### üîß –†–µ—à–µ–Ω–∏–µ: –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤.

#### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:

```
        0¬∞
        ‚Üë
   315¬∞   45¬∞
      \ /
270¬∞ ‚Üê ‚Ä¢ ‚Üí 90¬∞
      / \
   225¬∞   135¬∞
        ‚Üì
       180¬∞

–ö–æ–ª—å—Ü–æ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (0-360¬∞)
```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –†–∞–∑–º–µ—â–∞–µ–º —Å–µ—Ä–≤–µ—Ä—ã –Ω–∞ –∫–æ–ª—å—Ü–µ –ø–æ —Ö–µ—à—É –∏—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
2. –†–∞–∑–º–µ—â–∞–µ–º –∫–ª—é—á–∏ –Ω–∞ –∫–æ–ª—å—Ü–µ –ø–æ –∏—Ö —Ö–µ—à—É
3. –ö–∞–∂–¥—ã–π –∫–ª—é—á –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è –±–ª–∏–∂–∞–π—à–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ

#### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è:

```
        Server A (45¬∞)
        ‚Üë
   Key3   Key1
      \ /
Server C ‚Üê ‚Ä¢ ‚Üí Key2
   (270¬∞)    / \
   Key4   Key5
        ‚Üì
    Server B (180¬∞)
```

### üé≤ Virtual Nodes (–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —É–∑–ª—ã)

–î–ª—è –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —É–∑–ª—ã:

```
–ë–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤:
----------------------
Server A: 45¬∞
Server B: 180¬∞
Server C: 270¬∞

–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è!

–° –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ —É–∑–ª–∞–º–∏ (–ø–æ 3 –Ω–∞ —Å–µ—Ä–≤–µ—Ä):
---------------------------------------
Server A: 45¬∞, 120¬∞, 300¬∞
Server B: 60¬∞, 180¬∞, 330¬∞  
Server C: 90¬∞, 210¬∞, 270¬∞

–ù–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è!
```

### üíª –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

```python
import hashlib
import bisect

class ConsistentHash:
    def __init__(self, replicas=3):
        self.replicas = replicas
        self.ring = {}
        self.sorted_keys = []
    
    def _hash(self, key):
        return int(hashlib.md5(key.encode()).hexdigest(), 16)
    
    def add_node(self, node):
        for i in range(self.replicas):
            virtual_key = f"{node}:{i}"
            key = self._hash(virtual_key)
            self.ring[key] = node
            bisect.insort(self.sorted_keys, key)
    
    def remove_node(self, node):
        for i in range(self.replicas):
            virtual_key = f"{node}:{i}"
            key = self._hash(virtual_key)
            del self.ring[key]
            self.sorted_keys.remove(key)
    
    def get_node(self, key):
        if not self.ring:
            return None
        
        hash_key = self._hash(key)
        idx = bisect.bisect_right(self.sorted_keys, hash_key)
        if idx == len(self.sorted_keys):
            idx = 0
        return self.ring[self.sorted_keys[idx]]
```

### üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

```
–°—Ü–µ–Ω–∞—Ä–∏–π: —É–¥–∞–ª–µ–Ω–∏–µ 1 –∏–∑ 4 —Å–µ—Ä–≤–µ—Ä–æ–≤

–û–±—ã—á–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:
--------------------
–ü–µ—Ä–µ–º–µ—â–µ–Ω–æ –∫–ª—é—á–µ–π: 75%
Cache miss rate: 75%

–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:
--------------------------
–ü–µ—Ä–µ–º–µ—â–µ–Ω–æ –∫–ª—é—á–µ–π: 25%
Cache miss rate: 25%

–í—ã–∏–≥—Ä—ã—à –≤ 3 —Ä–∞–∑–∞!
```

---

## üìö –ì–ª–∞–≤–∞ 2: –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

### üîÑ –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–†–µ–ø–ª–∏–∫–∞—Ü–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫—ç—à–∞.

#### Master-Slave —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è:

```
    Client
      ‚Üì
   [Master]     ‚Üê –∑–∞–ø–∏—Å—å
      ‚Üì
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚Üì     ‚Üì     ‚Üì
[Slave1][Slave2][Slave3]  ‚Üê —á—Ç–µ–Ω–∏–µ
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- ‚úÖ –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
- ‚ùå –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ—Ç–∫–∞–∑–∞ (master)
- ‚ùå –í–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ master

#### Master-Master —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è:

```
[Master A] ‚Üî [Master B]
    ‚Üë           ‚Üë
    ‚îî‚îÄ Client ‚îÄ‚îÄ‚îò
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- ‚úÖ –ù–µ—Ç –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ –æ—Ç–∫–∞–∑–∞
- ‚úÖ –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### üóÇÔ∏è –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (Partitioning)

–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É–∑–ª–∞–º–∏ –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.

#### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```
–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
--------------------
User ID: 1-1000   ‚Üí Shard A
User ID: 1001-2000 ‚Üí Shard B  
User ID: 2001-3000 ‚Üí Shard C
User ID: 3001-4000 ‚Üí Shard D
```

#### –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ hash'—É:

```
hash(key) % num_shards = shard_id

Example:
--------
hash("user:123") % 4 = 1 ‚Üí Shard B
hash("user:456") % 4 = 3 ‚Üí Shard D
```

### üîß –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ Failover

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Failover:

```
–ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:
-----------------
Client ‚Üí Master A (–∞–∫—Ç–∏–≤–Ω—ã–π)
         Master B (standby)

–ü–æ—Å–ª–µ –æ—Ç–∫–∞–∑–∞ Master A:
---------------------
Client ‚Üí Master B (–∞–∫—Ç–∏–≤–Ω—ã–π)
         Master A (–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)

–í—Ä–µ–º—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è: 1-5 —Å–µ–∫—É–Ω–¥
```

#### Graceful Degradation:

```
–í—Å–µ 4 —à–∞—Ä–¥–∞ —Ä–∞–±–æ—Ç–∞—é—Ç:
--------------------
Performance: 100%
Capacity: 100%

1 —à–∞—Ä–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
-----------------
Performance: 75%
Capacity: 75%
Strategy: –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ —à–∞—Ä–¥—ã
```

### üíæ Recovery —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

#### Warm Standby:

```
[Primary] ‚Üí sync ‚Üí [Standby]
    ‚Üì               ‚Üì
  Hot cache      Warm cache
  (–≤—Å–µ –¥–∞–Ω–Ω—ã–µ)   (—á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö)

Recovery time: —Å–µ–∫—É–Ω–¥—ã
```

#### Cold Standby:

```
[Primary] ‚Üí backup ‚Üí [Storage]
                        ‚Üì
                   [New instance]
                        ‚Üì
                   –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

Recovery time: –º–∏–Ω—É—Ç—ã/—á–∞—Å—ã
```

---

## üìö –ì–ª–∞–≤–∞ 3: –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### üîÑ Cache-Aside –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ä–µ–¥–µ

```
Application Logic:
------------------

1. –ß—Ç–µ–Ω–∏–µ:
   ‚îå‚îÄ get(key) ‚Üí Cache Cluster
   ‚îÇ              ‚Üì
   ‚îÇ         [Node A][Node B][Node C]
   ‚îÇ              ‚Üì
   ‚îÇ         cache miss/hit
   ‚îÇ              ‚Üì
   ‚îÇ         if miss: ‚Üí Database
   ‚îÇ              ‚Üì
   ‚îÇ         put(key, value) ‚Üí Cache

2. –ó–∞–ø–∏—Å—å:
   ‚îå‚îÄ save(data) ‚Üí Database
   ‚îÇ              ‚Üì
   ‚îÇ         invalidate(key) ‚Üí Cache Cluster
```

#### –ü—Ä–æ–±–ª–µ–º—ã –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ä–µ–¥–µ:

```
Race Condition:
--------------
Thread 1: invalidate(key) ‚Üí [Node A]
Thread 2: get(key) ‚Üí miss ‚Üí DB ‚Üí put(key, old_value)

–†–µ–∑—É–ª—å—Ç–∞—Ç: —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫—ç—à–µ!

–†–µ—à–µ–Ω–∏–µ: –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### üîÑ Write-Through –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```
Write-Through Pattern:
---------------------

Application
    ‚Üì write(key, value)
Cache Cluster
    ‚Üì (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
Database

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
‚úÖ –í—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—ç—à

–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
‚ùå –í—ã—Å–æ–∫–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏
‚ùå –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –∫—ç—à –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏
```

### üîÑ Write-Behind –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```
Write-Behind Pattern:
--------------------

Application
    ‚Üì write(key, value)
Cache Cluster
    ‚Üì (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –±–∞—Ç—á–∞–º–∏)
Database

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å:
------------------
Cache Buffer: [key1, key2, key3, ...]
               ‚Üì (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)
Database: batch_write([key1, key2, key3])
```

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Write-Behind:

```python
import asyncio
from collections import defaultdict

class WriteBehindCache:
    def __init__(self, flush_interval=5):
        self.cache = {}
        self.dirty_keys = set()
        self.flush_interval = flush_interval
        self.running = True
        
    async def put(self, key, value):
        self.cache[key] = value
        self.dirty_keys.add(key)
        
    async def flush_worker(self):
        while self.running:
            if self.dirty_keys:
                # Batch write to database
                await self.flush_to_db(list(self.dirty_keys))
                self.dirty_keys.clear()
            await asyncio.sleep(self.flush_interval)
```

### üîÑ Read-Through –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```
Read-Through Pattern:
--------------------

Application
    ‚Üì get(key)
Cache Cluster
    ‚Üì (–µ—Å–ª–∏ miss)
Database Loader
    ‚Üì
Cache (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

Transparent Loading:
-------------------
def get(key):
    value = cache.get(key)
    if value is None:
        value = database.load(key)
        cache.put(key, value)
    return value
```

---

## üìö –ì–ª–∞–≤–∞ 4: –ü—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

### ‚öñÔ∏è CAP —Ç–µ–æ—Ä–µ–º–∞ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```
CAP Triangle:
            Consistency
                ‚ñ≤
               / \
              /   \
             /     \
            /       \
Availability ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Partition
                   Tolerance

–í —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∫—ç—à–∞—Ö –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å 2 –∏–∑ 3!
```

#### –ü—Ä–∏–º–µ—Ä—ã –≤—ã–±–æ—Ä–∞:

```
CP (Consistency + Partition Tolerance):
--------------------------------------
Redis Cluster –≤ —Å—Ç—Ä–æ–≥–æ–º —Ä–µ–∂–∏–º–µ
- –°–∏–ª—å–Ω–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç —Å—Ç—Ä–∞–¥–∞—Ç—å –ø—Ä–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏

AP (Availability + Partition Tolerance):
---------------------------------------
Memcached –∫–ª–∞—Å—Ç–µ—Ä
- –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
- Eventual consistency

CA (Consistency + Availability):
-------------------------------
–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ä–µ–¥–µ!
```

### üï∞Ô∏è Eventual Consistency

```
–í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ Eventual Consistency:
------------------------------------

T0: Write(key=X, value=1) ‚Üí Node A
T1: Node A ‚Üí sync ‚Üí Node B ‚ùå (network issue)
T2: Read(key=X) from Node B ‚Üí returns old value
T3: Network recovered
T4: Node A ‚Üí sync ‚Üí Node B ‚úÖ
T5: Read(key=X) from Node B ‚Üí returns new value

–ü–µ—Ä–∏–æ–¥ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏: T1-T4
```

#### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏:

```
1. Read Repair:
--------------
Client reads from multiple nodes
If values differ ‚Üí trigger repair

2. Anti-Entropy:
---------------
Background process —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —É–∑–ª—ã

3. Hinted Handoff:
-----------------
–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É–∑–ª–æ–≤
```

### ‚öîÔ∏è Conflict Resolution

#### Last Write Wins (LWW):

```
Timeline:
--------
T1: Node A writes value=100, timestamp=T1
T2: Node B writes value=200, timestamp=T2
T3: Sync occurs

Result: value=200 (T2 > T1)

–ü—Ä–æ–±–ª–µ–º–∞: –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –Ω–µ—Ç–æ—á–Ω—ã—Ö —á–∞—Å–∞—Ö!
```

#### Vector Clocks:

```
Vector Clock Example:
--------------------
Node A: [A:1, B:0, C:0] ‚Üí value=100
Node B: [A:1, B:1, C:0] ‚Üí value=200

–ü—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
- Node B's clock –ø–æ–ª–Ω–æ—Å—Ç—å—é > Node A's clock
- Node B wins: value=200
```

#### CRDT (Conflict-free Replicated Data Types):

```
G-Counter (Grow-only Counter):
-----------------------------
Node A: {A: 5, B: 3, C: 2} = total: 10
Node B: {A: 4, B: 4, C: 2} = total: 10

Merge: {A: max(5,4), B: max(3,4), C: max(2,2)}
     = {A: 5, B: 4, C: 2} = total: 11
```

---

## üõ†Ô∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

```python
# –î–æ–ø–æ–ª–Ω–∏—Ç–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é ConsistentHash
# –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç–æ–¥—ã:
# - get_load_distribution() - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏
# - rebalance() - –ø–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É–∑–ª–æ–≤

class AdvancedConsistentHash(ConsistentHash):
    def get_load_distribution(self):
        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        pass
    
    def rebalance(self):
        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É
        pass
```

### –ó–∞–¥–∞–Ω–∏–µ 2: Distributed Cache —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

```python
# –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å DistributedCache –∫–æ—Ç–æ—Ä—ã–π:
# 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —à–∞—Ä–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
# 2. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é
# 3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–∫–∞–∑—ã —É–∑–ª–æ–≤

class DistributedCache:
    def __init__(self, nodes, replication_factor=2):
        # TODO: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        pass
    
    async def get(self, key):
        # TODO: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å —É—á–µ—Ç–æ–º —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è
        pass
    
    async def put(self, key, value):
        # TODO: –ó–∞–ø–∏—Å—å —Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π
        pass
    
    async def handle_node_failure(self, failed_node):
        # TODO: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–∫–∞–∑–∞ —É–∑–ª–∞
        pass
```

### –ó–∞–¥–∞–Ω–∏–µ 3: –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```python
# –°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–æ—Ç–æ—Ä–∞—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç:
# - Hit/miss ratio –ø–æ —É–∑–ª–∞–º
# - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏
# - –ó–∞–¥–µ—Ä–∂–∫–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
# - –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —É–∑–ª–æ–≤

class CacheMonitor:
    def __init__(self, cache_cluster):
        # TODO: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        pass
    
    def get_metrics(self):
        # TODO: –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫
        pass
    
    def alert_on_issues(self):
        # TODO: –°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤
        pass
```

### –ó–∞–¥–∞–Ω–∏–µ 4: –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# –°–æ–∑–¥–∞–π—Ç–µ benchmark –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
# - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–∞–∑–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —É–∑–ª–æ–≤
# - –ü–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–∫–∞–∑–∞—Ö
# - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

async def benchmark_distributed_cache():
    # TODO: –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –±–µ–Ω—á–º–∞—Ä–∫
    pass
```

---

## üìä –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### Performance Metrics:

```
Throughput:
----------
Requests per second (RPS)
Target: > 100,000 RPS

Latency:
-------
P50: < 1ms
P95: < 5ms  
P99: < 10ms

Consistency:
-----------
Max inconsistency window: < 100ms
Conflict resolution time: < 50ms
```

### Availability Metrics:

```
Uptime:
------
Target: 99.99% (52 minutes downtime/year)

MTTR (Mean Time To Recovery):
----------------------------
Target: < 30 seconds

Data Durability:
---------------
Target: 99.999999999% (11 9's)
```

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –±–ª–æ–∫–∞

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞ –≤—ã —Å–º–æ–∂–µ—Ç–µ:

- üéØ –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—â–∏–µ —Å–∏—Å—Ç–µ–º—ã
- ‚öñÔ∏è –í—ã–±–∏—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ trade-off –º–µ–∂–¥—É –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é  
- üîß –†–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
- üõ°Ô∏è –û–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —á–µ—Ä–µ–∑ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é
- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- üîÑ –†–µ—à–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –°—Ç–∞—Ç—å–∏:
- "Consistent Hashing and Random Trees" - Karger et al.
- "Dynamo: Amazon's Highly Available Key-value Store"
- "The CAP Theorem" - Eric Brewer

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
- Redis Cluster
- Apache Ignite  
- Hazelcast
- Memcached

### Open Source –ø—Ä–æ–µ–∫—Ç—ã:
- Consistent hashing implementations
- Distributed cache benchmarks
- Monitoring tools –¥–ª—è –∫—ç—à–µ–π