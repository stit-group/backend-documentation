# PostgreSQL –ë–ª–æ–∫ 4: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

```
üéØ –¶–ï–õ–¨ –ë–õ–û–ö–ê: –ù–∞—É—á–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –±—ã—Å—Ç—Ä—ã–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
‚è±Ô∏è –ü–†–û–î–û–õ–ñ–ò–¢–ï–õ–¨–ù–û–°–¢–¨: 2-3 –Ω–µ–¥–µ–ª–∏
üìä –°–õ–û–ñ–ù–û–°–¢–¨: –°—Ä–µ–¥–Ω–∏–π-–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å
```

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –±–ª–æ–∫–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ë–õ–û–ö 4: –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ò –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  4.1 ‚Üí –ü–ª–∞–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤            ‚îÇ 4-5 –¥–Ω–µ–π      ‚îÇ
‚îÇ  4.2 ‚Üí –ò–Ω–¥–µ–∫—Å—ã: —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ        ‚îÇ 5-6 –¥–Ω–µ–π      ‚îÇ
‚îÇ  4.3 ‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑                  ‚îÇ 3-4 –¥–Ω—è       ‚îÇ
‚îÇ  4.4 ‚Üí –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤                 ‚îÇ 5-6 –¥–Ω–µ–π      ‚îÇ
‚îÇ  4.5 ‚Üí –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ                    ‚îÇ 4-5 –¥–Ω–µ–π      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 4.1 –ü–ª–∞–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ üîç

### –ß—Ç–æ —Ç–∞–∫–æ–µ –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è?

–ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è - —ç—Ç–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≥–æ, –∫–∞–∫ PostgreSQL –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤–∞—à –∑–∞–ø—Ä–æ—Å.

```
–ó–ê–ü–†–û–° ‚Üí –ü–õ–ê–ù–ò–†–û–í–©–ò–ö ‚Üí –ü–õ–ê–ù –í–´–ü–û–õ–ù–ï–ù–ò–Ø ‚Üí –ò–°–ü–û–õ–ù–ï–ù–ò–ï ‚Üí –†–ï–ó–£–õ–¨–¢–ê–¢
   ‚Üì           ‚Üì              ‚Üì             ‚Üì           ‚Üì
SELECT *    –ê–Ω–∞–ª–∏–∑      [Seq Scan]     –ß—Ç–µ–Ω–∏–µ      –°—Ç—Ä–æ–∫–∏
FROM users  —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏  [Hash Join]    –¥–∞–Ω–Ω—ã—Ö      –¥–∞–Ω–Ω—ã—Ö
WHERE ...   –∏–Ω–¥–µ–∫—Å–æ–≤    [Sort]         —Å –¥–∏—Å–∫–∞
```

### üîß –ö–æ–º–∞–Ω–¥—ã EXPLAIN

#### –ë–∞–∑–æ–≤—ã–π EXPLAIN
```sql
EXPLAIN 
SELECT c.customer_name, COUNT(*)
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_name;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
                                    QUERY PLAN
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 HashAggregate  (cost=58.35..60.35 rows=200 width=64)
   Group Key: c.customer_name
   ->  Hash Join  (cost=22.50..53.35 rows=1000 width=64)
         Hash Cond: (o.customer_id = c.customer_id)
         ->  Seq Scan on orders o  (cost=0.00..18.10 rows=1000 width=4)
         ->  Hash  (cost=13.00..13.00 rows=200 width=68)
               ->  Seq Scan on customers c  (cost=0.00..13.00 rows=200 width=68)
```

#### EXPLAIN ANALYZE (—Å —Ä–µ–∞–ª—å–Ω—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º)
```sql
EXPLAIN (ANALYZE, BUFFERS, VERBOSE)
SELECT c.customer_name, COUNT(*)
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_name;
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —á—Ç–µ–Ω–∏—è –ø–ª–∞–Ω–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ß—Ç–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –°–ù–ò–ó–£ –í–í–ï–†–•                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  HashAggregate ‚Üê‚îÄ‚îÄ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (—Å–∞–º—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–∑–µ–ª)        ‚îÇ
‚îÇ       ‚Üë                                                     ‚îÇ
‚îÇ  Hash Join     ‚Üê‚îÄ‚îÄ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü                       ‚îÇ
‚îÇ    ‚Üô     ‚Üò                                                  ‚îÇ
‚îÇ Seq Scan    Hash                                            ‚îÇ
‚îÇ (orders)    (customers)  ‚Üê‚îÄ‚îÄ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–ª–∏—Å—Ç—å—è –¥–µ—Ä–µ–≤–∞)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üìä –¢–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –ø–ª–∞–Ω–∞—Ö

#### üîç –û–ø–µ—Ä–∞—Ü–∏–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –¢–ò–ü –°–ö–ê–ù–ê      ‚îÇ              –û–ü–ò–°–ê–ù–ò–ï                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Seq Scan         ‚îÇ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –≤—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã    ‚îÇ
‚îÇ Index Scan       ‚îÇ –ß—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å + –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ —Ç–∞–±–ª. ‚îÇ
‚îÇ Index Only Scan  ‚îÇ –î–∞–Ω–Ω—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑ –∏–Ω–¥–µ–∫—Å–∞             ‚îÇ
‚îÇ Bitmap Heap Scan ‚îÇ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
Seq Scan:           Index Scan:         Index Only Scan:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚îÇ     ‚îÇIndex‚îÇ‚îÄ‚îÄ‚îê          ‚îÇIndex‚îÇ
‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ          ‚îÇ All ‚îÇ
‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚îÇ              ‚Üì          ‚îÇData ‚îÇ
‚îÇ –í—Å—è —Ç–∞–±–ª–∏—Ü–∞ ‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇHere ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ Table Heap  ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     –ú–µ–¥–ª–µ–Ω–Ω–æ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        –ë—ã—Å—Ç—Ä–æ
                        –°—Ä–µ–¥–Ω–µ
```

#### üîó –û–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

```sql
-- –†–∞–∑–ª–∏—á–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã JOIN
-- 1. Nested Loop (–≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã)
for each row in table1:
    for each row in table2:
        if join_condition: return row

-- 2. Hash Join (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
create hash_table from smaller_table
for each row in larger_table:
    lookup in hash_table

-- 3. Merge Join (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞-—Å–ª–∏—è–Ω–∏–µ)
sort table1 by join_key
sort table2 by join_key
merge sorted results
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ JOIN:**
```
Nested Loop:          Hash Join:           Merge Join:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê sort
‚îÇ  A  ‚îÇ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ  A  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ  A  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
          ‚Üì           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚Üì       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê sort  ‚îÇ
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ  B  ‚îÇ‚îÄ‚îÄ‚ñ∫[Hash]     ‚îÇ  B  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
     ‚îÇ  B loop ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚Üì
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚Üì                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                [Join]              ‚îÇ  Merge  ‚îÇ
                                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:         –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:        –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- –ú–∞–ª—ã–µ —Ç–∞–±–ª–∏—Ü—ã       - –°—Ä–µ–¥–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã    - –ë–æ–ª—å—à–∏–µ –æ—Ç—Å–æ—Ä—Ç.
- –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å—ã        - –û–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞       - —Ç–∞–±–ª–∏—Ü—ã
                        –º–µ–Ω—å—à–µ –¥—Ä—É–≥–æ–π
```

### ‚ö° –ê–Ω–∞–ª–∏–∑ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

```
cost=0.00..18.10 rows=1000 width=64
 ‚Üë        ‚Üë        ‚Üë         ‚Üë
 ‚îÇ        ‚îÇ        ‚îÇ         ‚îî‚îÄ –°—Ä–µ–¥–Ω—è—è —à–∏—Ä–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏ (–±–∞–π—Ç)
 ‚îÇ        ‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –û–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
 ‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏
```

### üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–∏–∑–∞

```sql
-- –ú–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
EXPLAIN ANALYZE
SELECT p.product_name, c.category_name, COUNT(*) as order_count
FROM products p
JOIN categories c ON p.category_id = c.category_id
JOIN order_items oi ON p.product_id = oi.product_id
WHERE p.price > 100
GROUP BY p.product_name, c.category_name
HAVING COUNT(*) > 5
ORDER BY order_count DESC;
```

**–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üö® –ö–†–ê–°–ù–´–ï –§–õ–ê–ì–ò –í –ü–õ–ê–ù–ê–• –í–´–ü–û–õ–ù–ï–ù–ò–Ø:                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ Seq Scan –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö (>10k —Å—Ç—Ä–æ–∫)               ‚îÇ
‚îÇ ‚Ä¢ –í—ã—Å–æ–∫–æ–µ actual_time vs estimated_time                    ‚îÇ
‚îÇ ‚Ä¢ –ú–Ω–æ–≥–æ —Å—Ç—Ä–æ–∫ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ (rows removed by filter)      ‚îÇ
‚îÇ ‚Ä¢ Nested Loop —Å –±–æ–ª—å—à–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏                         ‚îÇ
‚îÇ ‚Ä¢ Sort –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–æ–ª—å—à–∏–º –æ–±—ä–µ–º–æ–º –¥–∞–Ω–Ω—ã—Ö                   ‚îÇ
‚îÇ ‚Ä¢ Hash –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ–º work_mem                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 4.2 –ò–Ω–¥–µ–∫—Å—ã: —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ üìö

### –¢–∏–ø—ã –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ PostgreSQL

```
–ò–ù–î–ï–ö–°–´ –í POSTGRESQL:
‚îú‚îÄ‚îÄ B-tree (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) ‚îÄ‚îÄ‚îÄ –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–ª—É—á–∞–µ–≤
‚îú‚îÄ‚îÄ Hash ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –¢–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (=)
‚îú‚îÄ‚îÄ GiST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ SP-GiST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –†–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ GIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (JSON, –º–∞—Å—Å–∏–≤—ã)
‚îî‚îÄ‚îÄ BRIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –û—á–µ–Ω—å –±–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã
```

### üå≥ B-tree –∏–Ω–¥–µ–∫—Å—ã (–æ—Å–Ω–æ–≤–Ω—ã–µ)

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ B-tree –∏–Ω–¥–µ–∫—Å–∞
CREATE INDEX idx_products_price ON products(price);
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ B-tree:**
```
                    [50|100]
                   /    |    \
              [25|35]  [75]  [125|150]
             /  |  \    |    /    |    \
        [10][30][40][85]  [110][140][200]
         |   |   |   |     |    |    |
        Data Data...      Data Data Data
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å B-tree:**
```
‚úÖ –ü–û–î–•–û–î–ò–¢ –î–õ–Ø:               ‚ùå –ù–ï –ü–û–î–•–û–î–ò–¢ –î–õ–Ø:
‚Ä¢ =, <, <=, >, >=             ‚Ä¢ LIKE '%text%' (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–µ —Å –Ω–∞—á–∞–ª–∞)
‚Ä¢ BETWEEN                     ‚Ä¢ –§—É–Ω–∫—Ü–∏–∏ –æ—Ç —Å—Ç–æ–ª–±—Ü–∞ (–±–µ–∑ —Ñ—É–Ω–∫—Ü. –∏–Ω–¥–µ–∫—Å–∞)
‚Ä¢ IN                         ‚Ä¢ OR —É—Å–ª–æ–≤–∏—è –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç–æ–ª–±—Ü–∞–º–∏
‚Ä¢ ORDER BY                   ‚Ä¢ –û—á–µ–Ω—å —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç–æ–ª–±—Ü—ã
‚Ä¢ LIKE 'text%'              ‚Ä¢ –ß–∞—Å—Ç–æ –∏–∑–º–µ–Ω—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ
```

### üî§ Hash –∏–Ω–¥–µ–∫—Å—ã

```sql
-- Hash –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
CREATE INDEX idx_users_email_hash ON users USING HASH(email);
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Hash –∏–Ω–¥–µ–∫—Å–∞:**
```
–ó–Ω–∞—á–µ–Ω–∏–µ ‚Üí Hash —Ñ—É–Ω–∫—Ü–∏—è ‚Üí Bucket
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ'john@...'‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇHash ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ Bucket 1‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ'mary@...'‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫         ‚ñ∫‚îÇ Bucket 2‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§              ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ'bob@...' ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫         ‚ñ∫‚îÇ Bucket 3‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–¢–æ–ª—å–∫–æ –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ =
–û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ O(1)
```

### üîç GIN –∏–Ω–¥–µ–∫—Å—ã (–¥–ª—è —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

```sql
-- GIN –¥–ª—è JSON
CREATE INDEX idx_products_attributes_gin 
ON products USING GIN(attributes);

-- GIN –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_products_search_gin 
ON products USING GIN(to_tsvector('english', product_name));

-- GIN –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤
CREATE INDEX idx_tags_gin ON articles USING GIN(tags);
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ GIN:**
```sql
-- –ü–æ–∏—Å–∫ –≤ JSON
SELECT * FROM products 
WHERE attributes @> '{"color": "red"}';

-- –ü–æ–∏—Å–∫ –≤ –º–∞—Å—Å–∏–≤–∞—Ö
SELECT * FROM articles 
WHERE tags && ARRAY['postgresql', 'database'];
```

### üìä BRIN –∏–Ω–¥–µ–∫—Å—ã (–¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü)

```sql
-- BRIN –¥–ª—è –ª–æ–≥–æ–≤ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
CREATE INDEX idx_logs_timestamp_brin 
ON logs USING BRIN(created_at);
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ BRIN:**
```
–§–∏–∑–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Block 1-10  ‚îÇ Block 11-20 ‚îÇ Block 21-30 ‚îÇ Block 31-40 ‚îÇ
‚îÇ 2024-01-01  ‚îÇ 2024-01-02  ‚îÇ 2024-01-03  ‚îÇ 2024-01-04  ‚îÇ
‚îÇ to          ‚îÇ to          ‚îÇ to          ‚îÇ to          ‚îÇ
‚îÇ 2024-01-01  ‚îÇ 2024-01-02  ‚îÇ 2024-01-03  ‚îÇ 2024-01-04  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

BRIN –∏–Ω–¥–µ–∫—Å —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –¥–∏–∞–ø–∞–∑–æ–Ω—ã:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ë–ª–æ–∫–∏ 1-10: MIN=2024-01-01, MAX=2024-01-01                 ‚îÇ
‚îÇ –ë–ª–æ–∫–∏ 11-20: MIN=2024-01-02, MAX=2024-01-02                ‚îÇ
‚îÇ –ë–ª–æ–∫–∏ 21-30: MIN=2024-01-03, MAX=2024-01-03                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üéØ –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

#### –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
```sql
-- –ü–æ—Ä—è–¥–æ–∫ —Å—Ç–æ–ª–±—Ü–æ–≤ –í–ê–ñ–ï–ù!
CREATE INDEX idx_orders_customer_date 
ON orders(customer_id, order_date);

-- –≠—Ç–æ—Ç –∏–Ω–¥–µ–∫—Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è:
-- ‚úÖ WHERE customer_id = 123
-- ‚úÖ WHERE customer_id = 123 AND order_date > '2024-01-01'
-- ‚ùå WHERE order_date > '2024-01-01' (—Ç–æ–ª—å–∫–æ)
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–∞–≤–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞:**
```
–ò–Ω–¥–µ–∫—Å –Ω–∞ (customer_id, order_date):

customer_id ‚îÇ order_date ‚îÇ Row Pointer
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
     1     ‚îÇ 2024-01-01 ‚îÇ ‚îÄ‚îÄ‚ñ∫Row 1
     1     ‚îÇ 2024-01-05 ‚îÇ ‚îÄ‚îÄ‚ñ∫Row 3
     1     ‚îÇ 2024-01-10 ‚îÇ ‚îÄ‚îÄ‚ñ∫Row 7
     2     ‚îÇ 2024-01-02 ‚îÇ ‚îÄ‚îÄ‚ñ∫Row 2
     2     ‚îÇ 2024-01-08 ‚îÇ ‚îÄ‚îÄ‚ñ∫Row 5
```

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
```sql
-- –ò–Ω–¥–µ–∫—Å –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏
CREATE INDEX idx_users_lower_email 
ON users(lower(email));

-- –ò–Ω–¥–µ–∫—Å –Ω–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
CREATE INDEX idx_orders_total_with_tax 
ON orders((total_amount * 1.2));

-- –ß–∞—Å—Ç–∏—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å
CREATE INDEX idx_active_users 
ON users(last_login) 
WHERE status = 'active';
```

### üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
SELECT 
    indexrelname as index_name,
    idx_tup_read as tuples_read,
    idx_tup_fetch as tuples_fetched,
    idx_scan as scans
FROM pg_stat_user_indexes
ORDER BY idx_scan DESC;

-- –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã
SELECT 
    indexrelname as index_name,
    relname as table_name,
    pg_size_pretty(pg_relation_size(indexrelid)) as size
FROM pg_stat_user_indexes 
JOIN pg_index USING (indexrelid)
WHERE idx_scan = 0 
AND indisunique = false;
```

---

## 4.3 –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ üìä

### –†–æ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ PostgreSQL

```
–ü–õ–ê–ù–ò–†–û–í–©–ò–ö –ó–ê–ü–†–û–°–û–í
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –°–¢–ê–¢–ò–°–¢–ò–ö–ê    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ –û–¶–ï–ù–ö–ê –°–¢–†–û–ö    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ –í–´–ë–û–† –ü–õ–ê–ù–ê     ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ –ö–æ–ª-–≤–æ —Å—Ç—Ä–æ–∫  ‚îÇ    ‚îÇ ‚Ä¢ –°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚îÇ    ‚îÇ ‚Ä¢ Seq vs Index  ‚îÇ
‚îÇ ‚Ä¢ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ‚îÇ    ‚îÇ ‚Ä¢ Join size     ‚îÇ    ‚îÇ ‚Ä¢ Join –∞–ª–≥–æ—Ä–∏—Ç–º ‚îÇ
‚îÇ ‚Ä¢ –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è    ‚îÇ    ‚îÇ ‚Ä¢ Sort cost     ‚îÇ    ‚îÇ ‚Ä¢ –ü–æ—Ä—è–¥–æ–∫ Join  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üîÑ –ö–æ–º–∞–Ω–¥–∞ ANALYZE

```sql
-- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
ANALYZE;

-- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
ANALYZE products;

-- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤
ANALYZE products(price, category_id);
```

### üìã –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```sql
-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
SELECT 
    tablename,
    n_tup_ins as inserts,
    n_tup_upd as updates,
    n_tup_del as deletes,
    n_live_tup as live_rows,
    n_dead_tup as dead_rows,
    last_analyze,
    last_autoanalyze
FROM pg_stat_user_tables;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º
SELECT 
    attname as column_name,
    n_distinct,           -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    most_common_vals,     -- –°–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    most_common_freqs,    -- –ß–∞—Å—Ç–æ—Ç—ã —Å–∞–º—ã—Ö —á–∞—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    correlation           -- –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –ø–æ—Ä—è–¥–∫–æ–º
FROM pg_stats 
WHERE tablename = 'products';
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏:**
```
–í—ã—Å–æ–∫–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è (0.9):        –ù–∏–∑–∫–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è (0.1):
–§–∏–∑–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ = –õ–æ–≥–∏—á–µ—Å–∫–∏–π   –§–∏–∑–∏—á–µ—Å–∫–∏–π ‚â† –õ–æ–≥–∏—á–µ—Å–∫–∏–π

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1  ‚îÇ  2  ‚îÇ  3  ‚îÇ  4  ‚îÇ        ‚îÇ  3  ‚îÇ  1  ‚îÇ  4  ‚îÇ  2  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  5  ‚îÇ  6  ‚îÇ  7  ‚îÇ  8  ‚îÇ        ‚îÇ  7  ‚îÇ  5  ‚îÇ  8  ‚îÇ  6  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Index Scan —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω            Index Scan –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω
(–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ)         (—Å–ª—É—á–∞–π–Ω–æ–µ —á—Ç–µ–Ω–∏–µ)
```

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```sql
-- –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
ALTER TABLE products ALTER COLUMN price SET STATISTICS 1000;

-- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
-- –í postgresql.conf:
-- autovacuum_analyze_scale_factor = 0.1  -- 10% –∏–∑–º–µ–Ω–µ–Ω–∏–π
-- autovacuum_analyze_threshold = 50      -- –º–∏–Ω–∏–º—É–º 50 —Å—Ç—Ä–æ–∫
```

---

## 4.4 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ ‚ö°

### üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```
–ò–ï–†–ê–†–•–ò–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò:
1. üìä –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω–¥–µ–∫—Å—ã
2. üîç –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ WHERE —É—Å–ª–æ–≤–∏—è
3. üîó –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ JOIN
4. üìà –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
5. ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞
```

### üîç –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è WHERE —É—Å–ª–æ–≤–∏–π

#### ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
```sql
-- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã
SELECT * FROM products WHERE category_id = 5;

-- ‚úÖ –î–∏–∞–ø–∞–∑–æ–Ω—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
SELECT * FROM orders WHERE order_date BETWEEN '2024-01-01' AND '2024-01-31';

-- ‚úÖ –ü—Ä–µ—Ñ–∏–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫
SELECT * FROM customers WHERE customer_name LIKE 'John%';
```

#### ‚ùå –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
```sql
-- ‚ùå –§—É–Ω–∫—Ü–∏–∏ –≤ WHERE (–±–µ–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞)
SELECT * FROM customers WHERE UPPER(customer_name) = 'JOHN';

-- ‚ùå –ü–æ–∏—Å–∫ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ —Å—Ç—Ä–æ–∫–∏
SELECT * FROM customers WHERE customer_name LIKE '%john%';

-- ‚ùå OR –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç–æ–ª–±—Ü–∞–º–∏
SELECT * FROM products WHERE price > 100 OR category_id = 5;

-- ‚ùå –ù–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–æ —Å NULL
SELECT * FROM orders WHERE customer_id != 123; -- –Ω–µ –Ω–∞–π–¥–µ—Ç NULL
```

### üîÑ –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

#### –ü—Ä–∏–º–µ—Ä 1: OR ‚Üí UNION
```sql
-- ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–æ
SELECT * FROM products 
WHERE price > 1000 OR category_id IN (1,2,3);

-- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ
SELECT * FROM products WHERE price > 1000
UNION
SELECT * FROM products WHERE category_id IN (1,2,3);
```

#### –ü—Ä–∏–º–µ—Ä 2: EXISTS vs IN
```sql
-- ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ —Å –±–æ–ª—å—à–∏–º–∏ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞–º–∏
SELECT * FROM customers c
WHERE c.customer_id IN (
    SELECT o.customer_id FROM orders o WHERE o.total_amount > 1000
);

-- ‚úÖ –û–±—ã—á–Ω–æ –±—ã—Å—Ç—Ä–µ–µ
SELECT * FROM customers c
WHERE EXISTS (
    SELECT 1 FROM orders o 
    WHERE o.customer_id = c.customer_id AND o.total_amount > 1000
);
```

#### –ü—Ä–∏–º–µ—Ä 3: –ò–∑–±–µ–≥–∞–Ω–∏–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤
```sql
-- ‚ùå –ö–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥–∑–∞–ø—Ä–æ—Å
SELECT c.customer_name,
    (SELECT COUNT(*) FROM orders o WHERE o.customer_id = c.customer_id) as order_count
FROM customers c;

-- ‚úÖ JOIN —Å –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π
SELECT c.customer_name, COALESCE(o.order_count, 0) as order_count
FROM customers c
LEFT JOIN (
    SELECT customer_id, COUNT(*) as order_count
    FROM orders
    GROUP BY customer_id
) o ON c.customer_id = o.customer_id;
```

### üîó –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è JOIN –æ–ø–µ—Ä–∞—Ü–∏–π

```sql
-- ‚úÖ –ü–æ—Ä—è–¥–æ–∫ JOIN: –æ—Ç –º–∞–ª–µ–Ω—å–∫–∏—Ö –∫ –±–æ–ª—å—à–∏–º
SELECT p.product_name, c.category_name, COUNT(*)
FROM categories c                    -- –ú–∞–ª–µ–Ω—å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞
JOIN products p ON c.category_id = p.category_id
JOIN order_items oi ON p.product_id = oi.product_id  -- –ë–æ–ª—å—à–∞—è
GROUP BY p.product_name, c.category_name;
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ä—è–¥–∫–∞ JOIN:**
```
–ü–ª–æ—Ö–æ–π –ø–æ—Ä—è–¥–æ–∫:                   –•–æ—Ä–æ—à–∏–π –ø–æ—Ä—è–¥–æ–∫:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ orders      ‚îÇ 1M —Å—Ç—Ä–æ–∫          ‚îÇ categories  ‚îÇ 10 —Å—Ç—Ä–æ–∫
‚îÇ     ‚Üì       ‚îÇ                   ‚îÇ     ‚Üì       ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ                   ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇproducts ‚îÇ ‚îÇ 10K —Å—Ç—Ä–æ–∫         ‚îÇ ‚îÇproducts ‚îÇ ‚îÇ 100 —Å—Ç—Ä–æ–∫
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ                   ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ     ‚Üì       ‚îÇ                   ‚îÇ     ‚Üì       ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ                   ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇcategori.‚îÇ ‚îÇ 10 —Å—Ç—Ä–æ–∫          ‚îÇ ‚îÇorders   ‚îÇ ‚îÇ 1K —Å—Ç—Ä–æ–∫
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ                   ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
–†–µ–∑—É–ª—å—Ç–∞—Ç: 1M √ó 10K –æ–ø–µ—Ä–∞—Ü–∏–π      –†–µ–∑—É–ª—å—Ç–∞—Ç: 10 √ó 100 –æ–ø–µ—Ä–∞—Ü–∏–π
```

### üìä –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

```sql
-- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π
SELECT category_id, AVG(price)
FROM products
WHERE price > 10  -- –§–∏–ª—å—Ç—Ä –î–û –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
GROUP BY category_id
HAVING AVG(price) < 1000;  -- –§–∏–ª—å—Ç—Ä –ü–û–°–õ–ï –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

-- ‚úÖ –ß–∞—Å—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
CREATE INDEX idx_expensive_products 
ON products(category_id) 
WHERE price > 100;
```

---

## 4.5 –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ üóÇÔ∏è

### –ß—Ç–æ —Ç–∞–∫–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?

–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - —ç—Ç–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–æ–ª—å—à–æ–π —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö, –Ω–æ –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —á–∞—Å—Ç–µ–π.

```
–ë–û–õ–¨–®–ê–Ø –¢–ê–ë–õ–ò–¶–ê (100M —Å—Ç—Ä–æ–∫)
            ‚Üì
    –ü–ê–†–¢–ò–¶–ò–û–ù–ò–†–û–í–ê–ù–ò–ï
            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ–ü–∞—Ä—Ç–∏—Ü–∏—è ‚îÇ–ü–∞—Ä—Ç–∏—Ü–∏—è ‚îÇ–ü–∞—Ä—Ç–∏—Ü–∏—è ‚îÇ–ü–∞—Ä—Ç–∏—Ü–∏—è ‚îÇ
‚îÇ   Q1    ‚îÇ   Q2    ‚îÇ   Q3    ‚îÇ   Q4    ‚îÇ
‚îÇ 25M —Å—Ç—Ä–æ–∫‚îÇ 25M —Å—Ç—Ä–æ–∫‚îÇ 25M —Å—Ç—Ä–æ–∫‚îÇ 25M —Å—Ç—Ä–æ–∫‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üóìÔ∏è –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É (Range)

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Ç–∞–±–ª–∏—Ü—ã
CREATE TABLE orders (
    order_id SERIAL,
    customer_id INTEGER,
    order_date DATE NOT NULL,
    total_amount DECIMAL(10,2)
) PARTITION BY RANGE (order_date);

-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π
CREATE TABLE orders_2024_q1 PARTITION OF orders
    FOR VALUES FROM ('2024-01-01') TO ('2024-04-01');

CREATE TABLE orders_2024_q2 PARTITION OF orders
    FOR VALUES FROM ('2024-04-01') TO ('2024-07-01');

CREATE TABLE orders_2024_q3 PARTITION OF orders
    FOR VALUES FROM ('2024-07-01') TO ('2024-10-01');

CREATE TABLE orders_2024_q4 PARTITION OF orders
    FOR VALUES FROM ('2024-10-01') TO ('2025-01-01');
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Range –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
        orders (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞)
               ‚Üì PARTITION BY RANGE (order_date)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ orders_2024_q1 ‚îÇ orders_2024_q2 ‚îÇ orders_2024_q3 ‚îÇ ... ‚îÇ
‚îÇ 2024-01-01     ‚îÇ 2024-04-01     ‚îÇ 2024-07-01     ‚îÇ     ‚îÇ
‚îÇ     TO         ‚îÇ     TO         ‚îÇ     TO         ‚îÇ     ‚îÇ
‚îÇ 2024-04-01     ‚îÇ 2024-07-01     ‚îÇ 2024-10-01     ‚îÇ     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ó–∞–ø—Ä–æ—Å: WHERE order_date = '2024-02-15'
         ‚Üì Partition Pruning
    –°–∫–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ orders_2024_q1
```

### üìù –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Å–ø–∏—Å–∫—É (List)

```sql
-- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ä–µ–≥–∏–æ–Ω—É
CREATE TABLE sales (
    sale_id SERIAL,
    region VARCHAR(50) NOT NULL,
    sale_date DATE,
    amount DECIMAL(10,2)
) PARTITION BY LIST (region);

CREATE TABLE sales_north PARTITION OF sales
    FOR VALUES IN ('North', 'Northeast', 'Northwest');

CREATE TABLE sales_south PARTITION OF sales
    FOR VALUES IN ('South', 'Southeast', 'Southwest');

CREATE TABLE sales_international PARTITION OF sales
    FOR VALUES IN ('Europe', 'Asia', 'Australia');
```

### #Ô∏è‚É£ –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ö–µ—à—É (Hash)

```sql
-- –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
CREATE TABLE user_sessions (
    session_id BIGSERIAL,
    user_id INTEGER NOT NULL,
    created_at TIMESTAMP,
    data JSONB
) PARTITION BY HASH (user_id);

CREATE TABLE user_sessions_0 PARTITION OF user_sessions
    FOR VALUES WITH (MODULUS 4, REMAINDER 0);

CREATE TABLE user_sessions_1 PARTITION OF user_sessions
    FOR VALUES WITH (MODULUS 4, REMAINDER 1);

CREATE TABLE user_sessions_2 PARTITION OF user_sessions
    FOR VALUES WITH (MODULUS 4, REMAINDER 2);

CREATE TABLE user_sessions_3 PARTITION OF user_sessions
    FOR VALUES WITH (MODULUS 4, REMAINDER 3);
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Hash –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
user_id ‚Üí HASH(user_id) % 4 ‚Üí –ü–∞—Ä—Ç–∏—Ü–∏—è

user_id: 1001 ‚Üí hash % 4 = 1 ‚Üí user_sessions_1
user_id: 1002 ‚Üí hash % 4 = 2 ‚Üí user_sessions_2  
user_id: 1003 ‚Üí hash % 4 = 3 ‚Üí user_sessions_3
user_id: 1004 ‚Üí hash % 4 = 0 ‚Üí user_sessions_0

–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏
```

### üîç Partition Pruning (–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π)

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π
EXPLAIN (ANALYZE, BUFFERS)
SELECT * FROM orders 
WHERE order_date BETWEEN '2024-02-01' AND '2024-02-28';
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç —Å partition pruning:**
```
Append  (cost=0.00..41.88 rows=11 width=20) (actual time=0.012..0.014 rows=5 loops=1)
  ->  Seq Scan on orders_2024_q1  (cost=0.00..41.88 rows=11 width=20) (actual time=0.011..0.013 rows=5 loops=1)
       Filter: ((order_date >= '2024-02-01'::date) AND (order_date <= '2024-02-28'::date))

Buffers: shared hit=1
Planning time: 1.131 ms
Execution time: 0.043 ms

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: —Å–∫–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –ø–∞—Ä—Ç–∏—Ü–∏—è!
```

### üîß –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π

```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏
CREATE TABLE orders_2025_q1 PARTITION OF orders
    FOR VALUES FROM ('2025-01-01') TO ('2025-04-01');

-- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏
DROP TABLE orders_2023_q1;

-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ pg_partman)
-- Detach –ø–∞—Ä—Ç–∏—Ü–∏–∏ –¥–ª—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è
ALTER TABLE orders DETACH PARTITION orders_2023_q1;
```

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞—Ä—Ç–∏—Ü–∏–π

```sql
-- –†–∞–∑–º–µ—Ä—ã –ø–∞—Ä—Ç–∏—Ü–∏–π
SELECT 
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size
FROM pg_tables 
WHERE tablename LIKE 'orders_%'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;

-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ –ø–∞—Ä—Ç–∏—Ü–∏—è—Ö
SELECT 
    schemaname,
    tablename,
    n_tup_ins as inserted_rows,
    n_live_tup as live_rows
FROM pg_stat_user_tables 
WHERE relname LIKE 'orders_%';
```

---

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1: –ê–Ω–∞–ª–∏–∑ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
```sql
-- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å:
SELECT c.customer_name, p.product_name, SUM(oi.quantity * oi.price)
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id  
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
WHERE o.order_date >= '2024-01-01'
  AND p.category_id IN (1, 2, 3, 4, 5)
GROUP BY c.customer_name, p.product_name
HAVING SUM(oi.quantity * oi.price) > 1000
ORDER BY SUM(oi.quantity * oi.price) DESC;
```

**–®–∞–≥–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ EXPLAIN ANALYZE
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã
4. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã WHERE –≤ –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –ó–∞–¥–∞–Ω–∏–µ 2: –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ª–æ–≥–æ–≤
```sql
-- –°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–æ–≥–æ–≤
-- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
-- ‚Ä¢ –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º
-- ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π
-- ‚Ä¢ –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏
```

### –ó–∞–¥–∞–Ω–∏–µ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
```sql
-- –ù–∞–π–¥–∏—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã –≤ –≤–∞—à–µ–π –ë–î
-- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –ø–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–Ω–¥–µ–∫—Å–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –æ—Å–≤–æ–µ–Ω–∏—è –±–ª–æ–∫–∞

```
‚ñ° –£–º–µ—é —á–∏—Ç–∞—Ç—å –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
‚ñ° –ü–æ–Ω–∏–º–∞—é —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏ –∏–Ω–¥–µ–∫—Å–æ–≤
‚ñ° –ó–Ω–∞—é –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Ç–∏–ø –∏–Ω–¥–µ–∫—Å–∞
‚ñ° –£–º–µ—é –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å WHERE —É—Å–ª–æ–≤–∏—è
‚ñ° –ü–æ–Ω–∏–º–∞—é –ø—Ä–∏–Ω—Ü–∏–ø—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ JOIN
‚ñ° –ó–Ω–∞—é –æ—Å–Ω–æ–≤—ã –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚ñ° –£–º–µ—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚ñ° –ú–æ–≥—É –≤—ã—è–≤–ª—è—Ç—å –∏ —É—Å—Ç—Ä–∞–Ω—è—Ç—å —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
```

---

## üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ò–ù–°–¢–†–£–ú–ï–ù–¢–´                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ pg_stat_*       ‚îÇ –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ PostgreSQL         ‚îÇ
‚îÇ EXPLAIN ANALYZE ‚îÇ –ê–Ω–∞–ª–∏–∑ –ø–ª–∞–Ω–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è                  ‚îÇ
‚îÇ pgbench         ‚îÇ –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ                  ‚îÇ
‚îÇ pg_stat_statements ‚îÇ –ê–Ω–∞–ª–∏–∑ —Å–∞–º—ã—Ö –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤        ‚îÇ
‚îÇ pgAdmin         ‚îÇ –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞         ‚îÇ
‚îÇ DataGrip        ‚îÇ IDE —Å –∞–Ω–∞–ª–∏–∑–æ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫

**–ë–ª–æ–∫ 5: –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ PostgreSQL**
- –í–≤–µ–¥–µ–Ω–∏–µ –≤ PL/pgSQL
- –§—É–Ω–∫—Ü–∏–∏ –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
- –¢—Ä–∏–≥–≥–µ—Ä—ã –∏ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

```
üéì –†–ï–ó–£–õ–¨–¢–ê–¢ –ë–õ–û–ö–ê 4:
–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ë–î,
—É–º–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
```