# 🐳 Блок 5: Контейнеризация и DevOps в Linux

*Полное руководство по современным технологиям развертывания: от контейнеров до оркестрации и автоматизации доставки*

---

## 🎯 Введение в современную IT-инфраструктуру

### Эволюция развертывания приложений

```
┌─────────────────────────────────────────┐
│        ЭВОЛЮЦИЯ РАЗВЕРТЫВАНИЯ           │
├─────────────────────────────────────────┤
│                                         │
│ 1990-2000: Физические серверы          │
│ ┌─────────────────────┐                 │
│ │ ОС + Приложение     │                 │
│ │ Железо             │                 │
│ └─────────────────────┘                 │
│ • Дорого • Медленно • Неэффективно     │
│                                         │
│ 2000-2010: Виртуализация               │
│ ┌─────────────────────┐                 │
│ │ Гипервизор          │                 │
│ │ ├─ ВМ1 ├─ ВМ2 ├─ ВМ3│                 │
│ │ Железо             │                 │
│ └─────────────────────┘                 │
│ • Лучше • Изоляция • Все еще тяжело    │
│                                         │
│ 2010-сейчас: Контейнеризация           │
│ ┌─────────────────────┐                 │
│ │ Docker Engine       │                 │
│ │ ├─ C1 ├─ C2 ├─ C3   │                 │
│ │ ОС Linux           │                 │
│ └─────────────────────┘                 │
│ • Быстро • Легко • Эффективно          │
└─────────────────────────────────────────┘
```

### Что такое DevOps?

**DevOps** - это не технология, а культура и набор практик, объединяющих разработку (Development) и операции (Operations).

```
┌─────────────────────────────────────────┐
│            ДО DEVOPS                    │
├─────────────────────────────────────────┤
│                                         │
│ Разработчики        Администраторы      │
│      ↓                     ↓            │
│ ┌─────────┐             ┌─────────┐     │
│ │"Работает│             │"Не      │     │
│ │ у меня" │    Стена    │работает"│     │
│ │         │      ║      │         │     │
│ │ Пишут   │      ║      │ Деплоят │     │
│ │ код     │      ║      │ в прод  │     │
│ └─────────┘      ║      └─────────┘     │
│                  ║                      │
│ • Конфликты • Медленно • Ошибки         │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│            С DEVOPS                     │
├─────────────────────────────────────────┤
│                                         │
│        Единая команда                   │
│              ↓                          │
│ ┌─────────────────────────────────────┐ │
│ │ Совместная ответственность          │ │
│ │                                     │ │
│ │ Dev ←→ QA ←→ Ops ←→ Security       │ │
│ │  ↓     ↓     ↓       ↓             │ │
│ │ Автоматизация всех процессов       │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ • Сотрудничество • Быстро • Качество   │
└─────────────────────────────────────────┘
```

---

## 🐳 Глава 5.1: Docker - основы контейнеризации

### Что такое контейнер?

**Контейнер** - это легковесная, переносимая и самодостаточная упаковка приложения со всеми его зависимостями.

```
┌─────────────────────────────────────────┐
│       КОНТЕЙНЕР vs ВИРТУАЛЬНАЯ МАШИНА   │
├─────────────────────────────────────────┤
│                                         │
│ Виртуальная машина:                     │
│ ┌─────────────────────────────────────┐ │
│ │ Приложение                          │ │
│ │ ├─────────────────────────────────┐ │ │
│ │ │ Гостевая ОС (1-2 ГБ)           │ │ │
│ │ └─────────────────────────────────┘ │ │
│ │ Гипервизор                          │ │
│ │ Хостовая ОС                         │ │
│ │ Железо                              │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ Контейнер:                              │
│ ┌─────────────────────────────────────┐ │
│ │ Приложение (МБ)                     │ │
│ │ ├─────────────────────────────────┐ │ │
│ │ │ Только библиотеки и зависимости │ │ │
│ │ └─────────────────────────────────┘ │ │
│ │ Docker Engine                       │ │
│ │ Хостовая ОС                         │ │
│ │ Железо                              │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Архитектура Docker

```
┌─────────────────────────────────────────┐
│           АРХИТЕКТУРА DOCKER            │
├─────────────────────────────────────────┤
│                                         │
│ ┌─────────────┐    ┌─────────────────┐  │
│ │ Docker      │    │ Docker Registry │  │
│ │ Client      │    │ (Docker Hub)    │  │
│ │             │    │                 │  │
│ │ docker run  │    │ ┌─────────────┐ │  │
│ │ docker build│◄──►│ │   Images    │ │  │
│ │ docker pull │    │ │             │ │  │
│ └─────────────┘    │ └─────────────┘ │  │
│       ↕            └─────────────────┘  │
│ ┌─────────────────────────────────────┐ │
│ │ Docker Daemon (dockerd)             │ │
│ │                                     │ │
│ │ ┌─────────┐ ┌─────────┐ ┌─────────┐ │ │
│ │ │Container│ │Container│ │Container│ │ │
│ │ │    1    │ │    2    │ │    3    │ │ │
│ │ └─────────┘ └─────────┘ └─────────┘ │ │
│ │                                     │ │
│ │ ┌─────────────────────────────────┐ │ │
│ │ │          Images Store           │ │ │
│ │ └─────────────────────────────────┘ │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Основные концепции Docker

```
┌─────────────────────────────────────────┐
│          ОСНОВНЫЕ КОНЦЕПЦИИ             │
├─────────────────────────────────────────┤
│                                         │
│ 📦 IMAGE (Образ)                       │
│    ├─ Неизменяемый шаблон              │
│    ├─ Содержит ОС, приложение, зависимости │
│    └─ Создается из Dockerfile          │
│                                         │
│ 🏃 CONTAINER (Контейнер)               │
│    ├─ Запущенный экземпляр образа      │
│    ├─ Изолированное окружение          │
│    └─ Может быть остановлен/удален     │
│                                         │
│ 📋 DOCKERFILE                          │
│    ├─ Инструкции для сборки образа     │
│    ├─ Текстовый файл с командами       │
│    └─ Версионируется как код           │
│                                         │
│ 🌐 REGISTRY (Реестр)                   │
│    ├─ Хранилище образов               │
│    ├─ Docker Hub (публичный)          │
│    └─ Private registries              │
└─────────────────────────────────────────┘
```

### Жизненный цикл контейнера

```
┌─────────────────────────────────────────┐
│         ЖИЗНЕННЫЙ ЦИКЛ КОНТЕЙНЕРА       │
├─────────────────────────────────────────┤
│                                         │
│ 1. CREATE (Создание)                   │
│    docker create image                  │
│    ↓                                    │
│ 2. START (Запуск)                      │
│    docker start container              │
│    ↓                                    │
│ 3. RUNNING (Выполнение)                │
│    Контейнер активен                   │
│    ↓                                    │
│ 4. PAUSE/UNPAUSE (Пауза)               │
│    docker pause/unpause                │
│    ↓                                    │
│ 5. STOP (Остановка)                    │
│    docker stop container               │
│    ↓                                    │
│ 6. REMOVE (Удаление)                   │
│    docker rm container                 │
│                                         │
│ Альтернативный путь:                   │
│ docker run = create + start            │
└─────────────────────────────────────────┘
```

### Docker Layers (Слои)

Образы Docker состоят из слоев, что обеспечивает эффективность хранения и передачи.

```
┌─────────────────────────────────────────┐
│              DOCKER LAYERS              │
├─────────────────────────────────────────┤
│                                         │
│ Образ "my-app:latest"                   │
│ ┌─────────────────────────────────────┐ │
│ │ Layer 4: Конфигурация приложения    │ │
│ ├─────────────────────────────────────┤ │
│ │ Layer 3: Код приложения             │ │
│ ├─────────────────────────────────────┤ │
│ │ Layer 2: Python и зависимости      │ │
│ ├─────────────────────────────────────┤ │
│ │ Layer 1: Базовая ОС Ubuntu          │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ Преимущества слоев:                     │
│ • Переиспользование слоев между образами │
│ • Быстрое скачивание (только новые слои) │
│ • Эффективное хранение на диске         │
│ • Кэширование при сборке                │
└─────────────────────────────────────────┘
```

---

## 🔗 Глава 5.2: Docker Compose и сетевое взаимодействие

### Проблема многоконтейнерных приложений

Современные приложения редко состоят из одного сервиса:

```
┌─────────────────────────────────────────┐
│      ТИПИЧНОЕ ВЕБ-ПРИЛОЖЕНИЕ            │
├─────────────────────────────────────────┤
│                                         │
│ ┌─────────────┐                         │
│ │Load Balancer│ ← Nginx                 │
│ └─────────────┘                         │
│        ↓                                │
│ ┌─────────────┐ ┌─────────────┐         │
│ │  Web App 1  │ │  Web App 2  │ ← Node.js │
│ └─────────────┘ └─────────────┘         │
│        ↓                ↓               │
│ ┌─────────────────────────────┐         │
│ │        Database             │ ← PostgreSQL │
│ └─────────────────────────────┘         │
│                ↓                        │
│ ┌─────────────────────────────┐         │
│ │         Cache               │ ← Redis │
│ └─────────────────────────────┘         │
│                                         │
│ Проблемы без оркестрации:              │
│ • Сложное управление множеством команд  │
│ • Зависимости между сервисами          │
│ • Сетевое взаимодействие               │
│ • Общие тома и переменные              │
└─────────────────────────────────────────┘
```

### Docker Compose решение

**Docker Compose** позволяет описать и управлять многоконтейнерными приложениями через YAML файл.

```
┌─────────────────────────────────────────┐
│           DOCKER COMPOSE                │
├─────────────────────────────────────────┤
│                                         │
│ docker-compose.yml                      │
│ ┌─────────────────────────────────────┐ │
│ │ version: '3.8'                      │ │
│ │ services:                           │ │
│ │   web:                              │ │
│ │     image: nginx                    │ │
│ │     ports:                          │ │
│ │       - "80:80"                     │ │
│ │   app:                              │ │
│ │     build: ./app                    │ │
│ │     depends_on:                     │ │
│ │       - database                    │ │
│ │   database:                         │ │
│ │     image: postgres                 │ │
│ │     environment:                    │ │
│ │       POSTGRES_DB: myapp            │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ Одна команда: docker-compose up        │
│ ↓                                       │
│ • Создает сеть                         │
│ • Запускает все сервисы                │
│ • Настраивает зависимости              │
│ • Управляет жизненным циклом           │
└─────────────────────────────────────────┘
```

### Сетевое взаимодействие в Docker

Docker предоставляет несколько типов сетей для различных сценариев использования.

```
┌─────────────────────────────────────────┐
│           ТИПЫ СЕТЕЙ DOCKER             │
├─────────────────────────────────────────┤
│                                         │
│ 🌉 BRIDGE (по умолчанию)               │
│ ┌─────────────────────────────────────┐ │
│ │ Host OS                             │ │
│ │ ┌─────────────────────────────────┐ │ │
│ │ │ Docker Bridge Network           │ │ │
│ │ │ ┌─────┐ ┌─────┐ ┌─────┐         │ │ │
│ │ │ │ C1  │ │ C2  │ │ C3  │         │ │ │
│ │ │ └─────┘ └─────┘ └─────┘         │ │ │
│ │ └─────────────────────────────────┘ │ │
│ │ • Изоляция контейнеров             │ │
│ │ • NAT для внешнего доступа         │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🏠 HOST                                │
│ ┌─────────────────────────────────────┐ │
│ │ Контейнер использует сеть хоста    │ │
│ │ • Прямой доступ к портам хоста     │ │
│ │ • Максимальная производительность   │ │
│ │ • Меньше изоляции                  │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🚫 NONE                               │
│ ┌─────────────────────────────────────┐ │
│ │ Отсутствие сетевого интерфейса     │ │
│ │ • Полная изоляция                  │ │
│ │ • Только loopback интерфейс        │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Volumes и управление данными

Контейнеры по своей природе временные. Для постоянного хранения данных используются volumes.

```
┌─────────────────────────────────────────┐
│            УПРАВЛЕНИЕ ДАННЫМИ           │
├─────────────────────────────────────────┤
│                                         │
│ 📁 BIND MOUNTS                         │
│ ┌─────────────────────────────────────┐ │
│ │ Host: /home/user/data               │ │
│ │   ↕                                 │ │
│ │ Container: /app/data                │ │
│ └─────────────────────────────────────┘ │
│ • Прямое связывание папок              │
│ • Зависимость от структуры хоста       │
│                                         │
│ 💾 DOCKER VOLUMES                      │
│ ┌─────────────────────────────────────┐ │
│ │ Docker управляемое хранилище        │ │
│ │ /var/lib/docker/volumes/            │ │
│ │   ↕                                 │ │
│ │ Container: /app/data                │ │
│ └─────────────────────────────────────┘ │
│ • Docker управляет расположением       │
│ • Переносимость между системами        │
│ • Лучшая производительность            │
│                                         │
│ 🗂️ TMPFS MOUNTS                       │
│ ┌─────────────────────────────────────┐ │
│ │ Данные в памяти                     │ │
│ │ • Быстрый доступ                    │ │
│ │ • Временные данные                  │ │
│ │ • Безопасность (данные не на диске) │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Безопасность Docker

```
┌─────────────────────────────────────────┐
│           БЕЗОПАСНОСТЬ DOCKER           │
├─────────────────────────────────────────┤
│                                         │
│ 🔐 Принципы безопасности:              │
│                                         │
│ 1. НЕ ЗАПУСКАЙТЕ КАК ROOT              │
│    ┌─────────────────────────────────┐  │
│    │ Создавайте пользователя в образе│  │
│    │ USER appuser                    │  │
│    └─────────────────────────────────┘  │
│                                         │
│ 2. МИНИМАЛЬНЫЕ ОБРАЗЫ                  │
│    ┌─────────────────────────────────┐  │
│    │ alpine, distroless, scratch     │  │
│    │ Меньше уязвимостей              │  │
│    └─────────────────────────────────┘  │
│                                         │
│ 3. СЕКРЕТЫ ВНЕ ОБРАЗОВ                 │
│    ┌─────────────────────────────────┐  │
│    │ Docker secrets, env файлы       │  │
│    │ НЕ в Dockerfile!                │  │
│    └─────────────────────────────────┘  │
│                                         │
│ 4. СКАНИРОВАНИЕ УЯЗВИМОСТЕЙ            │
│    ┌─────────────────────────────────┐  │
│    │ docker scan, Trivy, Snyk        │  │
│    │ Регулярные проверки             │  │
│    └─────────────────────────────────┘  │
│                                         │
│ 5. ОГРАНИЧЕНИЕ РЕСУРСОВ                │
│    ┌─────────────────────────────────┐  │
│    │ --memory, --cpus                │  │
│    │ Предотвращение DoS              │  │
│    └─────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

---

## ☸️ Глава 5.3: Kubernetes - оркестрация контейнеров

### Проблемы, которые решает Kubernetes

Когда у вас сотни контейнеров на десятках серверов, Docker Compose уже не справляется:

```
┌─────────────────────────────────────────┐
│       ПРОБЛЕМЫ МАСШТАБИРОВАНИЯ          │
├─────────────────────────────────────────┤
│                                         │
│ 🖥️ Множество серверов                  │
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐         │
│ │ S1  │ │ S2  │ │ S3  │ │ S4  │         │
│ └─────┘ └─────┘ └─────┘ └─────┘         │
│                                         │
│ ❓ Вопросы:                            │
│ • На какой сервер деплоить?            │
│ • Что делать если сервер упал?         │
│ • Как масштабировать нагрузку?         │
│ • Как обновлять без простоя?           │
│ • Как мониторить состояние?            │
│ • Как управлять конфигурациями?        │
│                                         │
│ 💡 Kubernetes решает все это!          │
└─────────────────────────────────────────┘
```

### Архитектура Kubernetes

```
┌─────────────────────────────────────────┐
│         АРХИТЕКТУРА KUBERNETES          │
├─────────────────────────────────────────┤
│                                         │
│ CONTROL PLANE (Управляющая плоскость)   │
│ ┌─────────────────────────────────────┐ │
│ │ ┌─────────────┐ ┌─────────────────┐ │ │
│ │ │ API Server  │ │ etcd (Database) │ │ │
│ │ └─────────────┘ └─────────────────┘ │ │
│ │ ┌─────────────┐ ┌─────────────────┐ │ │
│ │ │ Scheduler   │ │ Controller      │ │ │
│ │ │             │ │ Manager         │ │ │
│ │ └─────────────┘ └─────────────────┘ │ │
│ └─────────────────────────────────────┘ │
│                  ↕                      │
│ WORKER NODES (Рабочие узлы)            │
│ ┌─────────────┐ ┌─────────────┐         │
│ │   Node 1    │ │   Node 2    │         │
│ │ ┌─────────┐ │ │ ┌─────────┐ │         │
│ │ │ kubelet │ │ │ │ kubelet │ │         │
│ │ │ kube-   │ │ │ │ kube-   │ │         │
│ │ │ proxy   │ │ │ │ proxy   │ │         │
│ │ │ pods    │ │ │ │ pods    │ │         │
│ │ └─────────┘ │ │ └─────────┘ │         │
│ └─────────────┘ └─────────────┘         │
└─────────────────────────────────────────┘
```

### Основные объекты Kubernetes

```
┌─────────────────────────────────────────┐
│         ОБЪЕКТЫ KUBERNETES              │
├─────────────────────────────────────────┤
│                                         │
│ 🚀 POD (Под)                           │
│ ┌─────────────────────────────────────┐ │
│ │ Минимальная единица развертывания   │ │
│ │ ┌─────────┐ ┌─────────┐             │ │
│ │ │Container│ │Container│ (редко >1)  │ │
│ │ │    1    │ │    2    │             │ │
│ │ └─────────┘ └─────────┘             │ │
│ │ • Общая сеть и хранилище           │ │
│ │ • Атомарная единица                │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 📋 DEPLOYMENT                          │
│ ┌─────────────────────────────────────┐ │
│ │ Управляет ReplicaSet'ами            │ │
│ │ ┌─────┐ ┌─────┐ ┌─────┐             │ │
│ │ │ Pod │ │ Pod │ │ Pod │             │ │
│ │ └─────┘ └─────┘ └─────┘             │ │
│ │ • Декларативные обновления         │ │
│ │ • Откат к предыдущим версиям       │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🌐 SERVICE                             │
│ ┌─────────────────────────────────────┐ │
│ │ Сетевая абстракция для подов       │ │
│ │        Load Balancer                │ │
│ │           ↙  ↓  ↘                  │ │
│ │      Pod1  Pod2  Pod3              │ │
│ │ • Постоянный IP и DNS              │ │
│ │ • Балансировка нагрузки            │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Жизненный цикл приложения в Kubernetes

```
┌─────────────────────────────────────────┐
│      ЖИЗНЕННЫЙ ЦИКЛ ПРИЛОЖЕНИЯ          │
├─────────────────────────────────────────┤
│                                         │
│ 1. СОЗДАНИЕ МАНИФЕСТОВ                 │
│    ┌─────────────────────────────────┐  │
│    │ deployment.yaml                 │  │
│    │ service.yaml                    │  │
│    │ configmap.yaml                  │  │
│    └─────────────────────────────────┘  │
│    ↓                                    │
│ 2. ПРИМЕНЕНИЕ (kubectl apply)          │
│    ┌─────────────────────────────────┐  │
│    │ API Server получает манифесты   │  │
│    │ ↓                               │  │
│    │ Валидация и сохранение в etcd   │  │
│    └─────────────────────────────────┘  │
│    ↓                                    │
│ 3. ПЛАНИРОВАНИЕ                        │
│    ┌─────────────────────────────────┐  │
│    │ Scheduler выбирает узлы         │  │
│    │ На основе ресурсов и ограничений│  │
│    └─────────────────────────────────┘  │
│    ↓                                    │
│ 4. РАЗВЕРТЫВАНИЕ                       │
│    ┌─────────────────────────────────┐  │
│    │ kubelet запускает контейнеры    │  │
│    │ kube-proxy настраивает сеть     │  │
│    └─────────────────────────────────┘  │
│    ↓                                    │
│ 5. МОНИТОРИНГ И САМОВОССТАНОВЛЕНИЕ     │
│    ┌─────────────────────────────────┐  │
│    │ Controllers следят за состоянием│  │
│    │ Автоматическое восстановление   │  │
│    └─────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

### ConfigMaps и Secrets

Kubernetes предоставляет механизмы для управления конфигурацией и секретными данными.

```
┌─────────────────────────────────────────┐
│         УПРАВЛЕНИЕ КОНФИГУРАЦИЕЙ        │
├─────────────────────────────────────────┤
│                                         │
│ 📝 CONFIGMAPS                          │
│ ┌─────────────────────────────────────┐ │
│ │ Несекретные данные конфигурации     │ │
│ │                                     │ │
│ │ ┌─────────────────────────────────┐ │ │
│ │ │ app.properties:                 │ │ │
│ │ │ database.host=db.example.com    │ │ │
│ │ │ debug.level=info                │ │ │
│ │ │ max.connections=100             │ │ │
│ │ └─────────────────────────────────┘ │ │
│ │                                     │ │
│ │ Использование:                      │ │
│ │ • Переменные окружения             │ │
│ │ • Файлы в томах                    │ │
│ │ • Аргументы командной строки       │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🔐 SECRETS                             │
│ ┌─────────────────────────────────────┐ │
│ │ Секретные данные (base64 кодировка) │ │
│ │                                     │ │
│ │ ┌─────────────────────────────────┐ │ │
│ │ │ username: YWRtaW4=              │ │ │
│ │ │ password: cGFzc3dvcmQ=          │ │ │
│ │ │ api-key: YWJjZGVmZ2hpams=       │ │ │
│ │ └─────────────────────────────────┘ │ │
│ │                                     │ │
│ │ Типы:                              │ │
│ │ • generic (произвольные данные)    │ │
│ │ • tls (сертификаты)                │ │
│ │ • docker-registry (реестры)       │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

---

## 🔄 Глава 5.4: CI/CD Pipeline

### Что такое CI/CD?

**Continuous Integration/Continuous Deployment** - практика автоматизации процесса интеграции кода и доставки в продакшн.

```
┌─────────────────────────────────────────┐
│            ТРАДИЦИОННЫЙ ПОДХОД          │
├─────────────────────────────────────────┤
│                                         │
│ Разработка (недели/месяцы)              │
│          ↓                              │
│ Ручное тестирование (дни)               │
│          ↓                              │
│ Ручное развертывание (часы)             │
│          ↓                              │
│ Проблемы в продакшне                    │
│                                         │
│ ❌ Проблемы:                            │
│ • Долгие циклы обратной связи          │
│ • Высокий риск ошибок                  │
│ • Конфликты при интеграции             │
│ • Стресс команды                       │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│              CI/CD ПОДХОД               │
├─────────────────────────────────────────┤
│                                         │
│ Commit → Автотесты → Сборка → Деплой   │
│   ↓         ↓         ↓        ↓       │
│ (минуты)  (минуты)  (минуты) (минуты)  │
│                                         │
│ ✅ Преимущества:                        │
│ • Быстрая обратная связь               │
│ • Меньше ошибок                        │
│ • Частые релизы                        │
│ • Уверенность в изменениях             │
└─────────────────────────────────────────┘
```

### Компоненты CI/CD pipeline

```
┌─────────────────────────────────────────┐
│             CI/CD PIPELINE              │
├─────────────────────────────────────────┤
│                                         │
│ 1. SOURCE CONTROL                      │
│ ┌─────────────────────────────────────┐ │
│ │ 📝 Developer commits code           │ │
│ │ 🔄 Git webhook triggers pipeline    │ │
│ └─────────────────────────────────────┘ │
│    ↓                                    │
│ 2. CONTINUOUS INTEGRATION              │
│ ┌─────────────────────────────────────┐ │
│ │ 🔍 Code analysis (linting)          │ │
│ │ 🧪 Unit tests                      │ │
│ │ 🔧 Build application               │ │
│ │ 🐳 Build Docker image              │ │
│ │ 📦 Push to registry                │ │
│ └─────────────────────────────────────┘ │
│    ↓                                    │
│ 3. CONTINUOUS DEPLOYMENT               │
│ ┌─────────────────────────────────────┐ │
│ │ 🧪 Integration tests               │ │
│ │ 🎯 Deploy to staging               │ │
│ │ 🔒 Security scans                  │ │
│ │ ✅ Approval gate                   │ │
│ │ 🚀 Deploy to production            │ │
│ └─────────────────────────────────────┘ │
│    ↓                                    │
│ 4. MONITORING & FEEDBACK               │
│ ┌─────────────────────────────────────┐ │
│ │ 📊 Performance monitoring          │ │
│ │ 🚨 Error tracking                  │ │
│ │ 👥 User feedback                   │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Популярные CI/CD инструменты

```
┌─────────────────────────────────────────┐
│           CI/CD ИНСТРУМЕНТЫ             │
├─────────────────────────────────────────┤
│                                         │
│ 🏗️ JENKINS                             │
│ ┌─────────────────────────────────────┐ │
│ │ • Open source                       │ │
│ │ • Богатая экосистема плагинов       │ │
│ │ │ • Гибкая настройка                │ │
│ │ • Требует администрирования         │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🦊 GITLAB CI/CD                        │
│ ┌─────────────────────────────────────┐ │
│ │ • Интегрировано с Git               │ │
│ │ • YAML конфигурация                 │ │
│ │ • Docker-based runners              │ │
│ │ • Встроенный container registry     │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🔄 GITHUB ACTIONS                      │
│ ┌─────────────────────────────────────┐ │
│ │ • Нативная интеграция с GitHub      │ │
│ │ • Marketplace готовых действий      │ │
│ │ • Матричные стратегии               │ │
│ │ • Хорошая бесплатная квота          │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ☁️ CLOUD-NATIVE (Azure DevOps, AWS)    │
│ ┌─────────────────────────────────────┐ │
│ │ • Интеграция с облачными сервисами  │ │
│ │ • Масштабируемость                  │ │
│ │ │ • Управляемые сервисы             │ │
│ │ • Vendor lock-in                    │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Стратегии развертывания

```
┌─────────────────────────────────────────┐
│         СТРАТЕГИИ РАЗВЕРТЫВАНИЯ         │
├─────────────────────────────────────────┤
│                                         │
│ 🔵 BLUE-GREEN DEPLOYMENT               │
│ ┌─────────────────────────────────────┐ │
│ │ Prod Traffic → Blue (v1.0)          │ │
│ │                Green (v2.0) ← Test  │ │
│ │         ↓ Switch                    │ │
│ │ Prod Traffic → Green (v2.0)         │ │
│ │                Blue (v1.0) ← Standby│ │
│ │                                     │ │
│ │ + Мгновенный откат                  │ │
│ │ + Нулевой downtime                  │ │
│ │ - Требует двойные ресурсы           │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🌊 ROLLING DEPLOYMENT                  │
│ ┌─────────────────────────────────────┐ │
│ │ [v1] [v1] [v1] [v1]                 │ │
│ │  ↓                                  │ │
│ │ [v2] [v1] [v1] [v1]                 │ │
│ │  ↓                                  │ │
│ │ [v2] [v2] [v1] [v1]                 │ │
│ │  ↓                                  │ │
│ │ [v2] [v2] [v2] [v2]                 │ │
│ │                                     │ │
│ │ + Эффективное использование ресурсов│ │
│ │ + Kubernetes default                │ │
│ │ - Временная несовместимость версий  │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🐦 CANARY DEPLOYMENT                   │
│ ┌─────────────────────────────────────┐ │
│ │ 95% Traffic → v1.0                  │ │
│ │  5% Traffic → v2.0 (canary)         │ │
│ │         ↓ Monitor metrics           │ │
│ │ 100% Traffic → v2.0 (if OK)         │ │
│ │                                     │ │
│ │ + Минимальный риск                  │ │
│ │ + Постепенная проверка              │ │
│ │ - Сложная настройка                 │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

---

## 📊 Глава 5.5: Мониторинг и логирование

### Важность мониторинга

В микросервисной архитектуре без мониторинга вы "летите вслепую":

```
┌─────────────────────────────────────────┐
│          ПРОБЛЕМЫ БЕЗ МОНИТОРИНГА       │
├─────────────────────────────────────────┤
│                                         │
│ 😵 "Что происходит в системе?"         │
│ ┌─────────────────────────────────────┐ │
│ │ Service A ←→ Service B ←→ Service C │ │
│ │     ↕           ↕           ↕       │ │
│ │ Database    Cache       Queue       │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ❓ Вопросы без ответов:                │
│ • Какой сервис медленно работает?      │
│ • Где происходят ошибки?               │
│ • Достаточно ли ресурсов?              │
│ • Какие запросы самые популярные?      │
│ • Почему пользователи жалуются?        │
│                                         │
│ 🚨 Результат: Реактивный подход        │
│ • Узнаем о проблемах от пользователей  │
│ • Долгое время восстановления          │ │
│ • Потеря доверия клиентов              │
└─────────────────────────────────────────┘
```

### The Three Pillars of Observability

```
┌─────────────────────────────────────────┐
│      ТРИ СТОЛПА НАБЛЮДАЕМОСТИ           │
├─────────────────────────────────────────┤
│                                         │
│ 📊 METRICS (Метрики)                   │
│ ┌─────────────────────────────────────┐ │
│ │ Численные данные во времени         │ │
│ │                                     │ │
│ │ CPU: 45%  ████████░░ 15:30          │ │
│ │ RAM: 78%  ███████████░ 15:30        │ │
│ │ QPS: 1.2k ▲▲▲▲▲▲▲▲░░ 15:30         │ │
│ │                                     │ │
│ │ • Быстрые запросы                   │ │
│ │ • Дешевое хранение                  │ │
│ │ • Алерты и дашборды                 │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 📝 LOGS (Логи)                        │
│ ┌─────────────────────────────────────┐ │
│ │ Событийные записи                   │ │
│ │                                     │ │
│ │ [ERROR] 2025-01-15 15:30:45         │ │
│ │ Failed to connect to database       │ │
│ │ Connection timeout after 30s        │ │
│ │ User ID: 12345, Request ID: abc-123 │ │
│ │                                     │ │
│ │ • Детальная информация              │ │
│ │ • Контекст ошибок                   │ │
│ │ • Debugging и troubleshooting       │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🔍 TRACES (Трассировки)                │
│ ┌─────────────────────────────────────┐ │
│ │ Путь запроса через систему          │ │
│ │                                     │ │
│ │ Request → API Gateway (5ms)         │ │
│ │    ↓                                │ │
│ │    Auth Service (12ms)              │ │
│ │    ↓                                │ │
│ │    Business Logic (45ms)            │ │
│ │    ↓                                │ │
│ │    Database (123ms) ← BOTTLENECK    │ │
│ │                                     │ │
│ │ • Производительность end-to-end     │ │
│ │ • Выявление узких мест              │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Prometheus и Grafana

**Prometheus** - система мониторинга и алертинга. **Grafana** - платформа для визуализации данных.

```
┌─────────────────────────────────────────┐
│         PROMETHEUS + GRAFANA            │
├─────────────────────────────────────────┤
│                                         │
│ АРХИТЕКТУРА:                            │
│ ┌─────────────────────────────────────┐ │
│ │              Grafana                │ │
│ │         (Визуализация)              │ │
│ └─────────────┬───────────────────────┘ │
│               ↕ PromQL запросы          │
│ ┌─────────────────────────────────────┐ │
│ │             Prometheus              │ │
│ │           (Сбор метрик)             │ │
│ │ ┌─────────────┐ ┌─────────────────┐ │ │
│ │ │    TSDB     │ │   Alert Manager │ │ │
│ │ └─────────────┘ └─────────────────┘ │ │
│ └─────────────┬───────────────────────┘ │
│               ↕ HTTP /metrics           │
│ ┌─────────────────────────────────────┐ │
│ │           Приложения                │ │
│ │ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐     │ │
│ │ │App1 │ │App2 │ │App3 │ │Node │     │ │
│ │ │     │ │     │ │     │ │Exp. │     │ │
│ │ └─────┘ └─────┘ └─────┘ └─────┘     │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ПРИНЦИП РАБОТЫ:                         │
│ 1. Приложения экспортируют метрики      │
│ 2. Prometheus собирает (pull model)     │
│ 3. Хранит в time-series database        │
│ 4. Grafana запрашивает и визуализирует  │
│ 5. Alertmanager отправляет уведомления  │
└─────────────────────────────────────────┘
```

### ELK Stack (Elasticsearch, Logstash, Kibana)

Стек для централизованного сбора, обработки и анализа логов.

```
┌─────────────────────────────────────────┐
│              ELK STACK                  │
├─────────────────────────────────────────┤
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │               Kibana                │ │
│ │          (Визуализация)             │ │
│ │ • Дашборды логов                    │ │
│ │ • Поисковые запросы                 │ │
│ │ • Аналитика и отчеты                │ │
│ └─────────────┬───────────────────────┘ │
│               ↕                         │
│ ┌─────────────────────────────────────┐ │
│ │           Elasticsearch             │ │
│ │       (Хранение и поиск)            │ │
│ │ • Индексирование логов              │ │
│ │ • Полнотекстовый поиск              │ │
│ │ • Агрегация данных                  │ │
│ └─────────────┬───────────────────────┘ │
│               ↕                         │
│ ┌─────────────────────────────────────┐ │
│ │            Logstash                 │ │
│ │      (Обработка логов)              │ │
│ │ • Парсинг различных форматов        │ │
│ │ • Фильтрация и трансформация        │ │
│ │ • Роутинг в разные системы          │ │
│ └─────────────┬───────────────────────┘ │
│               ↕                         │
│ ┌─────────────────────────────────────┐ │
│ │          Источники логов            │ │
│ │ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐     │ │
│ │ │App1 │ │App2 │ │Web  │ │Sys  │     │ │
│ │ │Logs │ │Logs │ │Logs │ │Logs │     │ │
│ │ └─────┘ └─────┘ └─────┘ └─────┘     │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ПОТОК ДАННЫХ:                           │
│ Логи → Logstash → Elasticsearch → Kibana │
└─────────────────────────────────────────┘
```

### Мониторинг в Kubernetes

```
┌─────────────────────────────────────────┐
│        МОНИТОРИНГ KUBERNETES            │
├─────────────────────────────────────────┤
│                                         │
│ 🎯 ЧТО МОНИТОРИТЬ:                     │
│                                         │
│ CLUSTER LEVEL:                          │
│ ┌─────────────────────────────────────┐ │
│ │ • Состояние узлов                   │ │
│ │ • Использование ресурсов кластера   │ │
│ │ • API Server метрики                │ │
│ │ • etcd производительность           │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ NODE LEVEL:                             │
│ ┌─────────────────────────────────────┐ │
│ │ • CPU, Memory, Disk, Network        │ │
│ │ • kubelet метрики                   │ │
│ │ • Container runtime состояние       │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ POD/CONTAINER LEVEL:                    │
│ ┌─────────────────────────────────────┐ │
│ │ • Ресурсы контейнеров               │ │
│ │ • Restart count                     │ │
│ │ • Готовность и живость              │ │
│ │ • Логи приложений                   │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ APPLICATION LEVEL:                      │
│ ┌─────────────────────────────────────┐ │
│ │ • Бизнес-метрики                    │ │
│ │ • Время ответа                      │ │
│ │ • Количество ошибок                 │ │
│ │ • Пользовательские метрики          │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

---

## 🏗️ Глава 5.6: Infrastructure as Code

### Проблемы традиционного управления инфраструктурой

```
┌─────────────────────────────────────────┐
│      ТРАДИЦИОННЫЙ ПОДХОД                │
├─────────────────────────────────────────┤
│                                         │
│ 🖱️ РУЧНОЕ УПРАВЛЕНИЕ                   │
│ ┌─────────────────────────────────────┐ │
│ │ Админ заходит в веб-консоль         │ │
│ │         ↓                           │ │
│ │ Создает сервер кликами              │ │
│ │         ↓                           │ │
│ │ Настраивает сеть вручную            │ │
│ │         ↓                           │ │
│ │ Устанавливает ПО через SSH          │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ❌ ПРОБЛЕМЫ:                            │
│ • Нет версионирования изменений        │
│ • Сложно повторить настройку           │ │
│ • Конфигурационный drift               │
│ • Человеческие ошибки                  │
│ • Медленное масштабирование            │
│ • Отсутствие аудита                    │
│ • Сложность отката изменений           │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│     INFRASTRUCTURE AS CODE             │
├─────────────────────────────────────────┤
│                                         │
│ 📝 ДЕКЛАРАТИВНЫЙ ПОДХОД                │
│ ┌─────────────────────────────────────┐ │
│ │ Описываем желаемое состояние в коде │ │
│ │         ↓                           │ │
│ │ Система автоматически приводит      │ │
│ │ реальность к описанному состоянию   │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ✅ ПРЕИМУЩЕСТВА:                        │
│ • Версионирование через Git            │
│ • Повторяемость развертывания          │
│ • Консистентные окружения              │
│ • Автоматизация и CI/CD                │
│ • Быстрое масштабирование              │
│ • Полный аудит изменений               │
│ • Простой откат к предыдущим версиям   │
└─────────────────────────────────────────┘
```

### Terraform - основы

**Terraform** от HashiCorp - популярный инструмент для управления инфраструктурой как кодом.

```
┌─────────────────────────────────────────┐
│           ПРИНЦИПЫ TERRAFORM            │
├─────────────────────────────────────────┤
│                                         │
│ 🗺️ ДЕКЛАРАТИВНЫЙ ЯЗЫК (HCL)            │
│ ┌─────────────────────────────────────┐ │
│ │ resource "aws_instance" "web" {     │ │
│ │   ami           = "ami-12345"       │ │
│ │   instance_type = "t3.micro"        │ │
│ │   count         = 2                 │ │
│ │                                     │ │
│ │   tags = {                          │ │
│ │     Name = "WebServer"              │ │
│ │     Env  = "production"             │ │
│ │   }                                 │ │
│ │ }                                   │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🔌 PROVIDER MODEL                      │
│ ┌─────────────────────────────────────┐ │
│ │ AWS Provider ←→ AWS API             │ │
│ │ Azure Provider ←→ Azure ARM         │ │
│ │ GCP Provider ←→ Google Cloud API    │ │
│ │ Kubernetes Provider ←→ K8s API      │ │
│ │ + 1000+ провайдеров                 │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 📊 STATE MANAGEMENT                    │
│ ┌─────────────────────────────────────┐ │
│ │ terraform.tfstate                   │ │
│ │ ┌─────────────────────────────────┐ │ │
│ │ │ Текущее состояние инфраструктуры│ │ │
│ │ │ Mapping код ↔ реальные ресурсы  │ │ │
│ │ │ Dependency graph                │ │ │
│ │ └─────────────────────────────────┘ │ │
│ │ • Критически важен для работы      │ │
│ │ • Должен быть в remote backend     │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Жизненный цикл Terraform

```
┌─────────────────────────────────────────┐
│        ЖИЗНЕННЫЙ ЦИКЛ TERRAFORM         │
├─────────────────────────────────────────┤
│                                         │
│ 1. 📝 WRITE (Написание конфигурации)    │
│ ┌─────────────────────────────────────┐ │
│ │ main.tf, variables.tf, outputs.tf  │ │
│ │ Описание желаемой инфраструктуры   │ │
│ └─────────────────────────────────────┘ │
│    ↓                                    │
│ 2. 🔧 INIT (Инициализация)             │
│ ┌─────────────────────────────────────┐ │
│ │ terraform init                      │ │
│ │ • Скачивание провайдеров            │ │
│ │ • Настройка backend                 │ │
│ │ • Инициализация .terraform/         │ │
│ └─────────────────────────────────────┘ │
│    ↓                                    │
│ 3. 📋 PLAN (Планирование)              │
│ ┌─────────────────────────────────────┐ │
│ │ terraform plan                      │ │
│ │ • Сравнение текущего и желаемого    │ │
│ │ • Создание плана изменений          │ │
│ │ • Предварительный просмотр          │ │
│ └─────────────────────────────────────┘ │
│    ↓                                    │
│ 4. ✅ APPLY (Применение)               │
│ ┌─────────────────────────────────────┐ │
│ │ terraform apply                     │ │
│ │ • Выполнение плана изменений        │ │
│ │ • Создание/изменение ресурсов       │ │
│ │ • Обновление state файла            │ │
│ └─────────────────────────────────────┘ │
│    ↓                                    │
│ 5. 🗑️ DESTROY (Уничтожение) [опционально] │
│ ┌─────────────────────────────────────┐ │
│ │ terraform destroy                   │ │
│ │ • Удаление всех управляемых ресурсов│ │
│ │ • Очистка state                     │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Модули Terraform

Модули позволяют создавать переиспользуемые компоненты инфраструктуры.

```
┌─────────────────────────────────────────┐
│           МОДУЛИ TERRAFORM              │
├─────────────────────────────────────────┤
│                                         │
│ СТРУКТУРА МОДУЛЯ:                       │
│ ┌─────────────────────────────────────┐ │
│ │ modules/                            │ │
│ │ └── vpc/                            │ │
│ │     ├── main.tf                     │ │
│ │     ├── variables.tf                │ │
│ │     ├── outputs.tf                  │ │
│ │     └── README.md                   │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ИСПОЛЬЗОВАНИЕ МОДУЛЯ:                   │
│ ┌─────────────────────────────────────┐ │
│ │ module "vpc" {                      │ │
│ │   source = "./modules/vpc"          │ │
│ │                                     │ │
│ │   cidr_block = "10.0.0.0/16"       │ │
│ │   region     = "us-west-2"          │ │
│ │   env        = "production"         │ │
│ │ }                                   │ │
│ │                                     │ │
│ │ module "database" {                 │ │
│ │   source = "./modules/rds"          │ │
│ │                                     │ │
│ │   vpc_id     = module.vpc.vpc_id    │ │
│ │   subnet_ids = module.vpc.private_subnets │
│ │   db_name    = "myapp"              │ │
│ │ }                                   │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ПРЕИМУЩЕСТВА МОДУЛЕЙ:                   │
│ • Переиспользование кода               │
│ • Стандартизация архитектуры           │
│ • Упрощение сложных конфигураций       │
│ • Версионирование компонентов          │
│ • Командная разработка                 │
└─────────────────────────────────────────┘
```

### Remote State и Team Collaboration

```
┌─────────────────────────────────────────┐
│        КОМАНДНАЯ РАБОТА С TERRAFORM     │
├─────────────────────────────────────────┤
│                                         │
│ 🔒 REMOTE STATE BACKEND                │
│ ┌─────────────────────────────────────┐ │
│ │ НЕ В GIT:                          │ │
│ │ • terraform.tfstate                 │ │
│ │ • .terraform/                       │ │
│ │ • *.tfvars (с секретами)            │ │
│ │                                     │ │
│ │ В REMOTE BACKEND:                   │ │
│ │ ┌─────────────────────────────────┐ │ │
│ │ │ • AWS S3 + DynamoDB lock        │ │ │
│ │ │ • Azure Storage                 │ │ │
│ │ │ │ • Terraform Cloud             │ │ │
│ │ │ • HashiCorp Consul              │ │ │
│ │ └─────────────────────────────────┘ │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🔄 WORKFLOW                            │
│ ┌─────────────────────────────────────┐ │
│ │ 1. Developer A: terraform plan      │ │
│ │    ↓                                │ │
│ │ 2. Code Review (Pull Request)       │ │
│ │    ↓                                │ │
│ │ 3. CI/CD: terraform plan            │ │
│ │    ↓                                │ │
│ │ 4. Manual approval                  │ │
│ │    ↓                                │ │
│ │ 5. CI/CD: terraform apply           │ │
│ │    ↓                                │ │
│ │ 6. State автоматически обновляется  │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🛡️ БЕЗОПАСНОСТЬ                       │
│ • Секреты через переменные окружения   │
│ • IAM роли вместо ключей               │
│ • Ограничение доступа к state          │
│ • Аудит изменений через Git            │
└─────────────────────────────────────────┘
```

---

## 🎯 Лучшие практики DevOps

### DevOps культура и принципы

```
┌─────────────────────────────────────────┐
│            DEVOPS КУЛЬТУРА              │
├─────────────────────────────────────────┤
│                                         │
│ 🤝 COLLABORATION (Сотрудничество)      │
│ ┌─────────────────────────────────────┐ │
│ │ • Разрушение силосов                │ │
│ │ • Общие цели и ответственность      │ │
│ │ • Кросс-функциональные команды      │ │
│ │ • Открытая коммуникация             │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🔄 AUTOMATION (Автоматизация)          │
│ ┌─────────────────────────────────────┐ │
│ │ • CI/CD pipeline                    │ │
│ │ • Infrastructure as Code            │ │
│ │ • Автоматическое тестирование       │ │
│ │ • Мониторинг и алертинг             │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 📊 MEASUREMENT (Измерение)             │
│ ┌─────────────────────────────────────┐ │
│ │ • Метрики производительности        │ │
│ │ • MTTR (Mean Time To Recovery)      │ │
│ │ • Deployment frequency              │ │
│ │ • Change failure rate               │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 📚 SHARING (Обмен знаниями)           │
│ ┌─────────────────────────────────────┐ │
│ │ • Документация процессов            │ │
│ │ • Postmortem анализ                 │ │
│ │ • Внутренние конференции            │ │
│ │ • Менторство и knowledge transfer   │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Зрелость DevOps практик

```
┌─────────────────────────────────────────┐
│         УРОВНИ ЗРЕЛОСТИ DEVOPS          │
├─────────────────────────────────────────┤
│                                         │
│ 🥉 НАЧАЛЬНЫЙ (Ad-hoc)                  │
│ ┌─────────────────────────────────────┐ │
│ │ • Ручные деплойменты                │ │
│ │ • Редкие релизы                     │ │
│ │ • Силосная структура команд         │ │
│ │ • Реактивный мониторинг             │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🥈 РАЗВИВАЮЩИЙСЯ (Managed)             │
│ ┌─────────────────────────────────────┐ │
│ │ • Базовая автоматизация CI/CD       │ │
│ │ • Еженедельные релизы               │ │
│ │ │ • Начало кросс-команднного сотрудничества │ │
│ │ • Основные метрики                  │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🥇 ЗРЕЛЫЙ (Defined)                    │
│ ┌─────────────────────────────────────┐ │
│ │ • Полностью автоматизированный CD   │ │
│ │ • Ежедневные релизы                 │ │
│ │ • DevOps команды                    │ │
│ │ • Проактивный мониторинг            │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🏆 ОПТИМИЗИРОВАННЫЙ (Optimizing)       │
│ ┌─────────────────────────────────────┐ │
│ │ • Continuous deployment             │ │
│ │ • Множественные релизы в день       │ │
│ │ • "You build it, you run it"        │ │
│ │ • ML-driven операции                │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Типичные ошибки и антипаттерны

```
┌─────────────────────────────────────────┐
│           DEVOPS АНТИПАТТЕРНЫ           │
├─────────────────────────────────────────┤
│                                         │
│ ❌ "DEVOPS = ИНСТРУМЕНТЫ"               │
│ ┌─────────────────────────────────────┐ │
│ │ Неправильно:                        │ │
│ │ "Купили Jenkins + Docker = DevOps"  │ │
│ │                                     │ │
│ │ Правильно:                          │ │
│ │ Культурная трансформация +          │ │
│ │ подходящие инструменты              │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ❌ "DEVOPS КОМАНДА"                     │
│ ┌─────────────────────────────────────┐ │
│ │ Неправильно:                        │ │
│ │ Создание отдельной "DevOps команды" │ │
│ │ между Dev и Ops                     │ │
│ │                                     │ │
│ │ Правильно:                          │ │
│ │ DevOps - это культура для всех      │ │
│ │ команд, а не отдельная роль         │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ❌ "ТОЛЬКО АВТОМАТИЗАЦИЯ"               │
│ ┌─────────────────────────────────────┐ │
│ │ Неправильно:                        │ │
│ │ Автоматизация плохих процессов      │ │
│ │                                     │ │
│ │ Правильно:                          │ │
│ │ Сначала оптимизация процессов,      │ │
│ │ потом автоматизация                 │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ❌ "ИГНОРИРОВАНИЕ БЕЗОПАСНОСТИ"         │
│ ┌─────────────────────────────────────┐ │
│ │ Неправильно:                        │ │
│ │ "Сначала скорость, потом security"  │ │
│ │                                     │ │
│ │ Правильно:                          │ │
│ │ DevSecOps - встроенная безопасность │ │
│ │ в каждый этап pipeline              │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Метрики успеха DevOps

```
┌─────────────────────────────────────────┐
│           КЛЮЧЕВЫЕ МЕТРИКИ              │
├─────────────────────────────────────────┤
│                                         │
│ 🚀 DEPLOYMENT FREQUENCY                │
│ ┌─────────────────────────────────────┐ │
│ │ Как часто развертываете код?        │ │
│ │                                     │ │
│ │ Elite: Несколько раз в день         │ │
│ │ High:  Раз в неделю - раз в месяц   │ │
│ │ Med:   Раз в месяц - раз в полгода  │ │
│ │ Low:   Реже раза в полгода          │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ⏱️ LEAD TIME FOR CHANGES               │
│ ┌─────────────────────────────────────┐ │
│ │ От коммита до продакшна             │ │
│ │                                     │ │
│ │ Elite: < 1 дня                      │ │
│ │ High:  1 день - 1 неделя            │ │
│ │ Med:   1 неделя - 1 месяц           │ │
│ │ Low:   > 1 месяца                   │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🔧 MEAN TIME TO RECOVERY (MTTR)        │
│ ┌─────────────────────────────────────┐ │
│ │ Время восстановления после сбоя     │ │
│ │                                     │ │
│ │ Elite: < 1 часа                     │ │
│ │ High:  < 1 дня                      │ │
│ │ Med:   1 день - 1 неделя            │ │
│ │ Low:   > 1 недели                   │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 💥 CHANGE FAILURE RATE                 │
│ ┌─────────────────────────────────────┐ │
│ │ % деплойментов, требующих hotfix    │ │
│ │                                     │ │
│ │ Elite: 0-15%                        │ │
│ │ High:  16-30%                       │ │
│ │ Med:   31-45%                       │ │
│ │ Low:   > 45%                        │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

---

## 🚀 Заключение и следующие шаги

### Что вы изучили в этом блоке

```
┌─────────────────────────────────────────┐
│           ПОЛУЧЕННЫЕ НАВЫКИ             │
├─────────────────────────────────────────┤
│                                         │
│ 🐳 Контейнеризация                     │
│   ├─ Понимание Docker архитектуры       │
│   ├─ Создание и управление образами     │
│   ├─ Docker Compose для многоконт. прил.│
│   └─ Сетевое взаимодействие и тома      │
│                                         │
│ ☸️ Оркестрация с Kubernetes            │
│   ├─ Архитектура кластера              │
│   ├─ Основные объекты (Pods, Services)  │
│   ├─ Deployments и управление релизами  │
│   └─ ConfigMaps и Secrets               │
│                                         │
│ 🔄 CI/CD Pipeline                      │
│   ├─ Принципы непрерывной интеграции    │
│   ├─ Автоматизация тестирования         │
│   ├─ Стратегии развертывания            │
│   └─ Популярные инструменты CI/CD       │
│                                         │
│ 📊 Мониторинг и логирование            │
│   ├─ Three Pillars of Observability    │
│   ├─ Prometheus + Grafana               │
│   ├─ ELK Stack для логов               │
│   └─ Мониторинг Kubernetes              │
│                                         │
│ 🏗️ Infrastructure as Code             │
│   ├─ Принципы IaC                      │
│   ├─ Terraform основы                  │
│   ├─ Модули и переиспользование         │
│   └─ Remote state и командная работа    │
│                                         │
│ 📈 DevOps культура                     │
│   ├─ Принципы и практики               │
│   ├─ Метрики успеха                    │
│   ├─ Лучшие практики                   │
│   └─ Избежание антипаттернов            │
└─────────────────────────────────────────┘
```

### Практические проекты для закрепления

```
┌─────────────────────────────────────────┐
│          ПРОЕКТЫ ДЛЯ ПРАКТИКИ           │
├─────────────────────────────────────────┤
│                                         │
│ 1️⃣ МИКРОСЕРВИСНОЕ ПРИЛОЖЕНИЕ           │
│ ┌─────────────────────────────────────┐ │
│ │ • Frontend (React)                  │ │
│ │ • Backend API (Node.js/Python)     │ │
│ │ │ • База данных (PostgreSQL)       │ │
│ │ • Redis для кэширования             │ │
│ │ • Контейнеризация с Docker          │ │
│ │ • Развертывание в Kubernetes        │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 2️⃣ CI/CD PIPELINE                      │
│ ┌─────────────────────────────────────┐ │
│ │ • GitHub/GitLab интеграция          │ │
│ │ • Автоматические тесты              │ │
│ │ • Сборка Docker образов             │ │
│ │ • Развертывание в staging/prod      │ │
│ │ • Rollback механизм                 │ │
│ │ • Уведомления в Slack               │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 3️⃣ МОНИТОРИНГ СТЭК                    │ │
│ ┌─────────────────────────────────────┐ │
│ │ • Prometheus для метрик             │ │
│ │ • Grafana дашборды                  │ │
│ │ • ELK Stack для логов               │ │
│ │ • Alertmanager для уведомлений      │ │
│ │ • Jaeger для трассировки            │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 4️⃣ INFRASTRUCTURE AS CODE              │
│ ┌─────────────────────────────────────┐ │
│ │ • Terraform для облачной инфры      │ │
│ │ • Модули для переиспользования      │ │
│ │ • Multi-environment setup          │ │
│ │ • Remote state в S3/Azure           │ │
│ │ • CI/CD для Terraform               │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### Переход к следующему блоку

Вы готовы к изучению **Блока 6: Производительность и безопасность**, где углубитесь в:

```
┌─────────────────────────────────────────┐
│        БЛОК 6: ПРЕДВАРИТЕЛЬНЫЙ ОБЗОР    │
├─────────────────────────────────────────┤
│                                         │
│ ⚡ Тюнинг производительности системы   │
│   ├─ Анализ узких мест                  │
│   ├─ Оптимизация ядра Linux             │
│   └─ Профилирование приложений          │
│                                         │
│ 🔍 Анализ логов и troubleshooting      │
│   ├─ Системные логи и journalctl        │
│   ├─ Ротация и архивирование            │
│   └─ Методология решения проблем        │
│                                         │
│ 🛡️ Сетевая безопасность               │
│   ├─ iptables и firewalld               │
│   ├─ Защита от DDoS                     │
│   └─ VPN и туннелирование               │
│                                         │
│ 🔐 Системная безопасность              │
│   ├─ SELinux и AppArmor                 │
│   ├─ Управление сертификатами           │
│   └─ Hardening Linux систем             │
│                                         │
│ 💾 Резервное копирование               │
│   ├─ Стратегии backup                  │
│   ├─ LVM snapshots                     │
│   └─ Disaster Recovery планы            │
│                                         │
│ 🏗️ Высокая доступность                │
│   ├─ Кластеризация                     │
│   ├─ Load balancing                    │
│   └─ Отказоустойчивость                │
└─────────────────────────────────────────┘
```

### Рекомендации для продолжения обучения

- **Практикуйтесь ежедневно**: Создавайте контейнеры, разворачивайте Kubernetes кластеры
- **Изучайте облачные платформы**: AWS, Azure, GCP для практики с реальными сценариями
- **Участвуйте в Open Source**: Контрибьютьте в проекты Docker, Kubernetes
- **Следите за трендами**: Cloud Native Computing Foundation, DevOps конференции
- **Получайте сертификации**: CKA, CKAD, Docker Certified Associate

**Поздравляем! Вы освоили современные технологии контейнеризации и DevOps! 🎉**