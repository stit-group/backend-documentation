# Linux Блок 2: Системное администрирование
## Полное руководство по управлению системой

---

### 📋 Содержание блока
- **Продолжительность:** 3-4 месяца
- **Цель:** Научиться управлять системой и пользователями
- **Уровень:** Уверенный пользователь → Системный администратор

---

## 👥 Глава 2.1: Управление пользователями и группами

### Концепция многопользовательской системы

Linux изначально создавался как **многопользовательская система** - представьте ее как большой офисный центр:

```
                    LINUX СИСТЕМА
                         │
        ┌────────────────┼────────────────┐
        │                │                │
    👤 USER1          👤 USER2         👤 USER3
    │                   │                │
 🏠 /home/user1    🏠 /home/user2   🏠 /home/user3
    │                   │                │
 📁 Личные файлы   📁 Личные файлы  📁 Личные файлы
```

### Архитектура пользователей

```
┌─────────────────────────────────────────┐
│              ИЕРАРХИЯ ДОСТУПА           │
├─────────────────────────────────────────┤
│                                         │
│    👑 ROOT (UID 0)                      │
│    ├─ Полный контроль                   │
│    ├─ Может всё                         │
│    └─ Опасен при неосторожности         │
│                                         │
│    🔧 СИСТЕМНЫЕ ПОЛЬЗОВАТЕЛИ (UID 1-999)│
│    ├─ Службы и демоны                   │
│    ├─ Не для входа людей                │
│    └─ Безопасность системы              │
│                                         │
│    👤 ОБЫЧНЫЕ ПОЛЬЗОВАТЕЛИ (UID 1000+)  │
│    ├─ Реальные люди                     │
│    ├─ Ограниченные права                │
│    └─ Безопасная работа                 │
│                                         │
└─────────────────────────────────────────┘
```

### Анатомия пользователя в системе

Каждый пользователь в Linux - это **набор атрибутов**:

```
ПОЛЬЗОВАТЕЛЬ = ИМЯ + UID + ГРУППА + ДОМ + ОБОЛОЧКА
      │         │     │      │       │       │
      │         │     │      │       │       └─ /bin/bash
      │         │     │      │       └─ /home/username
      │         │     │      └─ Основная группа
      │         │     └─ Уникальный номер (1000, 1001...)
      │         └─ Читаемое имя (john, mary...)
      └─ Запись в /etc/passwd
```

### Группы как команды в организации

Группы в Linux работают как **отделы в компании**:

```
                    ОРГАНИЗАЦИЯ LINUX
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
   📊 SALES           🔧 DEVELOPERS      🛡️ ADMINS
   (группа sales)    (группа dev)      (группа wheel)
        │                  │                  │
    👤 Alice           👤 Bob             👤 Charlie
    👤 David           👤 Eve             👤 Frank
        │                  │                  │
    📁 /sales/         📁 /projects/      📁 /etc/
    данные            исходный код      конфигурации
```

### Файлы конфигурации пользователей

```
┌─────────────────────────────────────────────────────────┐
│                  СИСТЕМА УЧЕТНЫХ ЗАПИСЕЙ                │
├─────────────────┬───────────────────────────────────────┤
│ /etc/passwd     │ 📋 Основная информация о пользователях│
│                 │    username:x:UID:GID:info:home:shell │
├─────────────────┼───────────────────────────────────────┤
│ /etc/shadow     │ 🔒 Зашифрованные пароли и политики   │
│                 │    username:$6$hash:days:min:max...   │
├─────────────────┼───────────────────────────────────────┤
│ /etc/group      │ 👥 Информация о группах               │
│                 │    groupname:x:GID:members            │
├─────────────────┼───────────────────────────────────────┤
│ /etc/gshadow    │ 🔐 Пароли групп (редко используется)  │
└─────────────────┴───────────────────────────────────────┘
```

### Жизненный цикл пользователя

```
СОЗДАНИЕ ──→ ИСПОЛЬЗОВАНИЕ ──→ МОДИФИКАЦИЯ ──→ УДАЛЕНИЕ
    │             │                │            │
    ▼             ▼                ▼            ▼
┌─────────┐  ┌─────────┐     ┌─────────┐  ┌─────────┐
│useradd  │  │Работа   │     │usermod  │  │userdel  │
│         │  │системы  │     │passwd   │  │         │
│+ домашняя│  │входы   │     │права    │  │+ cleanup│
│+ группа │  │файлы    │     │группы   │  │файлы    │
│+ права  │  │процессы │     │оболочка │  │процессы │
└─────────┘  └─────────┘     └─────────┘  └─────────┘
```

### Переключение между пользователями

**su (Switch User)** - как **смена ролей в театре**:

```
👤 Обычный пользователь
          │
          │ su - root
          ▼
    👑 Администратор
          │
          │ exit
          ▼
👤 Обратно к пользователю
```

**sudo** - как **временная доверенность**:

```
👤 Пользователь ──→ sudo команда ──→ 🔒 Проверка ──→ ⚡ Выполнение
         │                              │              │
    Запрос права          Есть ли в sudoers?      Выполнить как root
```

---

## 🔐 Глава 2.2: Права доступа и безопасность

### Концепция прав доступа

Права доступа в Linux - это как **система пропусков в здании**:

```
                    ФАЙЛ/КАТАЛОГ
                         │
        ┌────────────────┼────────────────┐
        │                │                │
    👤 ВЛАДЕЛЕЦ      👥 ГРУППА         🌍 ОСТАЛЬНЫЕ
    (owner)          (group)           (others)
        │                │                │
    rwx (7)          r-x (5)          r-- (4)
    │││              │││              │││
    │││              │└┘              │└┘
    ││└─ execute     └─ read          └─ read
    │└── write         execute          (no write)
    └─── read          (no write)       (no execute)
```

### Визуализация прав доступа

```
-rwxr-xr-- 1 user group 1024 Jan 15 10:30 myfile.txt
│││││││││
│└┴┴┴┴┴┴┴─ Права доступа (9 символов)
└────────── Тип файла (- обычный, d каталог, l ссылка)

Разбор прав:
rwx  r-x  r--
│││  │││  │││
│││  │││  ││└─ others: read
│││  │││  │└── others: no write  
│││  │││  └─── others: no execute
│││  ││└────── group: execute
│││  │└─────── group: no write
│││  └──────── group: read
││└─────────── owner: execute
│└──────────── owner: write
└───────────── owner: read
```

### Числовая запись прав

```
┌─────────────────────────────────────┐
│        ЧИСЛОВАЯ СИСТЕМА ПРАВ        │
├─────┬─────┬─────┬─────────────────┤
│ Bin │ Oct │ Sym │   Значение      │
├─────┼─────┼─────┼─────────────────┤
│ 000 │  0  │ --- │ Нет доступа     │
│ 001 │  1  │ --x │ Только запуск   │
│ 010 │  2  │ -w- │ Только запись   │
│ 011 │  3  │ -wx │ Запись+запуск   │
│ 100 │  4  │ r-- │ Только чтение   │
│ 101 │  5  │ r-x │ Чтение+запуск   │
│ 110 │  6  │ rw- │ Чтение+запись   │
│ 111 │  7  │ rwx │ Полный доступ   │
└─────┴─────┴─────┴─────────────────┘
```

**Практический пример:**
```
chmod 755 script.sh
  │││
  ││└─ others: r-x (5) = могут читать и запускать
  │└── group:  r-x (5) = могут читать и запускать  
  └─── owner:  rwx (7) = может всё
```

### Специальные биты - продвинутая безопасность

```
┌──────────────────────────────────────────────────┐
│                СПЕЦИАЛЬНЫЕ БИТЫ                  │
├──────────────┬───────────────────────────────────┤
│ SUID (4000)  │ 🔐 Запуск от имени владельца      │
│              │    Пример: passwd команда         │
├──────────────┼───────────────────────────────────┤
│ SGID (2000)  │ 👥 Запуск от имени группы         │
│              │    Новые файлы → группа каталога  │
├──────────────┼───────────────────────────────────┤
│ Sticky (1000)│ 🗑️ Только владелец может удалить  │
│              │    Пример: /tmp каталог           │
└──────────────┴───────────────────────────────────┘
```

**Визуализация SUID:**
```
Обычная команда:           SUID команда (passwd):
👤 user ──→ 🔧 program     👤 user ──→ 🔧 passwd ──→ 👑 root права
     │           │              │          │            │
  user права  user права    user права  root права   изменение
                                                      /etc/shadow
```

### Access Control Lists (ACL)

ACL - это как **детализированные пропуска** вместо простых ключей:

```
СТАНДАРТНЫЕ ПРАВА              РАСШИРЕННЫЕ ACL
       │                             │
   ┌───▼───┐                     ┌───▼───┐
   │Owner  │                     │Alice: rwx│
   │Group  │ ──→ Ограничено ──→  │Bob:   r--│
   │Others │                     │Dev:   rw-│
   └───────┘                     │HR:    ---│
                                 └─────────┘
```

### Философия sudo

sudo реализует принцип **минимальных привилегий**:

```
    БЕЗ SUDO               С SUDO
        │                    │
    ┌───▼───┐            ┌───▼───┐
    │👤 user │            │👤 user │
    │   ↓   │            │   ↓   │
    │su -   │ ─────→     │sudo   │ ─ Лучше!
    │   ↓   │            │cmd    │
    │👑 root│            │   ↓   │
    │сессия │            │👤 user│
    └───────┘            └───────┘
   Опасно -              Временно -
   постоянные           только одна
   root права           команда
```

---

## ⚡ Глава 2.3: Процессы и управление ресурсами

### Что такое процесс?

Процесс - это **работающая программа** в памяти компьютера:

```
ПРОГРАММА НА ДИСКЕ ──→ ЗАГРУЗКА В ПАМЯТЬ ──→ ПРОЦЕСС
        │                      │                │
   📁 executable           🧠 RAM loading    ⚡ running
   статический             динамический       активный
```

### Иерархия процессов - семейное дерево

```
                    init (PID 1)
                    🌳 Корень системы
                         │
        ┌────────────────┼────────────────┐
        │                │                │
    systemd          kernel threads    user login
   (системные         (ядро)          (пользователь)
    службы)               │                │
        │                 │                │
    ┌───┴───┐             │            ┌───┴───┐
   ssh   cron             │           bash   firefox
   │     │                │            │       │
daemon timer              │         commands  tabs
                          │
                    [ksoftirqd/0]
                    [migration/0]
```

### Состояния процессов

```
┌─────────────────────────────────────────┐
│             ЖИЗНЕННЫЙ ЦИКЛ ПРОЦЕССА     │
├─────────────────────────────────────────┤
│                                         │
│    СОЗДАНИЕ ──→ ВЫПОЛНЕНИЕ ──→ ЗАВЕРШЕНИЕ│
│        │            │             │     │
│        ▼            ▼             ▼     │
│   ┌─────────┐  ┌─────────┐  ┌─────────┐ │
│   │STARTING │  │RUNNING  │  │FINISHED │ │
│   │   (S)   │  │   (R)   │  │   (Z)   │ │
│   └─────────┘  └─────────┘  └─────────┘ │
│        │            │             │     │
│        │            ▼             │     │
│        │       ┌─────────┐        │     │
│        │       │SLEEPING │        │     │
│        │       │   (S)   │        │     │
│        │       └─────────┘        │     │
│        │            │             │     │
│        └────────────┼─────────────┘     │
│                     │                   │
│                ┌─────────┐              │
│                │STOPPED  │              │
│                │   (T)   │              │
│                └─────────┘              │
└─────────────────────────────────────────┘
```

### Просмотр процессов - детективная работа

```
ps ──→ Снимок процессов      top ──→ Живой мониторинг
│      (фотография)          │       (видеонаблюдение)
│                            │
▼                            ▼
PID USER CMD                 Обновление каждые
123 root ssh                 несколько секунд:
456 user firefox             CPU, память, время
789 user bash                сортировка по загрузке
```

### Сигналы - язык общения с процессами

Сигналы как **команды дирижера оркестру**:

```
┌─────────────────────────────────────────────────┐
│                  СИГНАЛЫ                        │
├──────┬────────────┬─────────────────────────────┤
│ №    │ Название   │ Действие                    │
├──────┼────────────┼─────────────────────────────┤
│  1   │ SIGHUP     │ 🔄 Перезагрузить конфигурацию│
│  2   │ SIGINT     │ ⚡ Прервать (Ctrl+C)        │
│  9   │ SIGKILL    │ 💀 Убить немедленно         │
│ 15   │ SIGTERM    │ 🚪 Вежливо завершить        │
│ 18   │ SIGCONT    │ ▶️  Продолжить выполнение    │
│ 19   │ SIGSTOP    │ ⏸️  Приостановить           │
└──────┴────────────┴─────────────────────────────┘
```

**Философия сигналов:**
```
SIGTERM ──→ "Пожалуйста, завершись"
           (процесс может убраться)
              │
              ▼
         ⏱️ Ждем...
              │
              ▼
SIGKILL ──→ "Завершись НЕМЕДЛЕННО!"
           (ядро убивает процесс)
```

### Фоновые процессы и демоны

```
ИНТЕРАКТИВНЫЕ ПРОЦЕССЫ    ФОНОВЫЕ ПРОЦЕССЫ    ДЕМОНЫ
        │                        │              │
    ┌───▼───┐                ┌───▼───┐      ┌───▼───┐
    │терминал│               │без     │      │системные│
    │привязан │               │терминала│     │службы  │
    │пользов. │               │&       │      │автозапуск│
    │ввод/выв.│               │nohup   │      │/etc/init│
    └───────┘                └───────┘      └───────┘
        │                        │              │
    Ctrl+C                   jobs/bg/fg     systemctl
    убивает                  управление     управление
```

### Мониторинг ресурсов

```
┌─────────────────────────────────────────────────────┐
│                СИСТЕМНЫЕ РЕСУРСЫ                    │
├─────────────┬───────────────────────────────────────┤
│ CPU         │ 📊 top, htop - загрузка процессора   │
│             │    vmstat - статистика виртуальной   │
│             │    памяти                            │
├─────────────┼───────────────────────────────────────┤
│ ПАМЯТЬ      │ 🧠 free - использование RAM/swap     │
│             │    /proc/meminfo - детальная info    │
├─────────────┼───────────────────────────────────────┤
│ ДИСК        │ 💾 df - использование файловых систем│
│             │    du - размер каталогов             │
│             │    iostat - статистика I/O           │
├─────────────┼───────────────────────────────────────┤
│ СЕТЬ        │ 🌐 netstat - сетевые соединения      │
│             │    ss - современная замена netstat   │
└─────────────┴───────────────────────────────────────┘
```

---

## ⏰ Глава 2.4: Планировщики задач

### Концепция автоматизации

Планировщики задач - это **будильники для компьютера**:

```
ЧЕЛОВЕК                    КОМПЬЮТЕР
   │                          │
   🕐 "В 3 утра"             🤖 cron
   📝 "проверь почту"        📧 script
   💤 спит...                ⚡ выполняет
   🌅 результат готов        📊 отчет готов
```

### Cron - мастер времени

```
┌─────────────────────────────────────────┐
│              CRON СИНТАКСИС             │
├─────────────────────────────────────────┤
│ минута час день месяц день_недели команда│
│   │     │   │    │        │        │    │
│   │     │   │    │        │        │    │
│ 0-59  0-23 1-31 1-12    0-7       что   │
│   │     │   │    │        │      делать  │
│   │     │   │    │        └─ (0=воскр.) │
│   │     │   │    └─ янв-дек              │
│   │     │   └─ 1-31 число                │
│   │     └─ час (24-часовой формат)       │
│   └─ минута                              │
└─────────────────────────────────────────┘
```

### Примеры cron расписаний

```
┌──────────────────────────────────────────────────────┐
│                 ПРИМЕРЫ CRON                         │
├────────────────┬─────────────────────────────────────┤
│ 0 2 * * *      │ 🌙 Каждый день в 2:00 ночи         │
│ */15 * * * *   │ ⏰ Каждые 15 минут                  │
│ 0 9 * * 1-5    │ 🏢 Рабочие дни в 9:00               │
│ 0 0 1 * *      │ 📅 Первое число каждого месяца      │
│ 30 23 * * 0    │ 🕐 Воскресенье в 23:30              │
└────────────────┴─────────────────────────────────────┘
```

### Жизненный цикл cron задачи

```
СОЗДАНИЕ ──→ ПЛАНИРОВАНИЕ ──→ ВЫПОЛНЕНИЕ ──→ ЛОГИРОВАНИЕ
    │              │              │              │
    ▼              ▼              ▼              ▼
┌─────────┐   ┌─────────┐    ┌─────────┐   ┌─────────┐
│crontab  │   │crond    │    │задача   │   │/var/log/│
│-e       │   │демон    │    │запущена │   │cron     │
│редактор │   │ждет     │    │выполн.  │   │syslog   │
└─────────┘   └─────────┘    └─────────┘   └─────────┘
```

### Типы crontab файлов

```
ПОЛЬЗОВАТЕЛЬСКИЕ           СИСТЕМНЫЕ
       │                      │
   ┌───▼───┐              ┌───▼───┐
   │/var/   │              │/etc/  │
   │spool/  │              │crontab│
   │cron/   │              │       │
   │crontabs│              │/etc/  │
   │        │              │cron.d/│
   └───────┘              └───────┘
       │                      │
   crontab -e            системный
   для каждого           администратор
   пользователя          редактирует
```

### Anacron - для периодически работающих систем

```
ОБЫЧНЫЙ CRON              ANACRON
      │                      │
  ┌───▼───┐              ┌───▼───┐
  │Требует │              │Умный  │
  │постоян-│              │запуск │
  │ной     │    ──→       │после  │
  │работы  │              │включе-│
  │системы │              │ния    │
  └───────┘              └───────┘
      │                      │
   ❌ Пропуск               ✅ Наверстает
   задач при               пропущенные
   выключении              задачи
```

### Systemd timers - современная альтернатива

```
CRON                     SYSTEMD TIMERS
  │                           │
  └─ Простой синтаксис       ├─ Интеграция с systemd
  └─ Один файл конфигурации  ├─ Лучшее логирование  
  └─ Ограниченные возможности├─ Зависимости между задачами
                             └─ Более точное время
```

### Лучшие практики планирования

```
┌─────────────────────────────────────────────────┐
│              ПРАВИЛА БЕЗОПАСНОСТИ               │
├─────────────────────────────────────────────────┤
│ ✅ Используйте полные пути к командам           │
│ ✅ Перенаправляйте вывод в файлы               │
│ ✅ Проверяйте логи выполнения                  │
│ ✅ Тестируйте скрипты перед добавлением        │
│ ❌ Не запускайте от root без необходимости     │
│ ❌ Не забывайте про часовые пояса              │
│ ❌ Не делайте задачи слишком частыми           │
└─────────────────────────────────────────────────┘
```

---

## 📦 Глава 2.5: Управление пакетами

### Концепция пакетного менеджера

Пакетный менеджер - это **магазин приложений** для Linux:

```
ИСХОДНЫЙ КОД ──→ КОМПИЛЯЦИЯ ──→ УПАКОВКА ──→ РЕПОЗИТОРИЙ
      │              │            │            │
   github.com    make/cmake   .deb/.rpm    apt/yum
   разработчик   сборка       пакет        установка
```

### Семейства пакетных менеджеров

```
┌─────────────────────────────────────────────────────┐
│               ЭКОСИСТЕМЫ ПАКЕТОВ                    │
├────────────────┬────────────────────────────────────┤
│ DEBIAN/UBUNTU  │ 📦 .deb пакеты                     │
│                │    apt, apt-get, dpkg              │
│                │    /etc/apt/sources.list           │
├────────────────┼────────────────────────────────────┤
│ RED HAT/CENTOS │ 📦 .rpm пакеты                     │
│                │    yum, dnf, rpm                   │
│                │    /etc/yum.repos.d/               │
├────────────────┼────────────────────────────────────┤
│ ARCH LINUX     │ 📦 .pkg.tar.xz пакеты              │
│                │    pacman, AUR                     │
└────────────────┴────────────────────────────────────┘
```

### APT (Advanced Package Tool) - философия

```
РЕПОЗИТОРИИ ──→ ИНДЕКС ──→ РАЗРЕШЕНИЕ ──→ УСТАНОВКА
     │            │        ЗАВИСИМОСТЕЙ      │
 Серверы с    apt update       │         apt install
 пакетами    обновление     libssl        программа +
             базы данных   требует       зависимости
```

### Зависимости пакетов

```
                    ВАША ПРОГРАММА
                         │
                    ┌────┴────┐
                    │ firefox │
                    └────┬────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
    ┌───▼───┐        ┌───▼───┐        ┌───▼───┐
    │libgtk │        │libssl │        │libx11 │
    └───┬───┘        └───┬───┘        └───┬───┘
        │                │                │
    ┌───▼───┐        ┌───▼───┐        ┌───▼───┐
    │libc6  │        │libz   │        │libxcb │
    └───────┘        └───────┘        └───────┘
```

**APT автоматически разрешает эту цепочку!**

### YUM/DNF - менеджер Red Hat семейства

```
YUM (старый) ──→ DNF (новый)
     │                │
 Медленный         Быстрый
 Python 2          Python 3  
 Больше памяти     Оптимизация
     │                │
     └── Одинаковый ──┘
         синтаксис
```

### Компиляция из исходного кода

```
ТРАДИЦИОННАЯ УСТАНОВКА:
./configure ──→ make ──→ make install
     │           │          │
  Настройка   Компиляция  Установка
  параметров  исходного    в систему
  сборки      кода        /usr/local/
```

**Когда компилировать самостоятельно:**
- Нужна последняя версия
- Специфические настройки
- Пакета нет в репозиториях
- Оптимизация под конкретное железо

### Современные форматы: Snap и Flatpak

```
ТРАДИЦИОННЫЕ ПАКЕТЫ        КОНТЕЙНЕРНЫЕ ПАКЕТЫ
         │                          │
    ┌────▼────┐                ┌────▼────┐
    │Зависимости│               │Изолиро- │
    │от системы │    ──→        │ванная   │
    │           │               │среда     │
    │Конфликты  │               │         │
    │версий     │               │Без      │
    └───────────┘               │конфликтов│
                                └─────────┘
```

### Управление репозиториями

```
ОФИЦИАЛЬНЫЕ РЕПОЗИТОРИИ ──→ СТОРОННИЕ ──→ ЛИЧНЫЕ
         │                      │           │
    ┌────▼────┐              ┌───▼───┐   ┌───▼───┐
    │Ubuntu   │              │PPA    │   │Локаль-│
    │main     │              │Сторон.│   │ные    │
    │universe │              │разраб.│   │сборки │
    │multiverse│             └───────┘   └───────┘
    └─────────┘                  │           │
        │                     Больший      Полный
    Стабильно                    риск      контроль
```

---

## 🎯 Итоговые знания Блока 2

После изучения этого блока вы должны:

### ✅ Концептуально понимать:
- Многопользовательскую архитектуру Linux
- Систему прав доступа как основу безопасности
- Процессы как живые сущности в системе
- Автоматизацию через планировщики задач
- Экосистему пакетного ПО

### ✅ Практически уметь:
- Создавать и управлять пользователями и группами
- Настраивать права доступа и безопасность файлов
- Мониторить и управлять процессами
- Планировать автоматические задачи
- Устанавливать и обновлять программное обеспечение

### ✅ Готовиться к изучению:
- Сетевых технологий и служб
- Продвинутой настройки сервисов
- Скриптинга и автоматизации
- DevOps практик

---

## 🧪 Контрольные вопросы

**Концептуальные:**
1. Объясните разницу между правами доступа и ACL
2. Почему sudo безопаснее, чем постоянная работа под root?
3. В чем преимущества пакетных менеджеров перед ручной установкой?

**Практические задания:**
1. Создайте группу разработчиков с ограниченными правами
2. Настройте автоматическое резервное копирование через cron
3. Исследуйте зависимости установленного пакета

**Сценарии:**
1. Пользователь не может записать файл - диагностируйте проблему
2. Система тормозит - найдите процесс-виновник
3. Нужно установить программу, которой нет в репозиториях

---

## 📚 Практические лаборатории

### Лаборатория 1: Многопользовательская среда
- Создайте отделы компании как группы пользователей
- Настройте общие каталоги с правильными правами
- Протестируйте доступ между пользователями

### Лаборатория 2: Мониторинг системы
- Настройте автоматический мониторинг ресурсов
- Создайте оповещения при превышении лимитов
- Проанализируйте узкие места системы

### Лаборатория 3: Управление пакетами
- Добавьте сторонний репозиторий
- Создайте локальный репозиторий пакетов
- Настройте автоматические обновления

---

**🚀 Отлично! Теперь вы готовы администрировать Linux системы. Следующий блок познакомит вас с сетевыми технологиями и службами!**