# –ë—Ä–æ–∫–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π: –û—Ç –Ω–æ–≤–∏—á–∫–∞ –¥–æ —ç–∫—Å–ø–µ—Ä—Ç–∞
*–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è Backend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞*

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏](#—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ-–∫–æ–Ω—Ü–µ–ø—Ü–∏–∏)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-–ø–∞—Ç—Ç–µ—Ä–Ω—ã)
3. [–ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏](#–∫–ª—é—á–µ–≤—ã–µ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)
4. [–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏](#–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ-–∫–æ–Ω—Ü–µ–ø—Ü–∏–∏)
5. [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ](#–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ)
6. [–ó–∞–∫–ª—é—á–µ–Ω–∏–µ –∏ —Ä–µ—Å—É—Ä—Å—ã](#–∑–∞–∫–ª—é—á–µ–Ω–∏–µ-–∏-—Ä–µ—Å—É—Ä—Å—ã)

---

## –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –ß—Ç–æ —Ç–∞–∫–æ–µ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π?

**–ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π** - —ç—Ç–æ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫ –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π (producers) –∏ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª—è–º (consumers).

```
–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å ‚Üí [–ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π] ‚Üí –ü–æ–ª—É—á–∞—Ç–µ–ª—å
   (Producer)    (Message Broker)      (Consumer)
```

### –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –±—Ä–æ–∫–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π?

#### –ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑ –±—Ä–æ–∫–µ—Ä–∞:
- **–°–∏–ª—å–Ω–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å** - —Å–∏—Å—Ç–µ–º—ã –∑–Ω–∞—é—Ç –¥—Ä—É–≥ –æ –¥—Ä—É–≥–µ –Ω–∞–ø—Ä—è–º—É—é
- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞
- **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ—Ç–∫–∞–∑–∞** - –ø–∞–¥–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –ª–æ–º–∞–µ—Ç –≤—Å—é —Ü–µ–ø–æ—á–∫—É

```
‚ùå –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
Service A ‚îÄ‚îÄdirect call‚îÄ‚îÄ> Service B ‚îÄ‚îÄdirect call‚îÄ‚îÄ> Service C
```

#### –†–µ—à–µ–Ω–∏—è —Å –±—Ä–æ–∫–µ—Ä–æ–º:
- **–°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å** - —Å–∏—Å—Ç–µ–º—ã –æ–±—â–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –±—Ä–æ–∫–µ—Ä
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –Ω–µ –∂–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Å–±–æ—è—Ö

```
‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –±—Ä–æ–∫–µ—Ä–æ–º:
Service A ‚îÄ‚îÄ> [Message Broker] <‚îÄ‚îÄ> Service B
Service C ‚îÄ‚îÄ>                  <‚îÄ‚îÄ> Service D
```

### –¢–∏–ø—ã –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

#### –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
```javascript
// HTTP-–≤—ã–∑–æ–≤ - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π
const response = await fetch('/api/users');
// –ñ–¥–µ–º –æ—Ç–≤–µ—Ç–∞ –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º
```

**–ü—Ä–æ–±–ª–µ–º—ã**: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –∫–∞—Å–∫–∞–¥–Ω—ã–µ —Å–±–æ–∏, —Ç–∞–π–º-–∞—É—Ç—ã

#### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
```javascript
// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è
messageQueue.publish('user.created', { userId: 123 });
// –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –≥–∏–±–∫–æ—Å—Ç—å

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

#### 1. Point-to-Point (–û—á–µ—Ä–µ–¥—å)
```
Producer ‚Üí [Queue] ‚Üí Consumer
```
- –û–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ = –æ–¥–∏–Ω –ø–æ–ª—É—á–∞—Ç–µ–ª—å
- –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏
- FIFO –ø–æ—Ä—è–¥–æ–∫ (–æ–±—ã—á–Ω–æ)

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤

#### 2. Publish-Subscribe (–ü–æ–¥–ø–∏—Å–∫–∞)
```
Producer ‚Üí [Topic] ‚Üí Consumer 1
                  ‚Üí Consumer 2
                  ‚Üí Consumer 3
```
- –û–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ = –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
- –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –∫–æ–ø–∏–∏
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö

#### 3. Request-Reply
```
Client ‚Üí [Request Queue] ‚Üí Server
Client ‚Üê [Reply Queue] ‚Üê Server
```
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π RPC
- Correlation ID –¥–ª—è —Å–≤—è–∑–∏ –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–∞

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: —Å–ª–æ–∂–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è

### Message Queue vs Message Streaming

#### Message Queue (–û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π)
```
[Msg1] ‚Üí [Msg2] ‚Üí [Msg3] ‚Üí Consumer
```
- –°–æ–æ–±—â–µ–Ω–∏—è —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ö—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
- –§–æ–∫—É—Å –Ω–∞ –Ω–∞–¥–µ–∂–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É

**–ü—Ä–∏–º–µ—Ä—ã**: RabbitMQ, Amazon SQS

#### Message Streaming (–ü–æ—Ç–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π)
```
Msg1 ‚Üí Msg2 ‚Üí Msg3 ‚Üí Msg4 ‚Üí ... (–ø–æ—Ç–æ–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è)
        ‚Üë            ‚Üë
   Consumer A    Consumer B
```
- –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ª–æ–≥–µ
- –î–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
- –§–æ–∫—É—Å –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä—ã**: Apache Kafka, Apache Pulsar

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è

#### Topic (–¢–µ–º–∞)
–õ–æ–≥–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
```
Topic: "user-events"
‚îú‚îÄ‚îÄ user.created
‚îú‚îÄ‚îÄ user.updated
‚îî‚îÄ‚îÄ user.deleted
```

#### Partition (–ü–∞—Ä—Ç–∏—Ü–∏—è)
–§–∏–∑–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
```
Topic: user-events
‚îú‚îÄ‚îÄ Partition 0: [Msg1, Msg3, Msg5]
‚îú‚îÄ‚îÄ Partition 1: [Msg2, Msg4, Msg6]
‚îî‚îÄ‚îÄ Partition 2: [Msg7, Msg8, Msg9]
```

#### Producer (–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å)
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏—è
```javascript
producer.send('user-events', {
  event: 'user.created',
  userId: 123
});
```

#### Consumer (–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å)
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø–æ–ª—É—á–∞—é—â–µ–µ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏—è
```javascript
consumer.subscribe('user-events', (message) => {
  console.log('Received:', message);
});
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### Event-Driven Architecture (EDA)

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è—Ö - —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.

#### –ü—Ä–∏–Ω—Ü–∏–ø—ã EDA:
1. **–°–æ–±—ã—Ç–∏—è –∫–∞–∫ —Ñ–∞–∫—Ç—ã** - —á—Ç–æ-—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –≤ —Å–∏—Å—Ç–µ–º–µ
2. **–°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ –∑–Ω–∞—é—Ç –¥—Ä—É–≥ –æ –¥—Ä—É–≥–µ –Ω–∞–ø—Ä—è–º—É—é
3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è

```
User Registration Flow:

User ‚Üí [Registration Service] ‚Üí Event: "user.registered"
                                      ‚Üì
        [Email Service] ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê Event Bus
        [Analytics] ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê
        [Billing Service] ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê
```

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏—è:
```javascript
{
  "eventId": "evt_123",
  "eventType": "user.registered",
  "timestamp": "2025-01-15T10:30:00Z",
  "source": "user-service",
  "data": {
    "userId": 123,
    "email": "user@example.com",
    "plan": "premium"
  }
}
```

### Microservices Communication Patterns

#### 1. Service-to-Service Events
```
Order Service ‚Üí "order.created" ‚Üí Inventory Service
                               ‚Üí Payment Service
                               ‚Üí Shipping Service
```

#### 2. Data Change Events
```javascript
// –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
userService.updateUser(userId, data);
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ
eventBus.publish('user.updated', {
  userId, 
  changes: data,
  version: 2
});
```

#### 3. Command Events
```javascript
// –ö–æ–º–∞–Ω–¥–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
eventBus.publish('payment.process', {
  orderId: 123,
  amount: 99.99,
  paymentMethod: 'card'
});
```

### Saga Pattern

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ —á–µ—Ä–µ–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

#### Choreography Saga (–•–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è)
```
1. Order Service ‚Üí "order.created"
2. Payment Service ‚Üí "payment.processed" 
3. Inventory Service ‚Üí "inventory.reserved"
4. Shipping Service ‚Üí "shipment.scheduled"

–ü—Ä–∏ –æ—à–∏–±–∫–µ:
Payment Service ‚Üí "payment.failed"
Order Service ‚Üí "order.cancelled"
```

#### Orchestration Saga (–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è)
```
Saga Orchestrator:
‚îú‚îÄ‚îÄ Step 1: Process Payment
‚îú‚îÄ‚îÄ Step 2: Reserve Inventory  
‚îú‚îÄ‚îÄ Step 3: Schedule Shipping
‚îî‚îÄ‚îÄ Compensation: Rollback all steps
```

```javascript
class OrderSaga {
  async execute(orderData) {
    try {
      await this.processPayment(orderData);
      await this.reserveInventory(orderData);
      await this.scheduleShipping(orderData);
    } catch (error) {
      await this.compensate(orderData);
      throw error;
    }
  }
}
```

### CQRS (Command Query Responsibility Segregation)

–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏.

```
Commands (Write Side):        Queries (Read Side):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Command Handler ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí  ‚îÇ Read Model      ‚îÇ
‚îÇ Write Database  ‚îÇ   events ‚îÇ Query Database  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```javascript
// Command Side
class CreateUserCommand {
  async execute(userData) {
    const user = new User(userData);
    await userRepository.save(user);
    
    eventBus.publish('user.created', {
      userId: user.id,
      ...userData
    });
  }
}

// Query Side
eventBus.subscribe('user.created', async (event) => {
  await userReadModel.create({
    id: event.userId,
    email: event.data.email,
    displayName: event.data.firstName + ' ' + event.data.lastName
  });
});
```

### Event Sourcing

–•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–±—ã—Ç–∏–π.

```
Event Store:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ user.created    { name: "John" }    ‚îÇ
‚îÇ user.updated    { email: "j@x.com" }‚îÇ  
‚îÇ user.activated  { }                 ‚îÇ
‚îÇ user.updated    { name: "Jane" }    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
            Current State:
        { name: "Jane", email: "j@x.com", active: true }
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Event Sourcing:
- **–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è** - –≤–∏–¥–∏–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- **–ê—É–¥–∏—Ç** - –∫—Ç–æ, —á—Ç–æ –∏ –∫–æ–≥–¥–∞ –∏–∑–º–µ–Ω–∏–ª
- **Replay** - –º–æ–∂–µ–º –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- **Debugging** - –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º—ã

---

## –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

### Apache Kafka

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Kafka

```
Kafka Cluster:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Broker 1        ‚îÇ Broker 2        ‚îÇ Broker 3        ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇTopic A      ‚îÇ ‚îÇ ‚îÇTopic A      ‚îÇ ‚îÇ ‚îÇTopic A      ‚îÇ ‚îÇ
‚îÇ ‚îÇPartition 0  ‚îÇ ‚îÇ ‚îÇPartition 1  ‚îÇ ‚îÇ ‚îÇPartition 2  ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:

**–¢–æ–ø–∏–∫–∏ –∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏:**
```
Topic: "user-events" (3 –ø–∞—Ä—Ç–∏—Ü–∏–∏)
Partition 0: [Msg1] [Msg4] [Msg7] [Msg10] ...
Partition 1: [Msg2] [Msg5] [Msg8] [Msg11] ...  
Partition 2: [Msg3] [Msg6] [Msg9] [Msg12] ...
```

**–†–µ–ø–ª–∏–∫–∞—Ü–∏—è:**
```
Partition 0:
‚îú‚îÄ‚îÄ Leader   (Broker 1) - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø–∏—Å–∏
‚îú‚îÄ‚îÄ Replica  (Broker 2) - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∫–æ–ø–∏—è
‚îî‚îÄ‚îÄ Replica  (Broker 3) - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∫–æ–ø–∏—è
```

#### Producer API:
```javascript
const kafka = require('kafkajs');

const producer = kafka.producer();

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
await producer.send({
  topic: 'user-events',
  messages: [{
    key: 'user-123',           // –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    value: JSON.stringify({
      eventType: 'user.created',
      userId: 123,
      timestamp: Date.now()
    })
  }]
});
```

#### Consumer API:
```javascript
const consumer = kafka.consumer({ 
  groupId: 'user-analytics-group' 
});

await consumer.subscribe({ topic: 'user-events' });

await consumer.run({
  eachMessage: async ({ topic, partition, message }) => {
    const event = JSON.parse(message.value.toString());
    console.log(`Processing: ${event.eventType}`);
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è
    await processUserEvent(event);
  }
});
```

#### Consumer Groups:
```
Topic "orders" (3 partitions):
Partition 0 ‚Üí Consumer A  ‚îê
Partition 1 ‚Üí Consumer B  ‚îú‚îÄ Group "order-processors"  
Partition 2 ‚Üí Consumer C  ‚îò

–ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è —á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∏–º consumer'–æ–º –≤ –≥—Ä—É–ø–ø–µ
```

#### Kafka Streams:
```javascript
const { KafkaStreams } = require('kafka-streams');

const stream = kafkaStreams.getKStream('user-events');

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–æ–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
stream
  .filter(event => event.eventType === 'user.created')
  .mapJSONConvenience()
  .groupByKey()
  .window(60 * 1000) // –æ–∫–Ω–æ 60 —Å–µ–∫—É–Ω–¥
  .aggregate(
    () => ({ count: 0 }),
    (oldVal, event) => ({ count: oldVal.count + 1 })
  )
  .to('user-registrations-per-minute');
```

### RabbitMQ

–ù–∞–¥–µ–∂–Ω—ã–π –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π —Å –±–æ–≥–∞—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏.

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RabbitMQ:

```
Producer ‚Üí [Exchange] ‚Üí [Queue] ‚Üí Consumer
```

#### –¢–∏–ø—ã Exchange'–æ–≤:

**1. Direct Exchange:**
```
Producer ‚Üí Direct Exchange
           ‚îú‚îÄ‚îÄ routing key "error" ‚Üí Error Queue ‚Üí Error Handler
           ‚îú‚îÄ‚îÄ routing key "info"  ‚Üí Info Queue  ‚Üí Info Handler  
           ‚îî‚îÄ‚îÄ routing key "debug" ‚Üí Debug Queue ‚Üí Debug Handler
```

**2. Topic Exchange:**
```
Producer ‚Üí Topic Exchange
           ‚îú‚îÄ‚îÄ "user.*.created" ‚Üí User Created Queue
           ‚îú‚îÄ‚îÄ "order.#"        ‚Üí All Order Events Queue
           ‚îî‚îÄ‚îÄ "*.payment.*"    ‚Üí Payment Events Queue
```

**3. Fanout Exchange:**
```
Producer ‚Üí Fanout Exchange
           ‚îú‚îÄ‚îÄ Queue A ‚Üí Consumer A
           ‚îú‚îÄ‚îÄ Queue B ‚Üí Consumer B  
           ‚îî‚îÄ‚îÄ Queue C ‚Üí Consumer C
           (–≤—Å–µ –ø–æ–ª—É—á–∞—é—Ç –∫–æ–ø–∏—é —Å–æ–æ–±—â–µ–Ω–∏—è)
```

#### Producer (–æ—Ç–ø—Ä–∞–≤–∫–∞):
```javascript
const amqp = require('amqplib');

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
await channel.publish(
  'user-events',              // exchange
  'user.created',             // routing key
  Buffer.from(JSON.stringify({
    userId: 123,
    email: 'user@example.com'
  })),
  { 
    persistent: true,         // —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –Ω–∞ –¥–∏—Å–∫
    messageId: uuidv4(),
    timestamp: Date.now()
  }
);
```

#### Consumer (–ø–æ–ª—É—á–µ–Ω–∏–µ):
```javascript
// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—á–µ—Ä–µ–¥—å
await channel.consume('user-created-queue', async (msg) => {
  if (msg) {
    const event = JSON.parse(msg.content.toString());
    
    try {
      await processUserCreated(event);
      channel.ack(msg); // –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    } catch (error) {
      channel.nack(msg, false, true); // –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Å requeue
    }
  }
});
```

#### Dead Letter Queues:
```
Main Queue ‚Üí Processing Failed ‚Üí Dead Letter Exchange ‚Üí DLQ
                                                     ‚Üì
                                              Manual Investigation
```

```javascript
// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DLQ
await channel.assertQueue('user-events-queue', {
  arguments: {
    'x-dead-letter-exchange': 'dlx',
    'x-dead-letter-routing-key': 'failed',
    'x-message-ttl': 60000  // TTL —Å–æ–æ–±—â–µ–Ω–∏–π
  }
});
```

### Redis Pub/Sub –∏ Streams

Redis –∫–∞–∫ lightweight –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π.

#### Redis Pub/Sub:
```javascript
// Publisher
const redis = require('redis');
const publisher = redis.createClient();

await publisher.publish('user-events', JSON.stringify({
  eventType: 'user.login',
  userId: 123
}));

// Subscriber  
const subscriber = redis.createClient();
await subscriber.subscribe('user-events');

subscriber.on('message', (channel, message) => {
  const event = JSON.parse(message);
  console.log(`Received on ${channel}:`, event);
});
```

#### Redis Streams:
```javascript
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ø–æ—Ç–æ–∫
await redis.xAdd('user-stream', '*', {
  'eventType': 'user.created',
  'userId': '123',
  'email': 'user@example.com'
});

// –ß—Ç–µ–Ω–∏–µ –∏–∑ –ø–æ—Ç–æ–∫–∞ —Å Consumer Group
await redis.xGroupCreate('user-stream', 'analytics-group', '0');

const messages = await redis.xReadGroup(
  'analytics-group',
  'consumer-1', 
  { key: 'user-stream', id: '>' },
  { COUNT: 10, BLOCK: 1000 }
);
```

#### Consumer Groups –≤ Redis Streams:
```
Stream: user-events
‚îú‚îÄ‚îÄ Consumer Group: analytics
‚îÇ   ‚îú‚îÄ‚îÄ Consumer A (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è 1, 4, 7...)
‚îÇ   ‚îî‚îÄ‚îÄ Consumer B (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è 2, 5, 8...)
‚îî‚îÄ‚îÄ Consumer Group: notifications  
    ‚îî‚îÄ‚îÄ Consumer C (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Kafka | RabbitMQ | Redis |
|---|---|---|---|
| **–¢–∏–ø** | Streaming Platform | Message Queue | In-Memory Store |
| **Throughput** | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π | –í—ã—Å–æ–∫–∏–π | –í—ã—Å–æ–∫–∏–π |
| **Latency** | –°—Ä–µ–¥–Ω—è—è | –ù–∏–∑–∫–∞—è | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è |
| **Persistence** | –î–∞ (–¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è) | –î–∞ | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ |
| **Ordering** | –ü–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º | –ü–æ –æ—á–µ—Ä–µ–¥–∏ | –ü–æ –ø–æ—Ç–æ–∫—É |
| **Replay** | –î–∞ | –ù–µ—Ç | –î–∞ (Streams) |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å** | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω—è—è | –ù–∏–∑–∫–∞—è |

#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

**Kafka:**
- –í—ã—Å–æ–∫–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ (>10k —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫)
- –ü–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- Event sourcing
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**RabbitMQ:**
- –°–ª–æ–∂–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
- –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞
- –†–∞–∑–ª–∏—á–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
- –£–º–µ—Ä–µ–Ω–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏

**Redis:**  
- –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –ü—Ä–æ—Å—Ç—ã–µ use cases
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ + messaging
- Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

## –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### Delivery Guarantees (–ì–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏)

#### At-most-once (–ù–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞)
```
Producer ‚Üí Broker ‚Üí Consumer
           ‚Üì
        [–º–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å—Å—è]
```
- –°–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω–æ
- –î—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–µ—Ç
- –°–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –º–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏, –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

#### At-least-once (–ú–∏–Ω–∏–º—É–º –æ–¥–∏–Ω —Ä–∞–∑)  
```
Producer ‚Üí Broker ‚Üí Consumer
    ‚Üë         ‚Üì         ‚Üì
    ‚îî‚îÄ‚îÄ retry ‚Üê‚îÄ‚îÄ ack ‚Üê‚îÄ‚îÄ‚îò
```
- –°–æ–æ–±—â–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
- –í–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã
- –ù—É–∂–Ω–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

#### Exactly-once (–†–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑)
```
Producer ‚Üí [Transactional Broker] ‚Üí Consumer
              (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)      (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è)
```
- –ì–∞—Ä–∞–Ω—Ç–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–æ—Ç–µ—Ä—å –∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –°–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –°–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π

#### –ü—Ä–æ–±–ª–µ–º–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:
```javascript
// ‚ùå –ù–µ–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
function processPayment(orderId, amount) {
  user.balance -= amount;  // –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ balance —É–º–µ–Ω—å—à–∏—Ç—Å—è –µ—â–µ —Ä–∞–∑
  database.save(user);
}
```

#### –†–µ—à–µ–Ω–∏—è:

**1. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**
```javascript
// ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
function processPayment(orderId, amount) {
  if (!paymentRepository.exists(orderId)) {
    user.balance -= amount;
    paymentRepository.create({ orderId, amount, processed: true });
    database.save(user);
  }
}
```

**2. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ messageId:**
```javascript
const processedMessages = new Set();

function handleMessage(message) {
  if (processedMessages.has(message.id)) {
    return; // —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
  }
  
  processBusinessLogic(message);
  processedMessages.add(message.id);
}
```

### Message Ordering (–£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π)

#### –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ—Ä—è–¥–∫–∞:
```
–°–æ–±—ã—Ç–∏—è: user.created ‚Üí user.updated ‚Üí user.deleted
–û–±—Ä–∞–±–æ—Ç–∫–∞: user.updated ‚Üí user.created ‚Üí user.deleted ‚ùå
```

#### –†–µ—à–µ–Ω–∏—è:

**1. –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∫–ª—é—á—É (Kafka):**
```javascript
// –í—Å–µ —Å–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–¥–Ω—É –ø–∞—Ä—Ç–∏—Ü–∏—é
producer.send({
  topic: 'user-events',
  key: `user-${userId}`,    // –∫–ª—é—á –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  value: JSON.stringify(event)
});
```

**2. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (RabbitMQ):**
```javascript
// –û–¥–Ω–∞ –æ—á–µ—Ä–µ–¥—å = –æ–¥–∏–Ω consumer = –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω
await channel.consume('user-events', processMessage, {
  prefetch: 1  // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ –æ–¥–Ω–æ–º—É
});
```

**3. Version-based ordering:**
```javascript
function handleUserEvent(event) {
  const currentUser = userRepository.findById(event.userId);
  
  if (event.version <= currentUser.version) {
    console.log('Outdated event, ignoring');
    return;
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–µ—Ä—Å–∏—è –Ω–æ–≤–µ–µ
  updateUser(event);
}
```

### Backpressure Handling

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–æ–π –∫–æ–≥–¥–∞ consumer –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è.

#### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏:

**1. Throttling (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏):**
```javascript
const rateLimiter = new RateLimiter({
  tokensPerInterval: 100,
  interval: 'second'
});

consumer.on('message', async (message) => {
  await rateLimiter.removeTokens(1);
  await processMessage(message);
});
```

**2. Circuit Breaker:**
```javascript
class CircuitBreaker {
  constructor() {
    this.state = 'CLOSED';
    this.failureCount = 0;
    this.threshold = 5;
  }
  
  async execute(operation) {
    if (this.state === 'OPEN') {
      throw new Error('Circuit breaker is OPEN');
    }
    
    try {
      const result = await operation();
      this.onSuccess();
      return result;
    } catch (error) {
      this.onFailure();
      throw error;
    }
  }
}
```

**3. Queue —Ä–∞–∑–º–µ—Ä –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:**
```javascript
// RabbitMQ - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–∏
await channel.assertQueue('processing-queue', {
  arguments: {
    'x-max-length': 1000,
    'x-overflow': 'reject-publish'
  }
});
```

### Retry Mechanisms

#### Exponential Backoff:
```javascript
async function processWithRetry(message, maxRetries = 3) {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      await processMessage(message);
      return; // —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
    } catch (error) {
      if (attempt === maxRetries) {
        await sendToDeadLetterQueue(message);
        throw error;
      }
      
      // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 1s, 2s, 4s, 8s...
      const delay = Math.pow(2, attempt) * 1000;
      await sleep(delay);
    }
  }
}
```

#### Jittered Backoff (—Å–æ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å—é):
```javascript
function getBackoffDelay(attempt, baseDelay = 1000) {
  const exponentialDelay = Math.pow(2, attempt) * baseDelay;
  const jitter = Math.random() * 0.1 * exponentialDelay;
  return exponentialDelay + jitter;
}
```

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### Horizontal Scaling Consumer'–æ–≤:

**Kafka - Consumer Groups:**
```
Topic (6 partitions):
[P0] [P1] [P2] [P3] [P4] [P5]
 ‚Üì    ‚Üì    ‚Üì    ‚Üì    ‚Üì    ‚Üì
[C1] [C2] [C3] [C4] [C5] [C6]

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ Consumer'–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç rebalancing
```

**RabbitMQ - Competing Consumers:**
```
Queue ‚Üí Consumer 1
     ‚Üí Consumer 2  
     ‚Üí Consumer 3
     (round-robin —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
```

#### Partitioning Strategies:

**1. –ü–æ –∫–ª—é—á—É:**
```javascript
// –•–æ—Ä–æ—à–æ: –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏
partition = hash(userId) % partitionCount;

// –ü–ª–æ—Ö–æ: –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
partition = hash(orderId) % partitionCount;
```

**2. –ü–æ –≤—Ä–µ–º–µ–Ω–∏:**
```javascript
// –ü–∞—Ä—Ç–∏—Ü–∏–∏ –ø–æ —á–∞—Å–∞–º –¥–ª—è time-series –¥–∞–Ω–Ω—ã—Ö
partition = currentHour % partitionCount;
```

#### Performance Optimization:

**Batching (–ø–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞):**
```javascript
const batch = [];
const BATCH_SIZE = 100;

consumer.on('message', async (message) => {
  batch.push(message);
  
  if (batch.length >= BATCH_SIZE) {
    await processBatch(batch);
    batch.length = 0;
  }
});
```

**Async Processing:**
```javascript
// ‚ùå –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
for (const message of messages) {
  await processMessage(message);
}

// ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
await Promise.all(
  messages.map(message => processMessage(message))
);
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

#### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

**Throughput (–ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å):**
```javascript
class MetricsCollector {
  constructor() {
    this.messageCount = 0;
    this.startTime = Date.now();
  }
  
  recordMessage() {
    this.messageCount++;
    
    if (this.messageCount % 1000 === 0) {
      const elapsed = (Date.now() - this.startTime) / 1000;
      const throughput = this.messageCount / elapsed;
      console.log(`Throughput: ${throughput.toFixed(2)} msg/sec`);
    }
  }
}
```

**Latency (–∑–∞–¥–µ—Ä–∂–∫–∞):**
```javascript
function measureLatency(message) {
  const processingStart = Date.now();
  const messageAge = processingStart - message.timestamp;
  
  console.log(`Message age: ${messageAge}ms`);
  
  return async () => {
    const processingTime = Date.now() - processingStart;
    console.log(`Processing time: ${processingTime}ms`);
  };
}
```

**Consumer Lag (–æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ):**
```
Topic offset:     [1000] [1001] [1002] [1003] [1004]
Consumer offset:           [1001]
Lag = 1004 - 1001 = 3 —Å–æ–æ–±—â–µ–Ω–∏—è
```

#### Alerting Rules:
```yaml
# –ü—Ä–∏–º–µ—Ä –∞–ª–µ—Ä—Ç–æ–≤
alerts:
  - name: High Consumer Lag
    condition: consumer_lag > 1000
    action: scale_consumers
    
  - name: Low Throughput  
    condition: messages_per_second < 100
    action: investigate_bottleneck
    
  - name: High Error Rate
    condition: error_rate > 5%
    action: emergency_notification
```

---

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

### –í—ã–±–æ—Ä –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è

#### –ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π:

```
                 ‚îÇ Low Latency ‚îÇ High Throughput ‚îÇ Persistence ‚îÇ Complexity
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Redis Pub/Sub    ‚îÇ      ‚úì      ‚îÇ        -        ‚îÇ      -      ‚îÇ     ‚úì
Redis Streams    ‚îÇ      ‚úì      ‚îÇ        ‚úì        ‚îÇ      ‚úì      ‚îÇ     ‚úì  
RabbitMQ         ‚îÇ      ‚úì      ‚îÇ        ‚úì        ‚îÇ      ‚úì      ‚îÇ     ‚óã
Apache Kafka     ‚îÇ      ‚óã      ‚îÇ        ‚úì        ‚îÇ      ‚úì      ‚îÇ     ‚óã
Amazon SQS       ‚îÇ      ‚óã      ‚îÇ        ‚óã        ‚îÇ      ‚úì      ‚îÇ     ‚úì

‚úì - –û—Ç–ª–∏—á–Ω–æ, ‚óã - –•–æ—Ä–æ—à–æ, - - –°–ª–∞–±–æ
```

#### Decision Tree (–î–µ—Ä–µ–≤–æ —Ä–µ—à–µ–Ω–∏–π):

```
–ù—É–∂–Ω–∞ –ª–∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å?
‚îú‚îÄ‚îÄ –ù–ï–¢ ‚Üí Redis Pub/Sub
‚îî‚îÄ‚îÄ –î–ê
    ‚îú‚îÄ‚îÄ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ? ‚Üí Amazon SQS
    ‚îú‚îÄ‚îÄ –ù—É–∂–µ–Ω replay —Å–æ–æ–±—â–µ–Ω–∏–π?
    ‚îÇ   ‚îú‚îÄ‚îÄ –î–ê ‚Üí Kafka –∏–ª–∏ Redis Streams  
    ‚îÇ   ‚îî‚îÄ‚îÄ –ù–ï–¢ ‚Üí RabbitMQ
    ‚îî‚îÄ‚îÄ –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ (>50k msg/sec)?
        ‚îú‚îÄ‚îÄ –î–ê ‚Üí Kafka
        ‚îî‚îÄ‚îÄ –ù–ï–¢ ‚Üí RabbitMQ
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Backend —Å–∏—Å—Ç–µ–º–∞–º–∏

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö:

**Outbox Pattern:**
```javascript
// –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ–±—ã—Ç–∏—è
async function createUser(userData) {
  const transaction = await db.beginTransaction();
  
  try {
    // 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = await userRepository.save(userData, { transaction });
    
    // 2. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ outbox —Ç–∞–±–ª–∏—Ü—É
    await outboxRepository.save({
      eventType: 'user.created',
      payload: { userId: user.id, ...userData },
      status: 'pending'
    }, { transaction });
    
    await transaction.commit();
  } catch (error) {
    await transaction.rollback();
    throw error;
  }
}

// –û—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ outbox
async function publishOutboxEvents() {
  const events = await outboxRepository.findPending();
  
  for (const event of events) {
    await messageQueue.publish(event.eventType, event.payload);
    await outboxRepository.markAsPublished(event.id);
  }
}
```

**Event Sourcing –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
```javascript
class EventStore {
  async append(streamId, events) {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–±—ã—Ç–∏—è –≤ event store
    await this.database.saveEvents(streamId, events);
    
    // –ü—É–±–ª–∏–∫—É–µ–º –≤ message broker
    for (const event of events) {
      await this.messageQueue.publish(`${streamId}.${event.type}`, event);
    }
  }
}
```

#### API Gateway –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:

```
Client ‚Üí API Gateway ‚Üí Service ‚Üí Message Queue ‚Üí Background Services
                         ‚Üì
                    Immediate Response
```

```javascript
// Controller –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
app.post('/api/users', async (req, res) => {
  const userId = uuidv4();
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  await commandQueue.publish('user.create', {
    userId,
    ...req.body
  });
  
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
  res.status(202).json({ 
    userId,
    status: 'processing',
    statusUrl: `/api/users/${userId}/status`
  });
});
```

### –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Event-Driven —Å–∏—Å—Ç–µ–º—ã

#### E-commerce —Å–∏—Å—Ç–µ–º–∞ - –ø—Ä–∏–º–µ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

```
                    Event Bus (Kafka)
                          ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚ñº                     ‚ñº                     ‚ñº
Order Service       Inventory Service     Payment Service
    ‚îÇ                     ‚îÇ                     ‚îÇ
    ‚ñº                     ‚ñº                     ‚ñº
[Orders DB]         [Inventory DB]        [Payments DB]

–°–æ–±—ã—Ç–∏—è:
‚Ä¢ order.created ‚Üí inventory.check, payment.authorize
‚Ä¢ payment.completed ‚Üí order.confirmed, inventory.reserve
‚Ä¢ order.shipped ‚Üí inventory.committed, notification.sent
```

#### –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã —Å–æ–±—ã—Ç–∏–π:

```javascript
// –°—Ö–µ–º–∞ —Å–æ–±—ã—Ç–∏—è —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
{
  "eventId": "evt_123456",
  "eventType": "order.created", 
  "eventVersion": "1.0",
  "timestamp": "2025-01-15T10:30:00Z",
  "source": "order-service",
  "correlationId": "corr_789",  // –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞
  "data": {
    "orderId": "ord_456",
    "customerId": "cust_123", 
    "items": [
      {
        "productId": "prod_789",
        "quantity": 2,
        "price": 29.99
      }
    ],
    "totalAmount": 59.98
  },
  "metadata": {
    "userId": "user_123",
    "sessionId": "sess_456"
  }
}
```

#### Error Handling —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

**1. Dead Letter Queue Pattern:**
```javascript
async function processOrder(orderEvent) {
  try {
    await validateOrder(orderEvent);
    await reserveInventory(orderEvent);
    await chargePayment(orderEvent);
  } catch (error) {
    if (error.retryable) {
      throw error; // –±—É–¥–µ—Ç retry
    } else {
      await deadLetterQueue.send({
        originalEvent: orderEvent,
        error: error.message,
        timestamp: Date.now()
      });
    }
  }
}
```

**2. Compensation Events:**
```javascript
// –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è
async function handlePaymentFailed(event) {
  await eventBus.publish('inventory.unreserve', {
    orderId: event.orderId,
    reason: 'payment_failed'
  });
  
  await eventBus.publish('order.cancelled', {
    orderId: event.orderId,
    reason: 'payment_failed'
  });
}
```

### Testing Strategies

#### Unit Testing —Å –º–æ–∫–∞–º–∏:
```javascript
describe('UserService', () => {
  it('should publish user.created event', async () => {
    const mockEventBus = {
      publish: jest.fn()
    };
    
    const userService = new UserService(mockEventBus);
    await userService.createUser({ name: 'John' });
    
    expect(mockEventBus.publish).toHaveBeenCalledWith(
      'user.created',
      expect.objectContaining({ name: 'John' })
    );
  });
});
```

#### Integration Testing:
```javascript
describe('Order Flow Integration', () => {
  it('should complete order flow end-to-end', async () => {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ
    await eventBus.publish('order.created', orderData);
    
    // –ñ–¥–µ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏
    await waitForEvent('order.confirmed', 5000);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    const order = await orderRepository.findById(orderData.orderId);
    expect(order.status).toBe('confirmed');
  });
});
```

### Cloud-native —Ä–µ—à–µ–Ω–∏—è

#### Amazon SQS/SNS:
```javascript
// SNS –¥–ª—è broadcast, SQS –¥–ª—è queuing
const sns = new AWS.SNS();
const sqs = new AWS.SQS();

// –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ SNS topic
await sns.publish({
  TopicArn: 'arn:aws:sns:region:account:user-events',
  Message: JSON.stringify(userEvent)
}).promise();

// –ß—Ç–µ–Ω–∏–µ –∏–∑ SQS queue
const messages = await sqs.receiveMessage({
  QueueUrl: 'https://sqs.region.amazonaws.com/account/user-events-queue',
  MaxNumberOfMessages: 10,
  WaitTimeSeconds: 20  // long polling
}).promise();
```

#### Google Cloud Pub/Sub:
```javascript
const { PubSub } = require('@google-cloud/pubsub');
const pubsub = new PubSub();

// –ü—É–±–ª–∏–∫–∞—Ü–∏—è
const topic = pubsub.topic('user-events');
await topic.publish(Buffer.from(JSON.stringify(userEvent)));

// –ü–æ–¥–ø–∏—Å–∫–∞
const subscription = topic.subscription('user-analytics');
subscription.on('message', (message) => {
  const event = JSON.parse(message.data.toString());
  processEvent(event);
  message.ack();
});
```

### DevOps –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

#### Docker Compose –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```yaml
version: '3.8'
services:
  kafka:
    image: confluentinc/cp-kafka:latest
    environment:
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092
    
  redis:
    image: redis:alpine
    ports:
      - "6379:6379"
      
  rabbitmq:
    image: rabbitmq:3-management
    environment:
      RABBITMQ_DEFAULT_USER: admin
      RABBITMQ_DEFAULT_PASS: admin
    ports:
      - "5672:5672"
      - "15672:15672"
```

#### Kubernetes Deployment:
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: event-processor
spec:
  replicas: 3
  selector:
    matchLabels:
      app: event-processor
  template:
    spec:
      containers:
      - name: processor
        image: event-processor:latest
        env:
        - name: KAFKA_BROKERS
          value: "kafka-service:9092"
        - name: CONSUMER_GROUP
          value: "event-processors"
        resources:
          requests:
            memory: "256Mi"
            cpu: "200m"
          limits:
            memory: "512Mi"
            cpu: "500m"
```

#### Observability:
```javascript
// Prometheus –º–µ—Ç—Ä–∏–∫–∏
const promClient = require('prom-client');

const messagesProcessed = new promClient.Counter({
  name: 'messages_processed_total',
  help: 'Total number of processed messages',
  labelNames: ['topic', 'status']
});

const processingDuration = new promClient.Histogram({
  name: 'message_processing_duration_seconds',
  help: 'Message processing duration',
  buckets: [0.1, 0.5, 1, 2, 5]
});

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
function processMessage(message) {
  const timer = processingDuration.startTimer();
  
  try {
    // –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    messagesProcessed.inc({ topic: message.topic, status: 'success' });
  } catch (error) {
    messagesProcessed.inc({ topic: message.topic, status: 'error' });
    throw error;
  } finally {
    timer();
  }
}
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –∏ —Ä–µ—Å—É—Ä—Å—ã

### –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

**1. –ë—Ä–æ–∫–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π - —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º**
- –û–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Å–ª–∞–±—É—é —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
- –ü–æ–≤—ã—à–∞—é—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ü–æ–∑–≤–æ–ª—è—é—Ç —Å—Ç—Ä–æ–∏—Ç—å event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**2. –í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π:**
- **Kafka** - –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ –∏ –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **RabbitMQ** - –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ —Å–ª–æ–∂–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏  
- **Redis** - –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –∏ –Ω–∏–∑–∫–æ–π –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- **Cloud —Ä–µ—à–µ–Ω–∏—è** - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ –∏ —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**3. –í–∞–∂–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ retry –ª–æ–≥–∏–∫–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ observability —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã —Å–æ–±—ã—Ç–∏–π –∏ –∏—Ö —ç–≤–æ–ª—é—Ü–∏–∏

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

#### –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã:
1. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ use case** - –∫–∞–∫—É—é –ø—Ä–æ–±–ª–µ–º—É —Ä–µ—à–∞–µ—Ç–µ
2. **–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ** - –Ω–∞—á–Ω–∏—Ç–µ —Å managed —Å–µ—Ä–≤–∏—Å–æ–≤
3. **–ü—Ä–æ–µ–∫—Ç–∏—Ä—É–π—Ç–µ —Å–æ–±—ã—Ç–∏—è** - –¥—É–º–∞–π—Ç–µ –æ —Å—Ö–µ–º–µ –∏ —ç–≤–æ–ª—é—Ü–∏–∏
4. **–î–æ–±–∞–≤—å—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞–ª–µ—Ä—Ç—ã —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è
5. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Ç–∫–∞–∑—ã** - chaos engineering –¥–ª—è message flows

#### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±—Ä–æ–∫–µ—Ä–∞ —Ç–∞–º, –≥–¥–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ HTTP
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- –ü–ª–æ—Ö–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∏ —Ç–æ–ø–∏–∫–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ö–µ–º —Å–æ–±—ã—Ç–∏–π
- –ù–µ–¥–æ–æ—Ü–µ–Ω–∫–∞ operational complexity

### –î–∞–ª—å–Ω–µ–π—à–µ–µ –∏–∑—É—á–µ–Ω–∏–µ

#### –ö–Ω–∏–≥–∏:
- **"Kafka: The Definitive Guide"** - Gwen Shapira, Todd Palino
- **"Building Event-Driven Microservices"** - Adam Bellemare  
- **"Designing Event-Driven Systems"** - Ben Stopford
- **"Enterprise Integration Patterns"** - Gregor Hohpe

#### –û–Ω–ª–∞–π–Ω —Ä–µ—Å—É—Ä—Å—ã:
- [Confluent Developer Portal](https://developer.confluent.io)
- [RabbitMQ Tutorials](https://www.rabbitmq.com/tutorials/)
- [Redis University](https://university.redis.com)
- [AWS Messaging Services](https://aws.amazon.com/messaging/)

#### –ü—Ä–∞–∫—Ç–∏–∫–∞:
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å Docker Compose
- –†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—É—é event-driven —Å–∏—Å—Ç–µ–º—É
- –ò–∑—É—á–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é production –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç** –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∑–Ω–∞–Ω–∏–π
2. **–ù–∞—á–Ω–∏—Ç–µ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ** - –æ–¥–∏–Ω –±—Ä–æ–∫–µ—Ä, –±–∞–∑–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
3. **–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ —É—Å–ª–æ–∂–Ω—è–π—Ç–µ** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
4. **–ò–∑—É—á–∞–π—Ç–µ operational aspects** - –¥–µ–ø–ª–æ–π, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
5. **–î–µ–ª–∏—Ç–µ—Å—å –æ–ø—ã—Ç–æ–º** - –ø–∏—à–∏—Ç–µ —Å—Ç–∞—Ç—å–∏, —É—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏—è—Ö

–ü–æ–º–Ω–∏—Ç–µ: –±—Ä–æ–∫–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π - —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –Ω–æ –æ–Ω–∏ –¥–æ–±–∞–≤–ª—è—é—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É.

---

*–£–¥–∞—á–∏ –≤ –∏–∑—É—á–µ–Ω–∏–∏ –±—Ä–æ–∫–µ—Ä–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π! üöÄ*