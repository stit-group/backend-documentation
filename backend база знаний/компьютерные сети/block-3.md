# 🌐 Блок 3: Маршрутизация и интернет
## От локальных сетей к глобальной связности

---

## 📋 Обзор блока

**Время изучения:** 3-4 месяца  
**Уровень сложности:** Средний-продвинутый  
**Предварительные требования:** Знание основ сетей и коммутации

### Что вы изучите:
- IP-адресацию и планирование подсетей
- Принципы маршрутизации пакетов
- Протоколы динамической маршрутизации
- Технологии трансляции адресов
- Основы сетевой безопасности

---

## 🎯 Глава 3.1: IP-адресация
### Глубокое погружение в мир IP-адресов

#### Концепция IP-адресации

IP-адрес - это уникальный идентификатор устройства в сети, работающий по принципу почтового адреса. Представьте себе огромный город (интернет), где каждый дом (устройство) должен иметь точный адрес для доставки писем (пакетов данных).

```
Аналогия с почтовой системой:
----------------------------------------------
| Почтовый адрес          | IP-адрес         |
----------------------------------------------
| Страна                  | Сеть             |
| Город                   | Подсеть          |
| Улица                   | Сегмент          |
| Номер дома              | Хост             |
----------------------------------------------
```

#### IPv4: Архитектура и структура

IPv4 адрес состоит из 32 бит, записанных в виде четырех октетов (байт), разделенных точками.

**Структура IPv4 адреса:**
```
Двоичное представление:
11000000.10101000.00000001.00000001

Десятичное представление:
192.168.1.1

Разбивка по битам:
--------------------------------------
| Октет 1 | Октет 2 | Октет 3 | Октет 4 |
| 11000000| 10101000| 00000001| 00000001|
|   192   |   168   |    1    |    1    |
--------------------------------------
```

#### Классовая адресация (историческая перспектива)

Изначально IP-адреса делились на классы - это как районирование города по типам застройки:

**Класс A (Крупные корпорации):**
```
Формат: N.H.H.H
Диапазон: 1.0.0.0 - 126.255.255.255
Сетей: 126
Хостов в сети: 16,777,214

Визуализация:
[████████][        ][        ][        ]
  Сеть      Хост     Хост     Хост
```

**Класс B (Средние организации):**
```
Формат: N.N.H.H
Диапазон: 128.0.0.0 - 191.255.255.255
Сетей: 16,384
Хостов в сети: 65,534

Визуализация:
[████████][████████][        ][        ]
   Сеть      Сеть      Хост     Хост
```

**Класс C (Малые сети):**
```
Формат: N.N.N.H
Диапазон: 192.0.0.0 - 223.255.255.255
Сетей: 2,097,152
Хостов в сети: 254

Визуализация:
[████████][████████][████████][        ]
   Сеть      Сеть      Сеть      Хост
```

#### CIDR и бесклассовая адресация

CIDR (Classless Inter-Domain Routing) революционизировал IP-адресацию, позволив гибко делить адресное пространство.

**Принцип CIDR:**
```
IP-адрес/префикс = 192.168.1.0/24

Где:
- 192.168.1.0 - адрес сети
- /24 - количество бит для сети (маска)

Маска подсети:
/24 = 255.255.255.0 = 11111111.11111111.11111111.00000000

Визуализация /24 сети:
---------------------------------------
|     24 бита сети    | 8 бит хостов |
| 192.168.1           | 0-255        |
---------------------------------------
Доступно адресов: 2^8 = 256
Адресов для хостов: 254 (исключая network и broadcast)
```

#### Подсети и VLSM

**Концепция подсетирования:**

Подсетирование - это разделение большой сети на меньшие логические сегменты. Представьте многоэтажное здание, где каждый этаж - отдельная подсеть.

**Пример разделения сети 192.168.1.0/24:**

```
Исходная сеть: 192.168.1.0/24 (254 хоста)

Разделение на 4 подсети (/26):

Подсеть 1: 192.168.1.0/26   (192.168.1.1   - 192.168.1.62  ) - 62 хоста
Подсеть 2: 192.168.1.64/26  (192.168.1.65  - 192.168.1.126 ) - 62 хоста  
Подсеть 3: 192.168.1.128/26 (192.168.1.129 - 192.168.1.190 ) - 62 хоста
Подсеть 4: 192.168.1.192/26 (192.168.1.193 - 192.168.1.254 ) - 62 хоста

Визуализация:
┌─────────────── 192.168.1.0/24 ───────────────┐
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ │
│  │ /26    │ │ /26    │ │ /26    │ │ /26    │ │
│  │Подсеть1│ │Подсеть2│ │Подсеть3│ │Подсеть4│ │
│  └────────┘ └────────┘ └────────┘ └────────┘ │
└───────────────────────────────────────────────┘
```

**VLSM (Variable Length Subnet Mask):**

VLSM позволяет использовать подсети разного размера в зависимости от потребностей:

```
Организация нуждается в:
- Сеть для 100 компьютеров
- Сеть для 50 компьютеров  
- Сеть для 10 компьютеров
- Сеть для 2 компьютеров (point-to-point)

Эффективное распределение из 192.168.1.0/24:

192.168.1.0/25   → 126 хостов (для 100 компьютеров)
192.168.1.128/26 → 62 хоста   (для 50 компьютеров)
192.168.1.192/28 → 14 хостов  (для 10 компьютеров)
192.168.1.208/30 → 2 хоста    (для point-to-point)

Схема распределения:
├── 192.168.1.0/25 ████████████████████████████████████
├── 192.168.1.128/26 ████████████████
├── 192.168.1.192/28 ████
└── 192.168.1.208/30 █
```

#### IPv6: Будущее интернета

IPv6 решает проблему исчерпания адресов IPv4, предоставляя практически неограниченное адресное пространство.

**Структура IPv6:**
```
Длина: 128 бит (в 4 раза больше IPv4)
Формат: 8 групп по 4 hex-цифры, разделенные ":"

Пример полного адреса:
2001:0db8:85a3:0000:0000:8a2e:0370:7334

Сокращенная запись:
2001:db8:85a3::8a2e:370:7334

Структура адреса:
┌──────────────────┬──────────────────────────────────┐
│   64 бита сети   │        64 бита хоста            │
│  (префикс /64)   │     (interface identifier)      │
└──────────────────┴──────────────────────────────────┘
```

**Типы IPv6 адресов:**

```
Unicast (точка-точка):
├── Global Unicast (2000::/3) - маршрутизируемые в интернете
├── Link-Local (fe80::/10)    - только в локальном сегменте
└── Unique Local (fc00::/7)   - частные адреса

Multicast (точка-множество):
├── ff02::1 - все узлы в сегменте
├── ff02::2 - все маршрутизаторы
└── ff02::5 - все OSPF маршрутизаторы

Anycast:
└── Один адрес назначается нескольким интерфейсам
```

#### DHCP: Автоматическое назначение адресов

DHCP работает как автоматизированная служба регистрации адресов:

**Процесс получения IP-адреса (DORA):**

```
Клиент                           DHCP Сервер
   │                                  │
   │ 1. DHCP Discover (broadcast)     │
   │ ─────────────────────────────────→ │
   │                                  │
   │      2. DHCP Offer               │
   │ ←───────────────────────────────── │
   │                                  │
   │ 3. DHCP Request                  │
   │ ─────────────────────────────────→ │
   │                                  │
   │      4. DHCP ACK                 │
   │ ←───────────────────────────────── │

Временная шкала:
T0: Discover  - "Есть ли здесь DHCP сервер?"
T1: Offer     - "Да, вот адрес 192.168.1.100"
T2: Request   - "Хорошо, я беру этот адрес"
T3: ACK       - "Подтверждаю, адрес твой на 24 часа"
```

**DHCP опции (расширенная конфигурация):**
```
Опция 1:   Маска подсети (255.255.255.0)
Опция 3:   Шлюз по умолчанию (192.168.1.1)
Опция 6:   DNS серверы (8.8.8.8, 8.8.4.4)
Опция 15:  Доменное имя (company.local)
Опция 42:  NTP серверы (pool.ntp.org)
Опция 66:  TFTP сервер (для загрузки конфигураций)
Опция 150: Cisco IP Phone опции
```

---

## 🛣️ Глава 3.2: Маршрутизация
### Искусство направления пакетов

#### Основные принципы маршрутизации

Маршрутизация - это процесс определения оптимального пути для доставки пакетов от источника к назначению. Представьте маршрутизатор как умного диспетчера на перекрестке дорог.

**Таблица маршрутизации - карта путей:**
```
Пункт назначения    Следующий шаг    Интерфейс    Метрика
──────────────────────────────────────────────────────────
192.168.1.0/24      Прямо           eth0         0 (connected)
192.168.2.0/24      10.0.0.2        eth1         1
0.0.0.0/0           10.0.0.1        eth1         10 (default)

Интерпретация:
"Чтобы попасть в сеть 192.168.1.0/24, отправь пакет прямо через eth0"
"Чтобы попасть в сеть 192.168.2.0/24, отправь на 10.0.0.2 через eth1"
"Для всех остальных сетей отправь на шлюз 10.0.0.1"
```

#### Статическая маршрутизация

Статические маршруты - это заранее определенные пути, как заранее спланированный туристический маршрут.

**Принципы статической маршрутизации:**

```
Преимущества:
├── Полный контроль администратора
├── Предсказуемое поведение
├── Минимальное потребление ресурсов
├── Высокая безопасность
└── Простота в небольших сетях

Недостатки:
├── Ручная настройка каждого маршрута
├── Отсутствие автоматической адаптации
├── Сложность масштабирования
└── Необходимость ручного обновления при изменениях

Когда использовать:
├── Небольшие статичные сети
├── Backup маршруты
├── Специальные политики маршрутизации
└── Подключения к интернет-провайдеру
```

**Пример конфигурации сети:**
```
Сеть компании:
                    Internet
                       │
                   [Router A]
                       │
                   10.0.0.0/30
                  ┌────┴────┐
            [Router B]  [Router C]
                │              │
         192.168.1.0/24  192.168.2.0/24

Статические маршруты на Router B:
- 192.168.2.0/24 via 10.0.0.2 (через Router C)
- 0.0.0.0/0 via 10.0.0.1 (через Router A в интернет)

Статические маршруты на Router C:  
- 192.168.1.0/24 via 10.0.0.1 (через Router B)
- 0.0.0.0/0 via 10.0.0.1 (через Router A в интернет)
```

#### Динамические протоколы маршрутизации

Динамические протоколы работают как GPS навигатор - автоматически находят оптимальные пути и адаптируются к изменениям.

#### RIP (Routing Information Protocol)

RIP - простейший протокол маршрутизации, использующий количество переходов (hops) как метрику.

**Принципы работы RIP:**
```
Метрика: Количество маршрутизаторов до назначения
Максимум: 15 переходов (16 = недостижимо)
Обновления: Каждые 30 секунд
Алгоритм: Distance Vector (Беллман-Форд)

Пример сети:
A ──1── B ──1── C ──1── D
    │               │
    └──────3────────┘

RIP таблица на маршрутизаторе A:
Сеть B: метрика 1 (прямое соединение)
Сеть C: метрика 2 (через B)  
Сеть D: метрика 3 (через B→C)

Альтернативный путь A→D напрямую: метрика 3
RIP выберет любой из путей (одинаковая метрика)
```

**Проблемы RIP:**
```
1. Count to Infinity:
   При отказе маршрута маршрутизаторы могут
   бесконечно увеличивать метрику

2. Медленная сходимость:
   Изменения распространяются медленно

3. Ограничение на 15 переходов:
   Не подходит для больших сетей

4. Неэффективное использование каналов:
   Передает всю таблицу каждые 30 секунд
```

#### EIGRP (Enhanced Interior Gateway Routing Protocol)

EIGRP - продвинутый протокол Cisco, использующий составную метрику и быструю сходимость.

**Особенности EIGRP:**
```
Метрика: Составная (bandwidth, delay, load, reliability)
Алгоритм: DUAL (Diffusing Update Algorithm)
Сходимость: Очень быстрая (секунды)
Масштабируемость: До 224 маршрутизаторов

Расчет метрики:
Metric = (K1*Bandwidth + K2*Load + K3*Delay) * K5/(K4+Reliability)

По умолчанию (K1=1, K2=0, K3=1, K4=0, K5=0):
Metric = Bandwidth + Delay

Где:
Bandwidth = 10^7 / минимальная пропускная способность в Kbps
Delay = сумма задержек в 10-микросекундных единицах
```

**Концепция соседей и топологической таблицы:**
```
EIGRP поддерживает три таблицы:

1. Neighbor Table (таблица соседей):
   ├── Список прямых соседей
   ├── Hello-пакеты каждые 5 секунд
   └── Hold time 15 секунд

2. Topology Table (топологическая таблица):
   ├── Все известные пути к сетям
   ├── Feasible Distance (FD) - лучшая метрика
   ├── Advertised Distance (AD) - метрика от соседа
   └── Feasible Successor - резервный путь

3. Routing Table (таблица маршрутизации):
   └── Только лучшие пути из топологической таблицы

Пример:
Сеть: 192.168.1.0/24
├── Successor: Router B (FD=2816, AD=2560)
└── Feasible Successor: Router C (FD=3072, AD=2816)

При отказе основного пути EIGRP мгновенно
переключается на резервный без пересчета
```

#### OSPF (Open Shortest Path First)

OSPF - стандартный протокол маршрутизации, использующий алгоритм состояния канала.

**Архитектура OSPF:**
```
Иерархическая структура:
Area 0 (Backbone Area) - центральная область
├── Area 1 (Standard Area)
├── Area 2 (Standard Area)  
└── Area 3 (Stub Area)

Типы маршрутизаторов:
├── Internal Router - все интерфейсы в одной области
├── Area Border Router (ABR) - соединяет области
├── AS Boundary Router (ASBR) - соединяет с другими AS
└── Backbone Router - имеет интерфейс в Area 0
```

**Процесс работы OSPF:**
```
1. Обнаружение соседей (Hello Protocol):
   ├── Hello packets каждые 10 секунд
   ├── Dead interval 40 секунд
   └── Проверка совместимости параметров

2. Синхронизация баз данных:
   ├── Database Description (DBD)
   ├── Link State Request (LSR)  
   └── Link State Update (LSU)

3. Расчет кратчайших путей:
   ├── Алгоритм Дейкстры (SPF)
   ├── Построение SPF-дерева
   └── Вычисление лучших маршрутов

Типы LSA (Link State Advertisement):
├── Type 1: Router LSA (маршрутизаторы в области)
├── Type 2: Network LSA (сети с DR)
├── Type 3: Summary LSA (межобластная информация)
├── Type 4: ASBR Summary LSA
├── Type 5: AS External LSA (внешние маршруты)
└── Type 7: NSSA External LSA
```

**Designated Router (DR) концепция:**
```
В multi-access сетях (Ethernet) выбирается DR:

Без DR (проблема):         С DR (решение):
A ↔ B ↔ C ↔ D             A → DR ← B
│   │   │   │             ↓     ↑
└───┼───┼───┘             C ← BDR → D

Без DR: n(n-1)/2 adjacency = 6 связей
С DR: n-1 adjacency = 3 связи

Выбор DR:
1. Самый высокий приоритет (0-255)
2. При равенстве - самый высокий Router ID
3. DR не переизбирается при появлении лучшего
```

#### BGP (Border Gateway Protocol)

BGP - протокол маршрутизации между автономными системами, основа интернета.

**Концепция автономных систем:**
```
Автономная система (AS) - группа сетей под единым
административным управлением с общей политикой маршрутизации.

Примеры AS:
├── AS 7922 (Comcast Cable)
├── AS 15169 (Google)  
├── AS 32934 (Facebook)
└── AS 13238 (Yandex)

Типы BGP:
├── eBGP (External BGP) - между разными AS
└── iBGP (Internal BGP) - внутри одной AS

BGP использует TCP порт 179 для надежности
```

**Атрибуты BGP пути:**
```
Well-known Mandatory (обязательные):
├── ORIGIN: IGP, EGP, или Incomplete
├── AS_PATH: список AS через которые прошел маршрут
├── NEXT_HOP: IP следующего маршрутизатора
└── MED: Multi-Exit Discriminator (предпочтение входа)

Well-known Discretionary (необязательные):
├── LOCAL_PREF: локальное предпочтение (выше = лучше)
├── ATOMIC_AGGREGATE: маршрут агрегирован
└── AGGREGATOR: информация об агрегации

Optional Transitive:
├── AGGREGATOR: кто выполнил агрегацию
└── COMMUNITY: группировка маршрутов для политик

Optional Non-transitive:
├── MED: метрика для выбора точки входа
└── CLUSTER_LIST: для Route Reflectors
```

**Процесс выбора лучшего пути BGP:**
```
1. Highest Weight (Cisco-specific)
2. Highest LOCAL_PREF  
3. Locally originated routes
4. Shortest AS_PATH
5. Lowest ORIGIN (IGP < EGP < Incomplete)
6. Lowest MED (same AS)
7. eBGP over iBGP
8. Lowest IGP metric to NEXT_HOP
9. Oldest route
10. Lowest Router ID
11. Lowest neighbor IP

Пример выбора:
Route A: AS_PATH = 100 200 300 (length=3)
Route B: AS_PATH = 100 400 (length=2)
→ Выбран Route B (короче AS_PATH)
```

---

## 🔄 Глава 3.3: NAT и сетевая безопасность
### Трансляция адресов и защита сетей

#### Network Address Translation (NAT)

NAT решает проблему нехватки публичных IP-адресов, позволяя множеству устройств использовать один публичный адрес.

**Типы NAT:**

**1. Static NAT (статическая трансляция):**
```
Принцип: Один частный адрес ↔ Один публичный адрес

Пример:
Частный адрес    Публичный адрес
192.168.1.10  ←→  203.0.113.10
192.168.1.11  ←→  203.0.113.11

Использование:
├── Серверы, доступные из интернета
├── Устройства, требующие постоянного IP
└── Простая конфигурация для небольших сетей

Таблица трансляции:
Inside Local    Inside Global    Outside Local    Outside Global
192.168.1.10    203.0.113.10    198.51.100.5     198.51.100.5
```

**2. Dynamic NAT (динамическая трансляция):**
```
Принцип: Пул частных адресов ↔ Пул публичных адресов

Пример конфигурации:
Частные адреса: 192.168.1.1-192.168.1.100
Публичный пул:  203.0.113.1-203.0.113.20

Процесс:
1. Клиент 192.168.1.50 инициирует соединение
2. NAT назначает свободный адрес из пула (203.0.113.5)
3. Создается временная трансляция
4. После завершения сессии адрес возвращается в пул

Ограничения:
├── Количество одновременных сессий = размер пула
├── Адреса назначаются по принципу "первый пришел - первый получил"
└── Невозможность инициировать соединения извне
```

**3. PAT (Port Address Translation) / NAT Overload:**
```
Принцип: Множество частных адресов ↔ Один публичный адрес + порты

Пример трансляции:
Inside (LAN)              Outside (Internet)
192.168.1.10:3045    ←→   203.0.113.1:1024
192.168.1.11:3046    ←→   203.0.113.1:1025
192.168.1.12:80      ←→   203.0.113.1:1026

Таблица NAT/PAT:
Protocol  Inside IP:Port    Outside IP:Port   Global IP:Port
TCP       192.168.1.10:3045  198.51.100.5:80  203.0.113.1:1024
TCP       192.168.1.11:3046  198.51.100.5:80  203.0.113.1:1025
UDP       192.168.1.12:53    8.8.8.8:53       203.0.113.1:1026

Преимущества:
├── Максимальная экономия публичных адресов
├── Тысячи устройств через один публичный IP
├── Дополнительная безопасность (устройства скрыты)
└── Стандартное решение для домашних/офисных сетей
```

#### Проблемы и ограничения NAT

**Технические ограничения:**
```
1. Нарушение end-to-end принципа:
   ├── Невозможность прямого соединения извне
   ├── Проблемы с P2P приложениями
   └── Сложности с VoIP и видеоконференциями

2. Проблемы с протоколами:
   ├── FTP (активный режим)
   ├── SIP (VoIP сигнализация)
   ├── IPSec (изменение заголовков)
   └── SNMP (адреса в payload)

3. Производительность:
   ├── Дополнительная обработка каждого пакета
   ├── Ведение состояния сессий
   └── Ограничения по количеству сессий

4. Отладка и мониторинг:
   ├── Сложность трассировки соединений
   ├── Логирование трансляций
   └── Диагностика проблем подключения
```

**Решения проблем NAT:**
```
1. Application Layer Gateways (ALG):
   ├── Анализ содержимого пакетов
   ├── Автоматическая трансляция адресов в payload
   └── Поддержка специфичных протоколов

2. UPnP (Universal Plug and Play):
   ├── Автоматическое создание правил NAT
   ├── Приложения сами настраивают проброс портов
   └── Упрощение настройки для пользователей

3. STUN/TURN серверы:
   ├── Определение внешнего IP и порта
   ├── Обход NAT для P2P соединений
   └── Relay трафика через промежуточные серверы

4. IPv6 переход:
   ├── Устранение необходимости в NAT
   ├── Возврат к end-to-end принципу
   └── Упрощение сетевой архитектуры
```

#### Основы сетевой безопасности

#### Firewall - цифровой страж сети

Firewall анализирует трафик и принимает решения о разрешении или блокировке на основе заданных правил.

**Типы firewall по архитектуре:**
```
1. Packet Filter (фильтр пакетов):
   ├── Анализ заголовков L3/L4
   ├── Решения на основе IP, портов, протоколов
   ├── Быстрая обработка
   └── Ограниченная функциональность

2. Stateful Inspection:
   ├── Отслеживание состояния соединений
   ├── Анализ связанности пакетов
   ├── Защита от spoofing атак
   └── Контроль возвращаемого трафика

3. Application Layer (L7):
   ├── Глубокий анализ содержимого
   ├── Понимание протоколов приложений
   ├── Защита от application-level атак
   └── Контроль по содержимому

Архитектурная схема:
Internet ←→ [Border Firewall] ←→ [DMZ] ←→ [Internal Firewall] ←→ LAN
                │                   │              │
            Первичная           Публичные      Внутренние
             защита             сервисы         ресурсы
```

**Принципы правил firewall:**
```
Структура правила:
[Действие] [Источник] [Назначение] [Сервис] [Время] [Логирование]

Пример правил:
1. ALLOW   192.168.1.0/24  ANY           HTTP/HTTPS   ANY      LOG
2. ALLOW   192.168.1.0/24  10.0.0.5      SSH          WORK_HRS NO_LOG  
3. DENY    ANY             192.168.1.0/24 ANY         ANY      LOG
4. ALLOW   ANY             203.0.113.10   WEB_SERVICES ANY     LOG

Порядок обработки:
├── Правила проверяются сверху вниз
├── Первое совпадение определяет действие
├── Последнее правило обычно "deny all"
└── Важность правильной последовательности

Визуализация обработки:
Пакет: 192.168.1.50 → 8.8.8.8:53 (DNS)
├── Правило 1: Не совпадает (не HTTP/HTTPS)
├── Правило 2: Не совпадает (не SSH к 10.0.0.5)
├── Правило 3: Совпадение! → DENY + LOG
└── Пакет отброшен
```

#### Access Control Lists (ACL)

ACL предоставляют детализированный контроль доступа на сетевом уровне.

**Типы ACL:**
```
Standard ACL (стандартные):
├── Фильтрация только по source IP
├── Номера 1-99, 1300-1999
├── Применяются близко к назначению
└── Простая конфигурация

Extended ACL (расширенные):
├── Фильтрация по множественным критериям
├── Source/Destination IP, протокол, порты
├── Номера 100-199, 2000-2699
├── Применяются близко к источнику
└── Гибкая конфигурация

Named ACL (именованные):
├── Текстовые имена вместо номеров
├── Возможность редактирования строк
├── Лучшая читаемость конфигурации
└── Поддержка больших списков
```

**Пример расширенного ACL:**
```
Задача: Разрешить сотрудникам (192.168.1.0/24) доступ к:
- Web серверам (HTTP/HTTPS)
- Email серверу (SMTP/POP3/IMAP)
- DNS серверам
Запретить доступ к FTP и Telnet

ACL конфигурация:
permit tcp 192.168.1.0 0.0.0.255 any eq 80      ! HTTP
permit tcp 192.168.1.0 0.0.0.255 any eq 443     ! HTTPS
permit tcp 192.168.1.0 0.0.0.255 any eq 25      ! SMTP
permit tcp 192.168.1.0 0.0.0.255 any eq 110     ! POP3
permit tcp 192.168.1.0 0.0.0.255 any eq 143     ! IMAP
permit udp 192.168.1.0 0.0.0.255 any eq 53      ! DNS
deny   tcp 192.168.1.0 0.0.0.255 any eq 21      ! FTP
deny   tcp 192.168.1.0 0.0.0.255 any eq 23      ! Telnet
permit ip  192.168.1.0 0.0.0.255 any             ! Остальное разрешено

Логика работы:
└── Каждый пакет проверяется по порядку
    ├── Если совпадает permit → пропускается
    ├── Если совпадает deny → отбрасывается
    └── Неявное "deny all" в конце
```

#### DMZ (Demilitarized Zone)

DMZ создает изолированную зону для публичных сервисов.

**Архитектура DMZ:**
```
Классическая трехуровневая архитектура:

Internet
    │
┌───▼───┐
│Border │  ← Внешний firewall
│ FW    │
└───┬───┘
    │
┌───▼───┐  ← DMZ (публичные сервисы)
│  DMZ  │
│ Сеть  │  Web, Mail, DNS серверы
└───┬───┘
    │
┌───▼───┐
│Internal│ ← Внутренний firewall  
│ FW    │
└───┬───┘
    │
┌───▼───┐  ← Внутренняя сеть
│  LAN  │
│       │  Рабочие станции, внутренние серверы
└───────┘

Политики безопасности:
├── Internet → DMZ: Ограниченный доступ к публичным сервисам
├── DMZ → Internet: Исходящий трафик (обновления, репликация)
├── DMZ → LAN: Строго запрещено
├── LAN → DMZ: Контролируемый доступ к сервисам
└── LAN → Internet: Через proxy/firewall с фильтрацией
```

#### Базовые принципы VPN

VPN создает защищенный туннель через незащищенную сеть.

**Типы VPN по назначению:**
```
Site-to-Site VPN:
├── Соединение между офисами
├── Постоянное подключение
├── Прозрачность для пользователей
└── Маршрутизация между сетями

Схема:
Office A ←→ [Internet] ←→ Office B
192.168.1.0/24      192.168.2.0/24
     │                    │
   [VPN GW] ←────────→ [VPN GW]
     │     IPSec Tunnel    │
     └─ Encrypted Traffic ─┘

Remote Access VPN:
├── Подключение удаленных пользователей
├── Соединение по требованию
├── Клиентское ПО на устройствах
└── Доступ к корпоративным ресурсам

Схема:
[Laptop] ←→ [Internet] ←→ [VPN Server] ←→ [Corporate LAN]
   │                          │
   └── SSL/IPSec tunnel ──────┘
```

**Протоколы VPN:**
```
IPSec (IP Security):
├── Работает на сетевом уровне (L3)
├── Два режима: Transport и Tunnel
├── Протоколы: AH (Authentication Header), ESP (Encapsulating Security Payload)
├── Key exchange: IKE (Internet Key Exchange)
└── Высокая безопасность, сложность настройки

SSL/TLS VPN:
├── Работает на прикладном уровне (L7)
├── Использует веб-браузер или тонкий клиент
├── Простота развертывания
├── Гранулярный контроль доступа
└── Ограниченная функциональность

PPTP (Point-to-Point Tunneling Protocol):
├── Простота настройки
├── Широкая поддержка
├── Слабая безопасность
└── Не рекомендуется для критичных применений

WireGuard:
├── Современный протокол
├── Высокая производительность
├── Простота конфигурации
├── Сильная криптография
└── Минимальный код (безопасность)
```

---

## 🎯 Практические задания для закрепления

### Задание 1: Планирование IP-адресации
```
Дана сеть 172.16.0.0/16. Необходимо разделить на подсети для:
- Филиал A: 1000 хостов
- Филиал B: 500 хостов  
- Филиал C: 250 хостов
- Point-to-point линки: 6 штук по 2 хоста

Задачи:
1. Рассчитать оптимальные подсети с минимальными потерями
2. Составить план адресации
3. Оставить место для расширения на 50%
```

### Задание 2: Анализ таблиц маршрутизации
```
Проанализируйте сеть и найдите проблемы:

Router A routing table:
192.168.1.0/24    Connected     eth0
192.168.2.0/24    10.0.0.2      eth1
0.0.0.0/0         10.0.0.1      eth1

Router B routing table:  
192.168.2.0/24    Connected     eth0
192.168.1.0/24    10.0.0.1      eth1
0.0.0.0/0         10.0.0.1      eth1

Есть ли петли маршрутизации? Как исправить?
```

### Задание 3: Проектирование NAT
```
Спроектируйте NAT решение для компании:
- 200 сотрудников (одновременно 150 активных)
- 3 публичных сервера (Web, Mail, FTP)
- 1 публичный IP-адрес
- Необходим удаленный доступ для 10 администраторов

Определите:
1. Тип NAT для каждого сценария
2. Конфигурацию портов
3. Правила безопасности
```

---

## 📚 Ключевые понятия для запоминания

### IP-адресация:
- **CIDR** - бесклассовая адресация с префиксами
- **VLSM** - подсети переменной длины
- **Суммаризация** - объединение маршрутов для оптимизации
- **IPv6** - 128-битная адресация будущего

### Маршрутизация:
- **Статическая** - ручное управление, предсказуемость
- **RIP** - простота, ограничения по масштабу
- **OSPF** - иерархичность, быстрая сходимость  
- **BGP** - политики, масштабируемость интернета

### Безопасность:
- **NAT** - экономия адресов, базовая защита
- **Firewall** - контроль трафика по правилам
- **ACL** - детализированный контроль доступа
- **VPN** - защищенная связь через интернет

---

## 🎯 Готовность к следующему блоку

После изучения этого блока вы должны уметь:

✅ **Планировать IP-адресацию** для сетей любой сложности  
✅ **Настраивать маршрутизацию** статическую и динамическую  
✅ **Диагностировать проблемы** сетевого уровня  
✅ **Проектировать NAT** решения для различных сценариев  
✅ **Применять базовые принципы** сетевой безопасности  

**Следующий блок:** Транспортные протоколы и сервисы - углубление в TCP/UDP и прикладные протоколы, изучение сетевых сервисов и анализ трафика.

---

*Время на изучение: 3-4 месяца при 20+ часах в неделю*  
*Практика: 70% лабораторных работ, 30% теории*  
*Цель: Уверенное понимание принципов маршрутизации и IP-технологий*